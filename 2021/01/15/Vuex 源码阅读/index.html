<!DOCTYPE html>
<html lang=zh>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="1. æºç ç›®å½•ç»“æ„åˆ†ææ•´ä¸ª Vuex çš„æºç æ–‡ä»¶éå¸¸å¤šï¼Œæˆ‘ä»¬ç›´æ¥çœ‹æœ€ä¸»è¦çš„æ–‡ä»¶ï¼Œå³ src æ–‡ä»¶å¤¹ä¸­çš„å†…å®¹ï¼Œç»“æ„ç¤ºä¾‹å¦‚ä¸‹ï¼š 12345678910111213141516â”œâ”€â”€ src    â”œâ”€â”€ module    &#x2F;&#x2F; ä¸æ¨¡å—ç›¸å…³çš„æ“ä½œ    â”‚   â”œâ”€â”€ module-collection.js   &#x2F;&#x2F; ç”¨äºæ”¶é›†å¹¶æ³¨å†Œæ ¹æ¨¡å—ä»¥åŠåµŒå¥—æ¨¡å—    â”‚   â””â”€â”€ module.js   &#x2F;">
<meta property="og:type" content="article">
<meta property="og:title" content="Vuex æºç é˜…è¯»">
<meta property="og:url" content="https://dxiaog.github.io/2021/01/15/Vuex%20%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB/index.html">
<meta property="og:site_name" content="æ®µæ™“åˆš">
<meta property="og:description" content="1. æºç ç›®å½•ç»“æ„åˆ†ææ•´ä¸ª Vuex çš„æºç æ–‡ä»¶éå¸¸å¤šï¼Œæˆ‘ä»¬ç›´æ¥çœ‹æœ€ä¸»è¦çš„æ–‡ä»¶ï¼Œå³ src æ–‡ä»¶å¤¹ä¸­çš„å†…å®¹ï¼Œç»“æ„ç¤ºä¾‹å¦‚ä¸‹ï¼š 12345678910111213141516â”œâ”€â”€ src    â”œâ”€â”€ module    &#x2F;&#x2F; ä¸æ¨¡å—ç›¸å…³çš„æ“ä½œ    â”‚   â”œâ”€â”€ module-collection.js   &#x2F;&#x2F; ç”¨äºæ”¶é›†å¹¶æ³¨å†Œæ ¹æ¨¡å—ä»¥åŠåµŒå¥—æ¨¡å—    â”‚   â””â”€â”€ module.js   &#x2F;">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2021-01-14T16:00:00.000Z">
<meta property="article:modified_time" content="2023-05-14T11:37:20.796Z">
<meta property="article:author" content="æ®µæ™“åˆš">
<meta name="twitter:card" content="summary">
    
    
      
        
          <link rel="shortcut icon" href="/images/favicon.ico">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
        
      
    
    <!-- title -->
    <title>Vuex æºç é˜…è¯»</title>
    <!-- async scripts -->
    <!-- Google Analytics -->


    <!-- Umami Analytics -->


    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
	<!-- mathjax -->
	
<meta name="generator" content="Hexo 6.3.0"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="ç›®å½•"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="ç›®å½•"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" aria-label="é¡¶éƒ¨" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa-solid fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        <!--
       --><li><a href="/">é¦–é¡µ</a></li><!--
     --><!--
       --><li><a href="/about/">å…³äº</a></li><!--
     --><!--
       --><li><a href="/archives/">å½’æ¡£</a></li><!--
     --><!--
       --><li><a target="_blank" rel="noopener" href="http://github.com/dxiaog">é¡¹ç›®</a></li><!--
     -->
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" aria-label="ä¸Šä¸€ç¯‡" href="/2021/03/01/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%A1%AC%E6%A0%B8%E8%AE%B2%E8%A7%A3/"><i class="fa-solid fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" aria-label="ä¸‹ä¸€ç¯‡" href="/2020/09/28/then,catch,finally%20%E5%A6%82%E4%BD%95%E5%BD%B1%E5%93%8D%E8%BF%94%E5%9B%9E%E7%9A%84%20Promise%20%E5%AE%9E%E4%BE%8B%E7%8A%B6%E6%80%81/"><i class="fa-solid fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" aria-label="è¿”å›é¡¶éƒ¨" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" aria-label="åˆ†äº«æ–‡ç« " href="#"><i class="fa-solid fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">ä¸Šä¸€ç¯‡</span>
      <span id="i-next" class="info" style="display:none;">ä¸‹ä¸€ç¯‡</span>
      <span id="i-top" class="info" style="display:none;">è¿”å›é¡¶éƒ¨</span>
      <span id="i-share" class="info" style="display:none;">åˆ†äº«æ–‡ç« </span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://dxiaog.github.io/2021/01/15/Vuex%20%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://dxiaog.github.io/2021/01/15/Vuex%20%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB/&text=Vuex æºç é˜…è¯»"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://dxiaog.github.io/2021/01/15/Vuex%20%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB/&title=Vuex æºç é˜…è¯»"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://dxiaog.github.io/2021/01/15/Vuex%20%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB/&is_video=false&description=Vuex æºç é˜…è¯»"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Vuex æºç é˜…è¯»&body=Check out this article: https://dxiaog.github.io/2021/01/15/Vuex%20%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB/"><i class="fa-solid fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://dxiaog.github.io/2021/01/15/Vuex%20%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB/&title=Vuex æºç é˜…è¯»"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://dxiaog.github.io/2021/01/15/Vuex%20%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB/&title=Vuex æºç é˜…è¯»"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://dxiaog.github.io/2021/01/15/Vuex%20%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB/&title=Vuex æºç é˜…è¯»"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://dxiaog.github.io/2021/01/15/Vuex%20%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB/&title=Vuex æºç é˜…è¯»"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://dxiaog.github.io/2021/01/15/Vuex%20%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB/&name=Vuex æºç é˜…è¯»&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://dxiaog.github.io/2021/01/15/Vuex%20%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB/&t=Vuex æºç é˜…è¯»"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E6%BA%90%E7%A0%81%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84%E5%88%86%E6%9E%90"><span class="toc-number">1.</span> <span class="toc-text">1. æºç ç›®å½•ç»“æ„åˆ†æ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB"><span class="toc-number">2.</span> <span class="toc-text">2. æºç é˜…è¯»</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E6%9F%A5%E7%9C%8B%E5%B7%A5%E5%85%B7%E5%87%BD%E6%95%B0"><span class="toc-number">2.1.</span> <span class="toc-text">1. æŸ¥çœ‹å·¥å…·å‡½æ•°</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%85%A5%E5%8F%A3%E6%96%87%E4%BB%B6"><span class="toc-number">2.2.</span> <span class="toc-text">2. å…¥å£æ–‡ä»¶</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-Store-%E7%B1%BB%E7%9A%84%E5%AE%9E%E7%8E%B0"><span class="toc-number">2.3.</span> <span class="toc-text">3. Store ç±»çš„å®ç°</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-%E5%AD%98%E6%94%BE%E7%B1%BB%E7%9A%84%E7%8A%B6%E6%80%81"><span class="toc-number">2.3.1.</span> <span class="toc-text">3.1 å­˜æ”¾ç±»çš„çŠ¶æ€</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#3-1-1-%E9%80%92%E5%BD%92%E6%94%B6%E9%9B%86%E6%A8%A1%E5%9D%97"><span class="toc-number">2.3.1.1.</span> <span class="toc-text">3.1.1 é€’å½’æ”¶é›†æ¨¡å—</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-%E6%B3%A8%E5%86%8C%E6%A8%A1%E5%9D%97"><span class="toc-number">2.3.2.</span> <span class="toc-text">3.2 æ³¨å†Œæ¨¡å—</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#3-2-1-%E6%B3%A8%E5%86%8C%E6%A8%A1%E5%9D%97%E7%9A%84-state"><span class="toc-number">2.3.2.1.</span> <span class="toc-text">3.2.1 æ³¨å†Œæ¨¡å—çš„ state</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-2-2-%E7%94%9F%E6%88%90%E6%A8%A1%E5%9D%97%E8%B0%83%E7%94%A8%E4%B8%8A%E4%B8%8B%E6%96%87"><span class="toc-number">2.3.2.2.</span> <span class="toc-text">3.2.2 ç”Ÿæˆæ¨¡å—è°ƒç”¨ä¸Šä¸‹æ–‡</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-2-3-%E6%B3%A8%E5%86%8C%E6%A8%A1%E5%9D%97%E7%9A%84-mutation"><span class="toc-number">2.3.2.3.</span> <span class="toc-text">3.2.3 æ³¨å†Œæ¨¡å—çš„ mutation</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-2-4-%E6%B3%A8%E5%86%8C%E6%A8%A1%E5%9D%97%E7%9A%84-actions"><span class="toc-number">2.3.2.4.</span> <span class="toc-text">3.2.4 æ³¨å†Œæ¨¡å—çš„ actions</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-2-5-%E6%B3%A8%E5%86%8C%E6%A8%A1%E5%9D%97%E7%9A%84-getters"><span class="toc-number">2.3.2.5.</span> <span class="toc-text">3.2.5 æ³¨å†Œæ¨¡å—çš„ getters</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-2-6-%E9%80%92%E5%BD%92%E6%B3%A8%E5%86%8C%E5%AD%90%E6%A8%A1%E5%9D%97"><span class="toc-number">2.3.2.6.</span> <span class="toc-text">3.2.6 é€’å½’æ³¨å†Œå­æ¨¡å—</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-%E6%B3%A8%E5%86%8C-vm"><span class="toc-number">2.3.3.</span> <span class="toc-text">3.3 æ³¨å†Œ vm</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-4-%E8%AE%BF%E9%97%AE-state-%E3%80%81mutations-%E3%80%81actions"><span class="toc-number">2.3.4.</span> <span class="toc-text">3.4 è®¿é—® state ã€mutations ã€actions</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#3-4-1-%E8%AE%BF%E9%97%AE-state"><span class="toc-number">2.3.4.1.</span> <span class="toc-text">3.4.1 è®¿é—® state</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-4-2-%E8%AE%BF%E9%97%AE-mutations"><span class="toc-number">2.3.4.2.</span> <span class="toc-text">3.4.2 è®¿é—® mutations</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-4-3-%E8%AE%BF%E9%97%AE-actions"><span class="toc-number">2.3.4.3.</span> <span class="toc-text">3.4.3 è®¿é—® actions</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-5-%E6%8F%92%E4%BB%B6%E7%9A%84%E8%B0%83%E7%94%A8"><span class="toc-number">2.3.5.</span> <span class="toc-text">3.5 æ’ä»¶çš„è°ƒç”¨</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-6-%E5%85%B6%E5%AE%83%E6%96%B9%E6%B3%95"><span class="toc-number">2.3.6.</span> <span class="toc-text">3.6 å…¶å®ƒæ–¹æ³•</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#3-6-1-%E6%9B%B4%E6%96%B0-state"><span class="toc-number">2.3.6.1.</span> <span class="toc-text">3.6.1 æ›´æ–° state</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-6-2-%E6%B3%A8%E5%86%8C%E3%80%81%E5%8D%B8%E8%BD%BD%E6%A8%A1%E5%9D%97"><span class="toc-number">2.3.6.2.</span> <span class="toc-text">3.6.2 æ³¨å†Œã€å¸è½½æ¨¡å—</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-6-3-%E9%87%8D%E7%BD%AE-store-%E5%AE%9E%E4%BE%8B"><span class="toc-number">2.3.6.3.</span> <span class="toc-text">3.6.3 é‡ç½® store å®ä¾‹</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-install-%E6%B3%A8%E5%86%8C"><span class="toc-number">2.4.</span> <span class="toc-text">4. install æ³¨å†Œ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E8%BE%85%E5%8A%A9%E5%87%BD%E6%95%B0"><span class="toc-number">2.5.</span> <span class="toc-text">5. è¾…åŠ©å‡½æ•°</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#5-1-mapState"><span class="toc-number">2.5.1.</span> <span class="toc-text">5.1 mapState</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-2-mapMutations"><span class="toc-number">2.5.2.</span> <span class="toc-text">5.2 mapMutations</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-3-mapGetters"><span class="toc-number">2.5.3.</span> <span class="toc-text">5.3 mapGetters</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-4-mapActions"><span class="toc-number">2.5.4.</span> <span class="toc-text">5.4 mapActions</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-5-createNamespacedHelpers"><span class="toc-number">2.5.5.</span> <span class="toc-text">5.5 createNamespacedHelpers</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%92%A1-%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A"><span class="toc-number">3.</span> <span class="toc-text">ğŸ’¡ å¿ƒå¾—ä½“ä¼š</span></a></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index py4 ">
        
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle p-name" itemprop="name headline">
        Vuex æºç é˜…è¯»
    </h1>



    <div class="meta">
      <span class="author p-author h-card" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span class="p-name" itemprop="name">æ®µæ™“åˆš</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2021-01-14T16:00:00.000Z" class="dt-published" itemprop="datePublished">2021-01-15</time>
        
      
    </div>


      

      

    </div>
  </header>
  

  <div class="content e-content" itemprop="articleBody">
    <h2 id="1-æºç ç›®å½•ç»“æ„åˆ†æ"><a href="#1-æºç ç›®å½•ç»“æ„åˆ†æ" class="headerlink" title="1. æºç ç›®å½•ç»“æ„åˆ†æ"></a>1. æºç ç›®å½•ç»“æ„åˆ†æ</h2><p>æ•´ä¸ª <code>Vuex</code> çš„æºç æ–‡ä»¶éå¸¸å¤šï¼Œæˆ‘ä»¬ç›´æ¥çœ‹æœ€ä¸»è¦çš„æ–‡ä»¶ï¼Œå³ <code>src</code> æ–‡ä»¶å¤¹ä¸­çš„å†…å®¹ï¼Œç»“æ„ç¤ºä¾‹å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">â”œâ”€â”€ src</span><br><span class="line">    â”œâ”€â”€ module    // ä¸æ¨¡å—ç›¸å…³çš„æ“ä½œ</span><br><span class="line">    â”‚   â”œâ”€â”€ module-collection.js   // ç”¨äºæ”¶é›†å¹¶æ³¨å†Œæ ¹æ¨¡å—ä»¥åŠåµŒå¥—æ¨¡å—</span><br><span class="line">    â”‚   â””â”€â”€ module.js   // å®šä¹‰Moduleç±»ï¼Œå­˜å‚¨æ¨¡å—å†…çš„ä¸€äº›ä¿¡æ¯ï¼Œä¾‹å¦‚: state...</span><br><span class="line">    â”‚</span><br><span class="line">    â”œâ”€â”€ plugins   // ä¸€äº›æ’ä»¶</span><br><span class="line">    â”‚   â”œâ”€â”€ devtool.js   // å¼€å‘è°ƒè¯•æ’ä»¶</span><br><span class="line">    â”‚   â””â”€â”€ logger.js    // </span><br><span class="line">    â”‚</span><br><span class="line">    â”œâ”€â”€ helpers.js       // è¾…åŠ©å‡½æ•°ï¼Œä¾‹å¦‚ï¼šmapStateã€mapGettersã€mapMutations...</span><br><span class="line">    â”œâ”€â”€ index.cjs.js     // commonjs æ‰“åŒ…å…¥å£</span><br><span class="line">    â”œâ”€â”€ index.js         // å…¥å£æ–‡ä»¶</span><br><span class="line">    â”œâ”€â”€ index.mjs        // es6 module æ‰“åŒ…å…¥å£</span><br><span class="line">    â”œâ”€â”€ mixin.js         // å°†vuexå®ä¾‹æŒ‚è½½åˆ°å…¨å±€Vueçš„$storeä¸Š</span><br><span class="line">    â”œâ”€â”€ store.js         // æ ¸å¿ƒæ–‡ä»¶ï¼Œå®šä¹‰äº†Storeç±»</span><br><span class="line">    â””â”€â”€ util.js          // æä¾›ä¸€äº›å·¥å…·å‡½æ•°ï¼Œä¾‹å¦‚: deepCopyã€isPromiseã€isObject...</span><br></pre></td></tr></table></figure>

<h2 id="2-æºç é˜…è¯»"><a href="#2-æºç é˜…è¯»" class="headerlink" title="2. æºç é˜…è¯»"></a>2. æºç é˜…è¯»</h2><h3 id="1-æŸ¥çœ‹å·¥å…·å‡½æ•°"><a href="#1-æŸ¥çœ‹å·¥å…·å‡½æ•°" class="headerlink" title="1. æŸ¥çœ‹å·¥å…·å‡½æ•°"></a>1. æŸ¥çœ‹å·¥å…·å‡½æ•°</h3><p>é¦–å…ˆæˆ‘ä¸ªäººè§‰å¾—è‚¯å®šæ˜¯è¦çœ‹ä¸€ä¸‹ <code>util.js</code> ï¼Œè¿™é‡Œé¢å­˜æ”¾çš„æ˜¯æºç ä¸­é¢‘ç¹ç”¨åˆ°çš„å·¥å…·å‡½æ•°ï¼Œæ‰€ä»¥æˆ‘è§‰å¾—è¦æœ€å…ˆäº†è§£ä¸€ä¸‹æ¯ä¸ªå‡½æ•°çš„ä½œç”¨æ˜¯ä»€ä¹ˆ</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Get the first item that pass the test</span></span><br><span class="line"><span class="comment"> * by second argument function</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">Array</span>&#125; <span class="variable">list</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">Function</span>&#125; <span class="variable">f</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> &#123;<span class="type">*</span>&#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// æ‰¾åˆ°æ•°ç»„listä¸­ç¬¬ä¸€ä¸ªç¬¦åˆè¦æ±‚çš„å…ƒç´ </span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">find</span> (list, f) &#123;</span><br><span class="line">  <span class="keyword">return</span> list.<span class="title function_">filter</span>(f)[<span class="number">0</span>]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ·±æ‹·è´</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">*</span>&#125; <span class="variable">obj</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">Array&lt;Object&gt;</span>&#125; <span class="variable">cache</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> &#123;<span class="type">*</span>&#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">deepCopy</span> (obj, cache = []) &#123;</span><br><span class="line">  <span class="comment">// just return if obj is immutable value</span></span><br><span class="line">  <span class="keyword">if</span> (obj === <span class="literal">null</span> || <span class="keyword">typeof</span> obj !== <span class="string">&#x27;object&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> obj</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// if obj is hit, it is in circular structure</span></span><br><span class="line">  <span class="keyword">const</span> hit = <span class="title function_">find</span>(cache, <span class="function"><span class="params">c</span> =&gt;</span> c.<span class="property">original</span> === obj)</span><br><span class="line">  <span class="keyword">if</span> (hit) &#123;</span><br><span class="line">    <span class="keyword">return</span> hit.<span class="property">copy</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> copy = <span class="title class_">Array</span>.<span class="title function_">isArray</span>(obj) ? [] : &#123;&#125;</span><br><span class="line">  <span class="comment">// put the copy into cache at first</span></span><br><span class="line">  <span class="comment">// because we want to refer it in recursive deepCopy</span></span><br><span class="line">  cache.<span class="title function_">push</span>(&#123;</span><br><span class="line">    <span class="attr">original</span>: obj,</span><br><span class="line">    copy</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="title class_">Object</span>.<span class="title function_">keys</span>(obj).<span class="title function_">forEach</span>(<span class="function"><span class="params">key</span> =&gt;</span> &#123;</span><br><span class="line">    copy[key] = <span class="title function_">deepCopy</span>(obj[key], cache)</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> copy</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// éå†objå¯¹è±¡çš„æ¯ä¸ªå±æ€§çš„å€¼</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">forEachValue</span> (obj, fn) &#123;</span><br><span class="line">  <span class="title class_">Object</span>.<span class="title function_">keys</span>(obj).<span class="title function_">forEach</span>(<span class="function"><span class="params">key</span> =&gt;</span> <span class="title function_">fn</span>(obj[key], key))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ¤æ–­æ˜¯å¦ä¸ºå¯¹è±¡ï¼ˆæ’é™¤nullï¼‰</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">isObject</span> (obj) &#123;</span><br><span class="line">  <span class="keyword">return</span> obj !== <span class="literal">null</span> &amp;&amp; <span class="keyword">typeof</span> obj === <span class="string">&#x27;object&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ¤æ–­æ˜¯å¦ä¸ºPromiseå¯¹è±¡</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">isPromise</span> (val) &#123;</span><br><span class="line">  <span class="keyword">return</span> val &amp;&amp; <span class="keyword">typeof</span> val.<span class="property">then</span> === <span class="string">&#x27;function&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ–­è¨€</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">assert</span> (condition, msg) &#123;</span><br><span class="line">  <span class="keyword">if</span> (!condition) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">`[vuex] <span class="subst">$&#123;msg&#125;</span>`</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¿ç•™åŸå§‹å‚æ•°çš„é—­åŒ…å‡½æ•°</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">partial</span> (fn, arg) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">fn</span>(arg)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ¯ä¸ªå‡½æ•°çš„ä½œç”¨æˆ‘éƒ½å†™ä¸Šäº†æ³¨é‡Šï¼Œç¨å¾®é˜…è¯»ä¸€ä¸‹åº”è¯¥å¯ä»¥æ˜ç™½å…¶ä½œç”¨</p>
<h3 id="2-å…¥å£æ–‡ä»¶"><a href="#2-å…¥å£æ–‡ä»¶" class="headerlink" title="2. å…¥å£æ–‡ä»¶"></a>2. å…¥å£æ–‡ä»¶</h3><p>æœ€ä¸»è¦çš„ä»£ç éƒ½åœ¨ <code>src</code> ç›®å½•ä¸‹ï¼Œæ‰€ä»¥ä»¥ä¸‹æåˆ°çš„æ–‡ä»¶éƒ½æ˜¯é»˜è®¤ <code>src</code> ç›®å½•ä¸‹çš„æ–‡ä»¶</p>
<p>é¦–å…ˆï¼Œè‚¯å®šä»å…¥å£æ–‡ä»¶ <code>index.js</code> å¼€å§‹çœ‹ï¼Œä½†èƒ½å‘ç°çš„æ˜¯ï¼Œè¿˜æœ‰ <code>index.cjs</code> å’Œ <code>index.mjs</code> ï¼Œè¿™ä¸¤è€…åˆ†åˆ«æ˜¯ <code>commonjs</code> å’Œ <code>es6 module</code> çš„æ‰“åŒ…å…¥å£ï¼Œæˆ‘ä»¬å°±ä¸ç”¨ç®¡äº†</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Store</span>, install &#125; <span class="keyword">from</span> <span class="string">&#x27;./store&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; mapState, mapMutations, mapGetters, mapActions, createNamespacedHelpers &#125; <span class="keyword">from</span> <span class="string">&#x27;./helpers&#x27;</span></span><br><span class="line"><span class="keyword">import</span> createLogger <span class="keyword">from</span> <span class="string">&#x27;./plugins/logger&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="title class_">Store</span>,</span><br><span class="line">  install,</span><br><span class="line">  <span class="attr">version</span>: <span class="string">&#x27;__VERSION__&#x27;</span>,</span><br><span class="line">  mapState,</span><br><span class="line">  mapMutations,</span><br><span class="line">  mapGetters,</span><br><span class="line">  mapActions,</span><br><span class="line">  createNamespacedHelpers,</span><br><span class="line">  createLogger</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> &#123;</span><br><span class="line">  <span class="title class_">Store</span>,</span><br><span class="line">  install,</span><br><span class="line">  mapState,</span><br><span class="line">  mapMutations,</span><br><span class="line">  mapGetters,</span><br><span class="line">  mapActions,</span><br><span class="line">  createNamespacedHelpers,</span><br><span class="line">  createLogger</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä»å…¥å£æ–‡ä»¶ä¸­å¯ä»¥çœ‹åˆ°ï¼Œä¸»è¦å¯¼å‡ºäº† <code>Store</code> ç±» ã€<code>install</code> æ–¹æ³•ä»¥åŠä¸€äº›è¾…åŠ©å‡½æ•°ï¼ˆmapStateã€mapMutationsã€mapGettersâ€¦ï¼‰</p>
<p>é‚£ä¹ˆæˆ‘ä»¬ä¸»è¦çœ‹çš„å°±æ˜¯ <code>vuex</code> çš„æ ¸å¿ƒä»£ç ï¼Œå³ <code>store.js</code> ï¼Œå¯ä»¥çœ‹åˆ° <code>Store</code> ç±»å°±å‡ºè‡ªäºè¿™ä¸ªæ–‡ä»¶</p>
<h3 id="3-Store-ç±»çš„å®ç°"><a href="#3-Store-ç±»çš„å®ç°" class="headerlink" title="3. Store ç±»çš„å®ç°"></a>3. Store ç±»çš„å®ç°</h3><p>æ•´ä¸ª <code>Store</code> ç±»çš„ä¸»è¦é€»è¾‘éƒ½åœ¨å®ƒçš„æ„é€ å‡½æ•° <code>constructor</code> ä¸­ï¼Œå› æ­¤æˆ‘ä»¬å°±ä» <code>constructor</code> ä¸­åˆ†æ­¥å»æ‹é€»è¾‘ã€çœ‹ä»£ç </p>
<h4 id="3-1-å­˜æ”¾ç±»çš„çŠ¶æ€"><a href="#3-1-å­˜æ”¾ç±»çš„çŠ¶æ€" class="headerlink" title="3.1 å­˜æ”¾ç±»çš„çŠ¶æ€"></a>3.1 å­˜æ”¾ç±»çš„çŠ¶æ€</h4><p>é¦–å…ˆæ˜¯å®šä¹‰äº†ä¸€äº›å®ä¾‹çŠ¶æ€ï¼Œç”¨äºå­˜æ”¾æ¨¡å—ã€<code>mutations</code> ã€<code>actions</code> ã€<code>getters</code> ç¼“å­˜ç­‰ä¸œè¥¿</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123;</span><br><span class="line">  plugins = [],</span><br><span class="line">  strict = <span class="literal">false</span></span><br><span class="line">&#125; = options      <span class="comment">// ç”ŸæˆStoreç±»çš„å…¥å‚</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">this</span>.<span class="property">_committing</span> = <span class="literal">false</span>        <span class="comment">// è¡¨ç¤ºæäº¤çš„çŠ¶æ€ï¼Œå½“é€šè¿‡mutationsæ–¹æ³•æ”¹å˜stateæ—¶ï¼Œè¯¥çŠ¶æ€ä¸ºtrueï¼Œstateå€¼æ”¹å˜å®Œåï¼Œè¯¥çŠ¶æ€å˜ä¸ºfalse; åœ¨ä¸¥æ ¼æ¨¡å¼ä¸‹ä¼šç›‘å¬stateå€¼çš„æ”¹å˜ï¼Œå½“æ”¹å˜æ—¶ï¼Œ_committingä¸ºfalseæ—¶ï¼Œä¼šå‘å‡ºè­¦å‘Šï¼Œå³è¡¨æ˜stateå€¼çš„æ”¹å˜ä¸æ˜¯ç»è¿‡mutationsçš„</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">this</span>.<span class="property">_actions</span> = <span class="title class_">Object</span>.<span class="title function_">create</span>(<span class="literal">null</span>)  <span class="comment">// ç”¨äºè®°å½•æ‰€æœ‰å­˜åœ¨çš„actionsæ–¹æ³•åç§°ï¼ˆåŒ…æ‹¬å…¨å±€çš„å’Œå‘½åç©ºé—´å†…çš„ï¼Œä¸”å…è®¸é‡å¤å®šä¹‰ï¼‰      </span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">this</span>.<span class="property">_actionSubscribers</span> = []       <span class="comment">// å­˜æ”¾actionsæ–¹æ³•è®¢é˜…çš„å›è°ƒå‡½æ•°</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">this</span>.<span class="property">_mutations</span> = <span class="title class_">Object</span>.<span class="title function_">create</span>(<span class="literal">null</span>)  <span class="comment">// ç”¨äºè®°å½•æ‰€æœ‰å­˜åœ¨çš„çš„mutationsæ–¹æ³•åç§°ï¼ˆåŒ…æ‹¬å…¨å±€çš„å’Œå‘½åç©ºé—´å†…çš„ï¼Œä¸”å…è®¸é‡å¤å®šä¹‰ï¼‰</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">this</span>.<span class="property">_wrappedGetters</span> = <span class="title class_">Object</span>.<span class="title function_">create</span>(<span class="literal">null</span>)  <span class="comment">// æ”¶é›†æ‰€æœ‰æ¨¡å—åŒ…è£…åçš„çš„gettersï¼ˆåŒ…æ‹¬å…¨å±€çš„å’Œå‘½åç©ºé—´å†…çš„ï¼Œä½†ä¸å…è®¸é‡å¤å®šä¹‰ï¼‰</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">this</span>.<span class="property">_modules</span> = <span class="keyword">new</span> <span class="title class_">ModuleCollection</span>(options)  <span class="comment">// æ ¹æ®ä¼ å…¥çš„optionsé…ç½®ï¼Œæ³¨å†Œå„ä¸ªæ¨¡å—ï¼Œæ­¤æ—¶åªæ˜¯æ³¨å†Œã€å»ºç«‹å¥½äº†å„ä¸ªæ¨¡å—çš„å…³ç³»ï¼Œå·²ç»å®šä¹‰äº†å„ä¸ªæ¨¡å—çš„stateçŠ¶æ€ï¼Œä½†gettersã€mutationsç­‰æ–¹æ³•æš‚æœªæ³¨å†Œ</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">this</span>.<span class="property">_modulesNamespaceMap</span> = <span class="title class_">Object</span>.<span class="title function_">create</span>(<span class="literal">null</span>)   <span class="comment">// å­˜å‚¨å®šä¹‰äº†å‘½åç©ºé—´çš„æ¨¡å—</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">this</span>.<span class="property">_subscribers</span> = []    <span class="comment">// å­˜æ”¾mutationsæ–¹æ³•è®¢é˜…çš„å›è°ƒ</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">this</span>.<span class="property">_watcherVM</span> = <span class="keyword">new</span> <span class="title class_">Vue</span>()  <span class="comment">// ç”¨äºç›‘å¬stateã€getters</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">this</span>.<span class="property">_makeLocalGettersCache</span> = <span class="title class_">Object</span>.<span class="title function_">create</span>(<span class="literal">null</span>)   <span class="comment">// gettersçš„æœ¬åœ°ç¼“å­˜</span></span><br></pre></td></tr></table></figure>

<p>å…³äºå„ä¸ªå˜é‡çŠ¶æ€çš„ä½œç”¨éƒ½å†™åœ¨è¿™äº†ï¼Œå…¶ä¸­åªæœ‰ <code>this._modules = new ModuleCollection(option)</code> æ‰§è¡Œäº†ä¸€äº›æ“ä½œï¼Œå…¶ä½œç”¨å°±æ˜¯è¿›è¡Œ<strong>æ¨¡å—é€’å½’æ”¶é›†</strong>ï¼Œæ ¹æ® <code>ModuleCollection</code> çš„æ¥æºï¼Œæˆ‘ä»¬ç§»æ­¥åˆ° <code>./module/module-collection.js</code> æ–‡ä»¶</p>
<h5 id="3-1-1-é€’å½’æ”¶é›†æ¨¡å—"><a href="#3-1-1-é€’å½’æ”¶é›†æ¨¡å—" class="headerlink" title="3.1.1 é€’å½’æ”¶é›†æ¨¡å—"></a>3.1.1 é€’å½’æ”¶é›†æ¨¡å—</h5><p>åœ¨ <code>Module-collection.js</code> æ–‡ä»¶ä¸­å®šä¹‰äº† <code>ModuleCollection</code> ç±»ï¼Œå…¶ä½œç”¨å°±æ˜¯é€šè¿‡é€’å½’éå† <code>options</code> å…¥å‚ï¼Œå°†æ¯ä¸ªæ¨¡å—éƒ½ç”Ÿæˆä¸€ä¸ªç‹¬ç«‹çš„ <code>Moudle</code></p>
<p>è¿™é‡Œå…ˆæ¥ç†Ÿæ‚‰ä¸€ä¸‹ <code>options</code> çš„ç»“æ„ï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Vuex</span> <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> options = &#123;</span><br><span class="line">  <span class="attr">state</span>: &#123;...&#125;,</span><br><span class="line">  <span class="attr">getters</span>: &#123;...&#125;,</span><br><span class="line">  <span class="attr">mutations</span>: &#123;...&#125;,</span><br><span class="line">  <span class="attr">actions</span>: &#123;...&#125;,</span><br><span class="line">  <span class="attr">modules</span>: &#123;</span><br><span class="line">    <span class="title class_">ModuleA</span>: &#123;</span><br><span class="line">      <span class="attr">state</span>: &#123;...&#125;,</span><br><span class="line">      ...</span><br><span class="line">      <span class="attr">modules</span>: &#123;</span><br><span class="line">        <span class="title class_">ModuleA1</span>: &#123;...&#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title class_">ModuleB</span>: &#123;</span><br><span class="line">      <span class="attr">state</span>: &#123;...&#125;,</span><br><span class="line">      ...</span><br><span class="line">      <span class="attr">modules</span>: &#123;</span><br><span class="line">        <span class="title class_">ModuleB1</span>: &#123;...&#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> store = <span class="keyword">new</span> <span class="title class_">Vuex</span>.<span class="title class_">Store</span>(options)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> store</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°ä¼ å…¥çš„ <code>options</code> æ•´ä½“å¯ä»¥çœ‹æˆä¸€ä¸ªæ ¹æ¨¡å— <code>root</code> ï¼Œç„¶å <code>root</code> çš„ <code>modules</code> ä¸­åµŒå¥—ç€å¦å¤–ä¸¤ä¸ªå­æ¨¡å—ï¼š<code>ModuleA</code> å’Œ <code>ModuleB</code> ï¼Œè€Œ <code>ModuleA</code> å’Œ <code>ModuleB</code> å†…éƒ¨ä¹Ÿåˆ†åˆ«åµŒå¥—ç€ä¸€ä¸ªå­æ¨¡å—ï¼Œåˆ†åˆ«ä¸º <code>ModuleA1</code> ã€<code>ModuleB1</code> ã€‚è¿™æ ·å°±ç»„æˆäº†ä¸€ä¸ªæ¨¡å—æ ‘ï¼Œå› æ­¤ <code>ModuleCollection</code> ç±»çš„å·¥ä½œå°±æ˜¯å°†ä¿ç•™åŸæ¥çš„æ¨¡å—å…³ç³»ï¼Œå°†æ¯ä¸ªæ¨¡å—å°è£…åˆ°ä¸€ä¸ª <code>Module</code> ç±»ä¸­</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> <span class="title class_">ModuleCollection</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span> (rawRootModule) &#123;</span><br><span class="line">    <span class="comment">// é€’å½’æ³¨å†Œæ¨¡å—</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">register</span>([], rawRootModule, <span class="literal">false</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// æ ¹æ®è·¯å¾„é¡ºåºï¼Œä»æ ¹æ¨¡å—å¼€å§‹é€’å½’è·å–åˆ°æˆ‘ä»¬å‡†å¤‡æ·»åŠ æ–°çš„æ¨¡å—çš„çˆ¶æ¨¡å—</span></span><br><span class="line">  get (path) &#123;</span><br><span class="line">    <span class="keyword">return</span> path.<span class="title function_">reduce</span>(<span class="function">(<span class="params"><span class="variable language_">module</span>, key</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="variable language_">module</span>.<span class="title function_">getChild</span>(key)</span><br><span class="line">    &#125;, <span class="variable language_">this</span>.<span class="property">root</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// é€’å½’æ³¨å†Œæ¨¡å—</span></span><br><span class="line">  register (path, rawModule, runtime = <span class="literal">true</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (__DEV__) &#123;</span><br><span class="line">      <span class="title function_">assertRawModule</span>(path, rawModule)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">const</span> newModule = <span class="keyword">new</span> <span class="title class_">Module</span>(rawModule, runtime)  <span class="comment">// åˆå§‹åŒ–ä¸€ä¸ªæ–°çš„æ¨¡å—</span></span><br><span class="line">    <span class="keyword">if</span> (path.<span class="property">length</span> === <span class="number">0</span>) &#123;    <span class="comment">// å½“å‰æ²¡æœ‰åˆ«çš„æ¨¡å—</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">root</span> = newModule     <span class="comment">// åˆ™æ­¤æ¨¡å—ä¸ºæ ¹æ¨¡å—</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;    <span class="comment">// æœ‰å¤šä¸ªæ¨¡å—     </span></span><br><span class="line">      <span class="keyword">const</span> parent = <span class="variable language_">this</span>.<span class="title function_">get</span>(path.<span class="title function_">slice</span>(<span class="number">0</span>, -<span class="number">1</span>))   <span class="comment">// è·å–åˆ°æ–°æ¨¡å—ä»å±çš„çˆ¶æ¨¡å—ï¼Œæ‰€ä»¥æ˜¯path.slice(0, -1)ï¼Œæœ€åä¸€ä¸ªå…ƒç´ å°±æ˜¯æˆ‘ä»¬è¦æ·»åŠ çš„å­æ¨¡å—çš„åç§°</span></span><br><span class="line">      parent.<span class="title function_">addChild</span>(path[path.<span class="property">length</span> - <span class="number">1</span>], newModule)    <span class="comment">// åœ¨çˆ¶æ¨¡å—ä¸­æ·»åŠ æ–°çš„å­æ¨¡å—</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (rawModule.<span class="property">modules</span>) &#123;     <span class="comment">// å¦‚æœæœ‰åµŒå¥—æ¨¡å—</span></span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       *  1. éå†æ‰€æœ‰çš„å­æ¨¡å—ï¼Œå¹¶è¿›è¡Œæ³¨å†Œ;</span></span><br><span class="line"><span class="comment">       *  2. åœ¨pathä¸­å­˜å‚¨é™¤äº†æ ¹æ¨¡å—ä»¥å¤–æ‰€æœ‰å­æ¨¡å—çš„åç§°</span></span><br><span class="line"><span class="comment">       *  */</span> </span><br><span class="line">      <span class="title function_">forEachValue</span>(rawModule.<span class="property">modules</span>, <span class="function">(<span class="params">rawChildModule, key</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">register</span>(path.<span class="title function_">concat</span>(key), rawChildModule, runtime)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>å‡½æ•°ä½œç”¨ï¼š</strong></p>
<ol>
<li><code>register(path, rawModule, runtime)</code>ï¼šæ³¨å†Œæ–°çš„æ¨¡å—ï¼Œå¹¶æ ¹æ®æ¨¡å—çš„åµŒå¥—å…³ç³»ï¼Œå°†æ–°æ¨¡å—æ·»åŠ ä½œä¸ºå¯¹åº”æ¨¡å—çš„å­æ¨¡å—</li>
</ol>
<ul>
<li>pathï¼šè¡¨ç¤ºæ¨¡å—åµŒå¥—å…³ç³»ã€‚å½“å‰ä¸ºæ ¹æ¨¡å—æ—¶ï¼Œæ²¡æœ‰ä»»ä½•åµŒå¥—å…³ç³»ï¼Œæ­¤æ—¶ <code>path = []</code> ; å½“å‰ä¸æ˜¯æ ¹æ¨¡å—æ—¶ï¼Œå­˜åœ¨åµŒå¥—å…³ç³»ï¼Œä¾‹å¦‚ä¸Šè¿°ä¾‹å­ä¸­çš„ <code>ModuleA1</code> ï¼Œå®ƒæ˜¯ <code>ModuleA</code> çš„å­æ¨¡å— ï¼Œè€Œ <code>ModuleA</code> åˆæ˜¯æ ¹æ¨¡å—çš„å­æ¨¡å—ï¼Œæ­¤æ—¶ <code>path = [&#39;ModuleA&#39;, &#39;ModuleA1&#39;]</code></li>
<li>rawModuleï¼šè¡¨ç¤ºæ¨¡å—å¯¹è±¡ï¼Œæ­¤æ—¶æ˜¯ä¸€ä¸ªå¯¹è±¡ç±»å‹</li>
<li>runtimeï¼šè¡¨ç¤ºç¨‹åºè¿è¡Œæ—¶</li>
</ul>
<ol start="2">
<li><code>get(path)</code>ï¼šæ ¹æ®ä¼ å…¥çš„ <code>path</code> è·¯å¾„ï¼Œè·å–åˆ°æˆ‘ä»¬æƒ³è¦çš„ <code>Module</code> ç±»</li>
</ol>
<p><code>ModuleCollection</code> çš„æ„é€ å‡½æ•°ä¸­è°ƒç”¨äº† <code>register</code> å‡½æ•°ï¼Œå‰ä¸¤ä¸ªå‚æ•°åˆ†åˆ«ä¸ºï¼š<code>[]</code> ã€<code>rawRootModule</code> ï¼Œæ­¤æ—¶è‚¯å®šæ˜¯ä»æ ¹æ¨¡å—å¼€å§‹æ³¨å†Œçš„ï¼Œæ‰€ä»¥ <code>path</code> é‡Œæ— å†…å®¹ï¼Œå¹¶ä¸” <code>rawRootModule</code> æŒ‡å‘çš„æ˜¯æ ¹æ¨¡å—</p>
<p>ç„¶åæ¥çœ‹ä¸€ä¸‹ <code>register</code> å‡½æ•°é‡Œçš„é€»è¾‘ã€‚</p>
<ol>
<li>é¦–å…ˆå°†å½“å‰è¦æ³¨å†Œçš„æ¨¡å—ç”Ÿæˆä¸€ä¸ª <code>Module</code> ï¼Œå¹¶å°† <code>rawModule</code> ä½œä¸ºå‚æ•°ï¼Œç”¨äºå­˜æ”¾ <code>Module</code> çš„ä¿¡æ¯</li>
<li>ç„¶åé€šè¿‡ <code>if(path.length === 0)</code> åˆ¤æ–­æ˜¯å¦ä¸ºæ ¹æ¨¡å—ï¼Œæ˜¯çš„è¯å°±å°† <code>this.root</code> æŒ‡å‘ <code>Module</code> ; å¦åˆ™å°±è·³åˆ°ç¬¬3æ­¥</li>
<li>åˆ¤æ–­å½“å‰æ¨¡å—ä¸æ˜¯æ ¹æ¨¡å—ï¼Œå°±é€šè¿‡ <code>get</code> å‡½æ•°æ‰¾åˆ°å½“å‰æ¨¡å—çš„çˆ¶æ¨¡å—ï¼Œç„¶åè°ƒç”¨çˆ¶æ¨¡å—ä¸­çš„ <code>addChild</code> æ–¹æ³•å°†å½“å‰æ¨¡å—æ·»åŠ åˆ°å­æ¨¡å—ä¸­</li>
<li>æœ€åå†åˆ¤æ–­å½“å‰æ¨¡å—æ˜¯å¦è¿˜æœ‰åµŒå¥—çš„æ¨¡å—ï¼Œæœ‰çš„è¯å°±é‡æ–°å›åˆ°ç¬¬1æ­¥è¿›è¡Œé€’å½’æ“ä½œ ; å¦åˆ™ä¸åšä»»ä½•å¤„ç†</li>
</ol>
<p>æŒ‰ç…§ä¸Šé¢çš„é€»è¾‘ï¼Œå°±å¯ä»¥å°†æ‰€æœ‰çš„æ¨¡å—é€’å½’æ”¶é›†å¹¶æ³¨å†Œå¥½äº†ï¼Œå…¶ä¸­æœ‰ä¸€ä¸ª <code>Module</code> ç±»è¿˜æ²¡æœ‰å…·ä½“æåˆ°ï¼Œæ‰€ä»¥è¿™é‡Œç§»æ­¥åˆ° <code>./module/module.js</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; forEachValue &#125; <span class="keyword">from</span> <span class="string">&#x27;../util&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å®šä¹‰äº†Vuexä¸­çš„ Module ç±»ï¼ŒåŒ…å«äº†stateã€mutationsã€gettersã€actionsã€modules</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> <span class="title class_">Module</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span> (rawModule, runtime) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">runtime</span> = runtime</span><br><span class="line">    </span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">_children</span> = <span class="title class_">Object</span>.<span class="title function_">create</span>(<span class="literal">null</span>)   <span class="comment">// åˆ›å»ºä¸€ä¸ªç©ºå¯¹è±¡ï¼Œç”¨äºå­˜æ”¾å½“å‰æ¨¡å—çš„å­æ¨¡å—</span></span><br><span class="line">    </span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">_rawModule</span> = rawModule         <span class="comment">// å½“å‰æ¨¡å—çš„ä¸€äº›ä¿¡æ¯ï¼Œä¾‹å¦‚ï¼šstateã€mutationsã€gettersã€actionsã€modules</span></span><br><span class="line">    <span class="keyword">const</span> rawState = rawModule.<span class="property">state</span>    <span class="comment">// 1. å‡½æ•°ç±»å‹ =&gt; è¿”å›ä¸€ä¸ªobjå¯¹è±¡; 2. ç›´æ¥è·å–åˆ°objå¯¹è±¡</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// å­˜å‚¨å½“å‰æ¨¡å—çš„stateçŠ¶æ€</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">state</span> = (<span class="keyword">typeof</span> rawState === <span class="string">&#x27;function&#x27;</span> ? <span class="title function_">rawState</span>() : rawState) || &#123;&#125;   </span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// åˆ¤æ–­è¯¥æ¨¡å—æ˜¯å¦å®šä¹‰äº†namespacedï¼Œå®šä¹‰äº†åˆ™è¿”å›true; å¦åˆ™è¿”å›false</span></span><br><span class="line">  get namespaced () &#123;</span><br><span class="line">    <span class="keyword">return</span> !!<span class="variable language_">this</span>.<span class="property">_rawModule</span>.<span class="property">namespaced</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æ·»åŠ å­æ¨¡å—ï¼Œåç§°ä¸ºkey</span></span><br><span class="line">  addChild (key, <span class="variable language_">module</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">_children</span>[key] = <span class="variable language_">module</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ç§»é™¤åç§°ä¸ºkeyçš„å­æ¨¡å—</span></span><br><span class="line">  removeChild (key) &#123;</span><br><span class="line">    <span class="keyword">delete</span> <span class="variable language_">this</span>.<span class="property">_children</span>[key]</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// è·å–åç§°ä¸ºkeyçš„å­æ¨¡å—</span></span><br><span class="line">  getChild (key) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">_children</span>[key]</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æ˜¯å¦å­˜åœ¨åç§°ä¸ºkeyçš„å­æ¨¡å—</span></span><br><span class="line">  hasChild (key) &#123;</span><br><span class="line">    <span class="keyword">return</span> key <span class="keyword">in</span> <span class="variable language_">this</span>.<span class="property">_children</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å°†å½“å‰æ¨¡å—çš„å‘½åç©ºé—´æ›´æ–°åˆ°æŒ‡å®šæ¨¡å—çš„å‘½åç©ºé—´ä¸­ï¼Œå¹¶åŒæ—¶æ›´æ–°ä¸€ä¸‹actionsã€mutationsã€gettersçš„è°ƒç”¨æ¥æº</span></span><br><span class="line">  update (rawModule) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">_rawModule</span>.<span class="property">namespaced</span> = rawModule.<span class="property">namespaced</span></span><br><span class="line">    <span class="keyword">if</span> (rawModule.<span class="property">actions</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">_rawModule</span>.<span class="property">actions</span> = rawModule.<span class="property">actions</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (rawModule.<span class="property">mutations</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">_rawModule</span>.<span class="property">mutations</span> = rawModule.<span class="property">mutations</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (rawModule.<span class="property">getters</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">_rawModule</span>.<span class="property">getters</span> = rawModule.<span class="property">getters</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// éå†å½“å‰æ¨¡å—çš„æ‰€æœ‰å­æ¨¡å—ï¼Œå¹¶æ‰§è¡Œå›è°ƒæ“ä½œ</span></span><br><span class="line">  forEachChild (fn) &#123;</span><br><span class="line">    <span class="title function_">forEachValue</span>(<span class="variable language_">this</span>.<span class="property">_children</span>, fn)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// éå†å½“å‰æ¨¡å—çš„æ‰€æœ‰gettersï¼Œå¹¶æ‰§è¡Œå›è°ƒæ“ä½œ</span></span><br><span class="line">  forEachGetter (fn) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">_rawModule</span>.<span class="property">getters</span>) &#123;</span><br><span class="line">      <span class="title function_">forEachValue</span>(<span class="variable language_">this</span>.<span class="property">_rawModule</span>.<span class="property">getters</span>, fn)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// éå†å½“å‰æ¨¡å—çš„æ‰€æœ‰actionsï¼Œå¹¶æ‰§è¡Œå›è°ƒæ“ä½œ</span></span><br><span class="line">  forEachAction (fn) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">_rawModule</span>.<span class="property">actions</span>) &#123;</span><br><span class="line">      <span class="title function_">forEachValue</span>(<span class="variable language_">this</span>.<span class="property">_rawModule</span>.<span class="property">actions</span>, fn)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// éå†å½“å‰æ¨¡å—çš„æ‰€æœ‰mutationsï¼Œå¹¶æ‰§è¡Œå›è°ƒæ“ä½œ</span></span><br><span class="line">  forEachMutation (fn) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">_rawModule</span>.<span class="property">mutations</span>) &#123;</span><br><span class="line">      <span class="title function_">forEachValue</span>(<span class="variable language_">this</span>.<span class="property">_rawModule</span>.<span class="property">mutations</span>, fn)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ¥çœ‹ä¸€ä¸‹åˆšæ‰æ¨¡å—æ”¶é›†æ—¶ï¼Œåˆ›å»ºçš„ <code>Module</code> ç±»å†…éƒ¨åšäº†ä»€ä¹ˆäº‹æƒ…ï¼ŒåŒæ ·çš„ä» <code>constructor</code> ä¸­å¼€å§‹çœ‹</p>
<p><code>this._children</code> æ˜¯ä¸€ä¸ªå¯¹è±¡å€¼ï¼Œç”¨äºå­˜æ”¾è¯¥æ¨¡å—åµŒå¥—çš„å…¶å®ƒ <code>Module</code> ç±» ;</p>
<p><code>this._rawModule</code> å°±æ˜¯ç”¨äºå­˜æ”¾è¯¥æ¨¡å—å†…éƒ¨çš„ä¸€äº›ä¿¡æ¯ï¼Œä¾‹å¦‚ï¼š<code>state</code> ã€<code>mutations</code> ã€<code>actions</code> ã€<code>getters</code> ã€<code>moudles</code> ;</p>
<p><code>this.state</code> å¯¹åº”çš„å°±æ˜¯ <code>this._rawModule</code> ä¸­çš„ <code>state</code> ;</p>
<p>è¿™æ˜¯æ•´ä¸ªæ„é€ å‡½æ•°ä¸­æ‰§è¡Œçš„æ“ä½œï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œåœ¨ç”Ÿæˆä¸€ä¸ª <code>Module</code> ç±»çš„æ—¶å€™ï¼Œå…¶åªå®šä¹‰äº† <code>state</code> å±æ€§ï¼Œè€Œ <code>mutations</code> ã€<code>getters</code> ã€<code>actions</code> ã€<code>modules</code> éƒ½æ˜¯æ²¡æœ‰è¢«å®šä¹‰çš„ï¼Œå³ä¾‹å¦‚ç°åœ¨æ˜¯æ— æ³•é€šè¿‡ <code>Module.mutations</code> è·å–åˆ°è¯¥æ¨¡å—æ‰€æœ‰çš„ <code>mutations</code> æ–¹æ³•ï¼Œé‚£ä¹ˆè¿™äº›æ–¹æ³•éƒ½æ˜¯åœ¨ä½•æ—¶è¢«å®šä¹‰çš„å‘¢ï¼Ÿè‡ªç„¶æ˜¯ç­‰æ¨¡å—å…¨éƒ¨éƒ½æ”¶é›†å®Œæ¯•ä»¥åæ‰è¿›è¡Œçš„æ“ä½œï¼Œå› ä¸º <code>vuex</code> ä¸­çš„åµŒå¥—æ¨¡å—å¯èƒ½ä¼šå­˜åœ¨å‘½åç©ºé—´ <code>namespaced</code></p>
<h4 id="3-2-æ³¨å†Œæ¨¡å—"><a href="#3-2-æ³¨å†Œæ¨¡å—" class="headerlink" title="3.2 æ³¨å†Œæ¨¡å—"></a>3.2 æ³¨å†Œæ¨¡å—</h4><p>åˆ°æ­¤ä¸ºæ­¢ï¼Œå„ä¸ªæ¨¡å—çš„ç±»éƒ½åˆ›å»ºå¥½äº†ï¼Œé‚£ä¹ˆç»§ç»­å›åˆ° <code>./src/store.js</code> çš„ <code>constructor</code> æ„é€ å‡½æ•°ä¸­</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å°† dispatch å’Œ commit æ–¹æ³•ç»‘å®šåˆ° Store çš„å®ä¾‹ä¸Šï¼Œé¿å…åç»­ä½¿ç”¨dispatchæˆ–commitæ—¶æ”¹å˜äº†thisæŒ‡å‘</span></span><br><span class="line"><span class="keyword">const</span> store = <span class="variable language_">this</span></span><br><span class="line"><span class="keyword">const</span> &#123; dispatch, commit &#125; = <span class="variable language_">this</span></span><br><span class="line"><span class="variable language_">this</span>.<span class="property">dispatch</span> = <span class="keyword">function</span> <span class="title function_">boundDispatch</span> (type, payload) &#123;</span><br><span class="line">  <span class="keyword">return</span> dispatch.<span class="title function_">call</span>(store, type, payload)</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">this</span>.<span class="property">commit</span> = <span class="keyword">function</span> <span class="title function_">boundCommit</span> (type, payload, options) &#123;</span><br><span class="line">  <span class="keyword">return</span> commit.<span class="title function_">call</span>(store, type, payload, options)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ¤æ–­storeæ˜¯å¦æœªä¸¥æ ¼æ¨¡å¼ã€‚true: æ‰€æœ‰çš„stateéƒ½å¿…é¡»ç»è¿‡mutationsæ¥æ”¹å˜</span></span><br><span class="line"><span class="variable language_">this</span>.<span class="property">strict</span> = strict</span><br><span class="line"></span><br><span class="line"><span class="comment">// å°†æ ¹æ¨¡å—çš„stateèµ‹å€¼ç»™stateå˜é‡</span></span><br><span class="line"><span class="keyword">const</span> state = <span class="variable language_">this</span>.<span class="property">_modules</span>.<span class="property">root</span>.<span class="property">state</span></span><br></pre></td></tr></table></figure>

<p>è¿™æ®µä»£ç é¦–å…ˆå¯¹ <code>Store</code> å®ä¾‹ä¸Šçš„ <code>dispatch</code> å’Œ <code>commit</code> æ–¹æ³•è¿›è¡Œäº†ä¸€å±‚åŒ…è£…ï¼Œå³é€šè¿‡ <code>call</code> å°†è¿™ä¸¤ä¸ªæ–¹æ³•çš„ä½œç”¨å¯¹è±¡æŒ‡å‘å½“å‰çš„ <code>Store</code> å®ä¾‹ï¼Œè¿™æ ·å°±èƒ½é˜²æ­¢åç»­æˆ‘ä»¬æ“ä½œæ—¶ï¼Œå‡ºç° <code>this.$store.dispatch.call(obj, 1)</code> ç±»ä¼¼çš„æƒ…å†µè€ŒæŠ¥é”™</p>
<p><code>this.strict</code> æ˜¯ç”¨äºåˆ¤æ–­æ˜¯å¦æ˜¯ä¸¥æ ¼æ¨¡å¼ã€‚å› ä¸º <code>vuex</code> ä¸­ï¼Œå»ºè®®æ‰€æœ‰çš„ <code>state</code> å˜é‡çš„å˜åŒ–éƒ½å¿…é¡»ç»è¿‡ <code>mutations</code> æ–¹æ³•ï¼Œå› ä¸ºè¿™æ ·æ‰èƒ½è¢« <code>devtool</code> æ‰€è®°å½•ä¸‹æ¥ï¼Œæ‰€ä»¥åœ¨ä¸¥æ ¼æ¨¡å¼ä¸‹ï¼Œæœªç»è¿‡ <code>mutations</code> è€Œç›´æ¥æ”¹å˜äº† <code>state</code> çš„å€¼ï¼Œå¼€å‘ç¯å¢ƒä¸‹ä¼šå‘å‡ºè­¦å‘Šâš ï¸</p>
<p><code>const state = this._modules.root.state</code> è·å–çš„æ˜¯æ ¹æ¨¡å—çš„ <code>state</code> ï¼Œç”¨äºåç»­çš„ä¸€äº›æ“ä½œ</p>
<p>ä¸€åˆ‡éƒ½å‡†å¤‡å°±ç»ªäº†ï¼Œä¸‹é¢å°±å¼€å§‹ä¸ºæ¯ä¸ªæ¨¡å—æ³¨å†Œä¿¡æ¯äº†</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä»æ ¹æ¨¡å—å¼€å§‹ï¼Œé€’å½’å®Œå–„å„ä¸ªæ¨¡å—çš„ä¿¡æ¯</span></span><br><span class="line"><span class="title function_">installModule</span>(<span class="variable language_">this</span>, state, [], <span class="variable language_">this</span>.<span class="property">_modules</span>.<span class="property">root</span>)</span><br></pre></td></tr></table></figure>

<p>è°ƒç”¨äº† <code>installModule</code> æ–¹æ³•ï¼Œå¹¶å°† <code>store</code> å®ä¾‹å¯¹è±¡ ã€<code>state</code> å±æ€§ ã€è·¯å¾„ ã€æ ¹æ¨¡å—å¯¹è±¡ä¾æ¬¡ä½œä¸ºå‚æ•°è¿›è¡Œä¼ é€’</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ³¨å†Œå®Œå–„å„ä¸ªæ¨¡å—å†…çš„ä¿¡æ¯</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">installModule</span> (store, rootState, path, <span class="variable language_">module</span>, hot) &#123;</span><br><span class="line">  <span class="keyword">const</span> isRoot = !path.<span class="property">length</span>  <span class="comment">// æ˜¯å¦ä¸ºæ ¹æ¨¡å—</span></span><br><span class="line">  <span class="keyword">const</span> namespace = store.<span class="property">_modules</span>.<span class="title function_">getNamespace</span>(path)  <span class="comment">// è·å–å½“å‰æ¨¡å—çš„å‘½åç©ºé—´ï¼Œæ ¼å¼ä¸ºï¼šsecond/ æˆ– second/third/</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// å¦‚æœå½“å‰æ¨¡å—è®¾ç½®äº†namespaced æˆ– ç»§æ‰¿äº†çˆ¶æ¨¡å—çš„namespacedï¼Œåˆ™åœ¨modulesNamespaceMapä¸­å­˜å‚¨ä¸€ä¸‹å½“å‰æ¨¡å—</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="variable language_">module</span>.<span class="property">namespaced</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (store.<span class="property">_modulesNamespaceMap</span>[namespace] &amp;&amp; __DEV__) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">`[vuex] duplicate namespace <span class="subst">$&#123;namespace&#125;</span> for the namespaced module <span class="subst">$&#123;path.join(<span class="string">&#x27;/&#x27;</span>)&#125;</span>`</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    store.<span class="property">_modulesNamespaceMap</span>[namespace] = <span class="variable language_">module</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å¦‚æœä¸æ˜¯æ ¹æ¨¡å—ï¼Œå°†å½“å‰æ¨¡å—çš„stateæ³¨å†Œåˆ°å…¶çˆ¶æ¨¡å—çš„stateä¸Š</span></span><br><span class="line">  <span class="keyword">if</span> (!isRoot &amp;&amp; !hot) &#123;</span><br><span class="line">    <span class="keyword">const</span> parentState = <span class="title function_">getNestedState</span>(rootState, path.<span class="title function_">slice</span>(<span class="number">0</span>, -<span class="number">1</span>)) <span class="comment">// è·å–çˆ¶æ¨¡å—çš„state</span></span><br><span class="line">    <span class="keyword">const</span> moduleName = path[path.<span class="property">length</span> - <span class="number">1</span>]   <span class="comment">// å½“å‰æ¨¡å—çš„åç§°</span></span><br><span class="line">    store.<span class="title function_">_withCommit</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (__DEV__) &#123;</span><br><span class="line">        <span class="keyword">if</span> (moduleName <span class="keyword">in</span> parentState) &#123;</span><br><span class="line">          <span class="variable language_">console</span>.<span class="title function_">warn</span>(</span><br><span class="line">            <span class="string">`[vuex] state field &quot;<span class="subst">$&#123;moduleName&#125;</span>&quot; was overridden by a module with the same name at &quot;<span class="subst">$&#123;path.join(<span class="string">&#x27;.&#x27;</span>)&#125;</span>&quot;`</span></span><br><span class="line">          )</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// å°†å½“å‰æ¨¡å—çš„stateæ³¨å†Œåœ¨çˆ¶æ¨¡å—çš„stateä¸Šï¼Œå¹¶ä¸”æ˜¯å“åº”å¼çš„</span></span><br><span class="line">      <span class="title class_">Vue</span>.<span class="title function_">set</span>(parentState, moduleName, <span class="variable language_">module</span>.<span class="property">state</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// è®¾ç½®å½“å‰æ¨¡å—çš„ä¸Šä¸‹æ–‡context</span></span><br><span class="line">  <span class="keyword">const</span> local = <span class="variable language_">module</span>.<span class="property">context</span> = <span class="title function_">makeLocalContext</span>(store, namespace, path)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æ³¨å†Œæ¨¡å—çš„æ‰€æœ‰mutations</span></span><br><span class="line">  <span class="variable language_">module</span>.<span class="title function_">forEachMutation</span>(<span class="function">(<span class="params">mutation, key</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> namespacedType = namespace + key     <span class="comment">// ä¾‹å¦‚ï¼šfirst/second/mutations1</span></span><br><span class="line">    <span class="title function_">registerMutation</span>(store, namespacedType, mutation, local)</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æ³¨å†Œæ¨¡å—çš„æ‰€æœ‰actions</span></span><br><span class="line">  <span class="variable language_">module</span>.<span class="title function_">forEachAction</span>(<span class="function">(<span class="params">action, key</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * actionsæœ‰ä¸¤ç§å†™æ³•ï¼š</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * actions: &#123;</span></span><br><span class="line"><span class="comment">     *    AsyncAdd (context, payload) &#123;...&#125;,   // ç¬¬ä¸€ç§å†™æ³•</span></span><br><span class="line"><span class="comment">     *    AsyncDelete: &#123;                       // ç¬¬äºŒç§å†™æ³•</span></span><br><span class="line"><span class="comment">     *      root: true,</span></span><br><span class="line"><span class="comment">     *      handler: (context, payload) &#123;...&#125;</span></span><br><span class="line"><span class="comment">     *    &#125; </span></span><br><span class="line"><span class="comment">     * &#125;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">const</span> type = action.<span class="property">root</span> ? key : namespace + key   <span class="comment">// åˆ¤æ–­æ˜¯å¦éœ€è¦åœ¨å‘½åç©ºé—´é‡Œæ³¨å†Œä¸€ä¸ªå…¨å±€çš„action</span></span><br><span class="line">    <span class="keyword">const</span> handler = action.<span class="property">handler</span> || action          <span class="comment">// è·å–actionså¯¹åº”çš„å‡½æ•°</span></span><br><span class="line">    <span class="title function_">registerAction</span>(store, type, handler, local)   </span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æ³¨å†Œæ¨¡å—çš„æ‰€æœ‰getters</span></span><br><span class="line">  <span class="variable language_">module</span>.<span class="title function_">forEachGetter</span>(<span class="function">(<span class="params">getter, key</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> namespacedType = namespace + key</span><br><span class="line">    <span class="title function_">registerGetter</span>(store, namespacedType, getter, local)</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// é€’å½’æ³¨å†Œå­æ¨¡å—</span></span><br><span class="line">  <span class="variable language_">module</span>.<span class="title function_">forEachChild</span>(<span class="function">(<span class="params">child, key</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">installModule</span>(store, rootState, path.<span class="title function_">concat</span>(key), child, hot)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>const namespace = store._modules.getNamespace(path)</code> æ˜¯å°†è·¯å¾„ <code>path</code> ä½œä¸ºå‚æ•°ï¼Œ è°ƒç”¨ <code>ModuleCollection</code> ç±»å®ä¾‹ä¸Šçš„ <code>getNamespace</code> æ–¹æ³•æ¥è·å–å½“å‰æ³¨å†Œå¯¹è±¡çš„å‘½åç©ºé—´çš„</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* æ ¹æ®æ¨¡å—æ˜¯å¦æœ‰å‘½åç©ºé—´æ¥è®¾å®šä¸€ä¸ªè·¯å¾„åç§°</span></span><br><span class="line"><span class="comment">* ä¾‹å¦‚ï¼šAä¸ºçˆ¶æ¨¡å—ï¼ŒBä¸ºå­æ¨¡å—ï¼ŒCä¸ºå­å­™æ¨¡å—</span></span><br><span class="line"><span class="comment">* 1. è‹¥Bæ¨¡å—å‘½åç©ºé—´ä¸ºsecond,Cæ¨¡å—æœªè®¾å®šå‘½åç©ºé—´æ—¶; Cæ¨¡å—ç»§æ‰¿äº†Bæ¨¡å—çš„å‘½åç©ºé—´ï¼Œä¸º second/</span></span><br><span class="line"><span class="comment">* 2. è‹¥Bæ¨¡å—æœªè®¾å®šå‘½åç©ºé—´, Bæ¨¡å—å‘½åç©ºé—´ä¸ºthird; åˆ™æ­¤æ—¶Bæ¨¡å—ç»§æ‰¿çš„æ˜¯Aæ¨¡å—çš„å‘½åç©ºé—´ï¼Œè€ŒCæ¨¡å—çš„å‘½åç©ºé—´è·¯å¾„ä¸º third/</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">getNamespace (path) &#123;</span><br><span class="line">  <span class="keyword">let</span> <span class="variable language_">module</span> = <span class="variable language_">this</span>.<span class="property">root</span></span><br><span class="line">  <span class="keyword">return</span> path.<span class="title function_">reduce</span>(<span class="function">(<span class="params">namespace, key</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">module</span> = <span class="variable language_">module</span>.<span class="title function_">getChild</span>(key)   <span class="comment">// è·å–å­æ¨¡å—</span></span><br><span class="line">    <span class="keyword">return</span> namespace + (<span class="variable language_">module</span>.<span class="property">namespaced</span> ? key + <span class="string">&#x27;/&#x27;</span> : <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">  &#125;, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä»è¿™å¯ä»¥çœ‹å‡ºï¼ŒæœªæŒ‡å®šå‘½åç©ºé—´çš„æ¨¡å—ä¼šç»§æ‰¿çˆ¶æ¨¡å—çš„å‘½åç©ºé—´</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">  <span class="comment">// å¦‚æœå½“å‰æ¨¡å—è®¾ç½®äº†namespaced æˆ– ç»§æ‰¿äº†çˆ¶æ¨¡å—çš„namespacedï¼Œåˆ™åœ¨modulesNamespaceMapä¸­å­˜å‚¨ä¸€ä¸‹å½“å‰æ¨¡å—</span></span><br><span class="line"><span class="keyword">if</span> (<span class="variable language_">module</span>.<span class="property">namespaced</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (store.<span class="property">_modulesNamespaceMap</span>[namespace] &amp;&amp; __DEV__) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">`[vuex] duplicate namespace <span class="subst">$&#123;namespace&#125;</span> for the namespaced module <span class="subst">$&#123;path.join(<span class="string">&#x27;/&#x27;</span>)&#125;</span>`</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  store.<span class="property">_modulesNamespaceMap</span>[namespace] = <span class="variable language_">module</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™æ®µä»£ç æ˜¯å°†æ‰€æœ‰å­˜åœ¨å‘½åç©ºé—´çš„æ¨¡å—è®°å½•åœ¨ <code>store._modulesNamespaceMap</code> ä¸­ï¼Œä¾¿äºä¹‹åçš„è¾…åŠ©å‡½æ•°å¯ä»¥è°ƒç”¨ï¼ˆè¿™é‡Œè¿˜æœªæåˆ°è¾…åŠ©å‡½æ•°ï¼Œå¯ä»¥å…ˆä¸ç®¡ï¼Œåˆ°æ—¶å€™å›å¤´æ¥çœ‹ï¼‰</p>
<h5 id="3-2-1-æ³¨å†Œæ¨¡å—çš„-state"><a href="#3-2-1-æ³¨å†Œæ¨¡å—çš„-state" class="headerlink" title="3.2.1 æ³¨å†Œæ¨¡å—çš„ state"></a>3.2.1 æ³¨å†Œæ¨¡å—çš„ state</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¦‚æœä¸æ˜¯æ ¹æ¨¡å—ï¼Œå°†å½“å‰æ¨¡å—çš„stateæ³¨å†Œåˆ°å…¶çˆ¶æ¨¡å—çš„stateä¸Š</span></span><br><span class="line"><span class="keyword">if</span> (!isRoot &amp;&amp; !hot) &#123;</span><br><span class="line">  <span class="keyword">const</span> parentState = <span class="title function_">getNestedState</span>(rootState, path.<span class="title function_">slice</span>(<span class="number">0</span>, -<span class="number">1</span>)) <span class="comment">// è·å–çˆ¶æ¨¡å—çš„state</span></span><br><span class="line">  <span class="keyword">const</span> moduleName = path[path.<span class="property">length</span> - <span class="number">1</span>]   <span class="comment">// å½“å‰æ¨¡å—çš„åç§°</span></span><br><span class="line">  store.<span class="title function_">_withCommit</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (__DEV__) &#123;</span><br><span class="line">      <span class="keyword">if</span> (moduleName <span class="keyword">in</span> parentState) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">warn</span>(</span><br><span class="line">          <span class="string">`[vuex] state field &quot;<span class="subst">$&#123;moduleName&#125;</span>&quot; was overridden by a module with the same name at &quot;<span class="subst">$&#123;path.join(<span class="string">&#x27;.&#x27;</span>)&#125;</span>&quot;`</span></span><br><span class="line">        )</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å°†å½“å‰æ¨¡å—çš„stateæ³¨å†Œåœ¨çˆ¶æ¨¡å—çš„stateä¸Šï¼Œå¹¶ä¸”æ˜¯å“åº”å¼çš„</span></span><br><span class="line">    <span class="title class_">Vue</span>.<span class="title function_">set</span>(parentState, moduleName, <span class="variable language_">module</span>.<span class="property">state</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™æ®µä»£ç ä¸»è¦æ˜¯å°†éæ ¹æ¨¡å—çš„ <code>state</code> æŒ‚è½½åˆ°çˆ¶æ¨¡å—çš„ <code>state</code> ä¸Š</p>
<p><code>const parentState = getNestedState(rootState, path.slice(0, -1))</code> æ ¹æ®å½“å‰çš„æ¨¡å—è·¯å¾„ï¼Œä»æ ¹æ¨¡å—çš„ <code>state</code> å¼€å§‹æ‰¾ï¼Œæœ€ç»ˆæ‰¾åˆ°å½“å‰æ¨¡å—çš„çˆ¶æ¨¡å—çš„ <code>state</code>ï¼Œå¯ä»¥çœ‹ä¸€ä¸‹ <code>getNestedState</code> æ–¹æ³•å†…éƒ¨çš„å…·ä½“å®ç°</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è·å–åˆ°åµŒå¥—çš„æ¨¡å—ä¸­çš„state</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getNestedState</span> (state, path) &#123;</span><br><span class="line">  <span class="keyword">return</span> path.<span class="title function_">reduce</span>(<span class="function">(<span class="params">state, key</span>) =&gt;</span> state[key], state)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>const moduleName = path[path.length - 1]</code> ä»è·¯å¾„ <code>path</code> ä¸­å°†å½“å‰æ¨¡å—çš„åç§°æå–å‡ºæ¥</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">store.<span class="title function_">_withCommit</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (__DEV__) &#123;</span><br><span class="line">    <span class="keyword">if</span> (moduleName <span class="keyword">in</span> parentState) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">warn</span>(</span><br><span class="line">        <span class="string">`[vuex] state field &quot;<span class="subst">$&#123;moduleName&#125;</span>&quot; was overridden by a module with the same name at &quot;<span class="subst">$&#123;path.join(<span class="string">&#x27;.&#x27;</span>)&#125;</span>&quot;`</span></span><br><span class="line">      )</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// å°†å½“å‰æ¨¡å—çš„stateæ³¨å†Œåœ¨çˆ¶æ¨¡å—çš„stateä¸Šï¼Œå¹¶ä¸”æ˜¯å“åº”å¼çš„</span></span><br><span class="line">  <span class="title class_">Vue</span>.<span class="title function_">set</span>(parentState, moduleName, <span class="variable language_">module</span>.<span class="property">state</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>è¿™æ®µä»£ç ä¸­æœ€ä¸»è¦çš„éƒ¨åˆ†å°±æ˜¯ <code>Vue.set(parentState, moduleName, module.state)</code> ï¼Œä½œç”¨å°±æ˜¯è°ƒç”¨äº† <code>Vue</code> çš„ <code>set</code> æ–¹æ³•å°†å½“å‰æ¨¡å—çš„ <code>state</code> å“åº”å¼åœ°æ·»åŠ åˆ°äº†çˆ¶æ¨¡å—çš„ <code>state</code> ä¸Šï¼Œè¿™æ˜¯å› ä¸ºåœ¨ä¹‹åæˆ‘ä»¬ä¼šçœ‹åˆ° <code>state</code> ä¼šè¢«æ”¾åˆ°ä¸€ä¸ªæ–°çš„ <code>Vue</code> å®ä¾‹çš„ <code>data</code> ä¸­ï¼Œæ‰€ä»¥è¿™é‡Œä¸å¾—ä¸ä½¿ç”¨ <code>Vue</code> çš„ <code>set</code> æ–¹æ³•æ¥å“åº”å¼åœ°æ·»åŠ </p>
<p>åŒæ ·çš„ï¼Œä»è¿™æ®µä»£ç ä¸­æˆ‘ä»¬ä¹Ÿå¯ä»¥çŸ¥é“äº†ä¸ºä»€ä¹ˆå¹³æ—¶åœ¨è·å–å­æ¨¡å—ä¸Š <code>state</code> çš„å±æ€§æ—¶ï¼Œæ˜¯é€šè¿‡ <code>this.$store.state.ModuleA.name</code> è¿™æ ·çš„å½¢å¼æ¥è·å–çš„äº†</p>
<h5 id="3-2-2-ç”Ÿæˆæ¨¡å—è°ƒç”¨ä¸Šä¸‹æ–‡"><a href="#3-2-2-ç”Ÿæˆæ¨¡å—è°ƒç”¨ä¸Šä¸‹æ–‡" class="headerlink" title="3.2.2 ç”Ÿæˆæ¨¡å—è°ƒç”¨ä¸Šä¸‹æ–‡"></a>3.2.2 ç”Ÿæˆæ¨¡å—è°ƒç”¨ä¸Šä¸‹æ–‡</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è®¾ç½®å½“å‰æ¨¡å—çš„ä¸Šä¸‹æ–‡context</span></span><br><span class="line"><span class="keyword">const</span> local = <span class="variable language_">module</span>.<span class="property">context</span> = <span class="title function_">makeLocalContext</span>(store, namespace, path)</span><br></pre></td></tr></table></figure>

<p>è¿™è¡Œä»£ç ä¹Ÿå¯ä»¥è¯´æ˜¯éå¸¸æ ¸å¿ƒçš„ä¸€æ®µä»£ç äº†ï¼Œå®ƒæ ¹æ®å‘½åç©ºé—´ä¸ºæ¯ä¸ªæ¨¡å—åˆ›å»ºäº†ä¸€ä¸ªå±äºè¯¥æ¨¡å—è°ƒç”¨çš„ä¸Šä¸‹æ–‡ï¼Œå¹¶å°†è¯¥ä¸Šä¸‹æ–‡èµ‹å€¼äº†ç»™äº†è¯¥æ¨¡å—çš„ <code>context</code> å±æ€§</p>
<p>æ¥ä¸‹æ¥çœ‹ä¸€ä¸‹è¿™ä¸ªä¸Šä¸‹æ–‡æ˜¯å¦‚ä½•åˆ›å»ºçš„å§</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è‹¥è®¾ç½®äº†å‘½åç©ºé—´åˆ™åˆ›å»ºä¸€ä¸ªæœ¬åœ°çš„commitã€dispatchæ–¹æ³•ï¼Œå¦åˆ™å°†ä½¿ç”¨å…¨å±€çš„store</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">makeLocalContext</span> (store, namespace, path) &#123;</span><br><span class="line">  <span class="keyword">const</span> noNamespace = namespace === <span class="string">&#x27;&#x27;</span>  </span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> local = &#123;</span><br><span class="line">    <span class="attr">dispatch</span>: noNamespace ? store.<span class="property">dispatch</span> : <span class="function">(<span class="params">_type, _payload, _options</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> args = <span class="title function_">unifyObjectStyle</span>(_type, _payload, _options)</span><br><span class="line">      <span class="keyword">const</span> &#123; payload, options &#125; = args</span><br><span class="line">      <span class="keyword">let</span> &#123; type &#125; = args</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (!options || !options.<span class="property">root</span>) &#123;  <span class="comment">// è‹¥ä¼ å…¥äº†ç¬¬ä¸‰ä¸ªå‚æ•°è®¾ç½®äº†root:trueï¼Œåˆ™æ´¾å‘çš„æ˜¯å…¨å±€ä¸Šå¯¹åº”çš„çš„actionsæ–¹æ³•</span></span><br><span class="line">        type = namespace + type</span><br><span class="line">        <span class="keyword">if</span> (__DEV__ &amp;&amp; !store.<span class="property">_actions</span>[type]) &#123;</span><br><span class="line">          <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">`[vuex] unknown local action type: <span class="subst">$&#123;args.type&#125;</span>, global type: <span class="subst">$&#123;type&#125;</span>`</span>)</span><br><span class="line">          <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> store.<span class="title function_">dispatch</span>(type, payload)</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="attr">commit</span>: noNamespace ? store.<span class="property">commit</span> : <span class="function">(<span class="params">_type, _payload, _options</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> args = <span class="title function_">unifyObjectStyle</span>(_type, _payload, _options)</span><br><span class="line">      <span class="keyword">const</span> &#123; payload, options &#125; = args</span><br><span class="line">      <span class="keyword">let</span> &#123; type &#125; = args</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (!options || !options.<span class="property">root</span>) &#123;   <span class="comment">// è‹¥ä¼ å…¥äº†ç¬¬ä¸‰ä¸ªå‚æ•°è®¾ç½®äº†root:trueï¼Œåˆ™æ´¾å‘çš„æ˜¯å…¨å±€ä¸Šå¯¹åº”çš„çš„mutationsæ–¹æ³•</span></span><br><span class="line">        type = namespace + type</span><br><span class="line">        <span class="keyword">if</span> (__DEV__ &amp;&amp; !store.<span class="property">_mutations</span>[type]) &#123;</span><br><span class="line">          <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">`[vuex] unknown local mutation type: <span class="subst">$&#123;args.type&#125;</span>, global type: <span class="subst">$&#123;type&#125;</span>`</span>)</span><br><span class="line">          <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      store.<span class="title function_">commit</span>(type, payload, options)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * è‹¥æ²¡æœ‰è®¾å®šå‘½åç©ºé—´ï¼Œåˆ™ç›´æ¥è¯»å–store.gettersï¼ˆstore.getterså·²ç»æŒ‚è½½åˆ°vueå®ä¾‹çš„computedä¸Šäº†ï¼‰;</span></span><br><span class="line"><span class="comment">   * è‹¥è®¾å®šäº†å‘½åç©ºé—´ï¼Œåˆ™ä»æœ¬åœ°ç¼“å­˜_makeLocalGettersCacheä¸­è¯»å–getters</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="title class_">Object</span>.<span class="title function_">defineProperties</span>(local, &#123;</span><br><span class="line">    <span class="attr">getters</span>: &#123;</span><br><span class="line">      <span class="attr">get</span>: noNamespace</span><br><span class="line">        ? <span class="function">() =&gt;</span> store.<span class="property">getters</span>    </span><br><span class="line">        : <span class="function">() =&gt;</span> <span class="title function_">makeLocalGetters</span>(store, namespace)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">state</span>: &#123;</span><br><span class="line">      <span class="attr">get</span>: <span class="function">() =&gt;</span> <span class="title function_">getNestedState</span>(store.<span class="property">state</span>, path)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> local</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>local</code> è¿™ä¸ªå˜é‡å­˜å‚¨çš„å°±æ˜¯ä¸€ä¸ªæ¨¡å—çš„ä¸Šä¸‹æ–‡ã€‚</p>
<p>å…ˆæ¥çœ‹å…¶ç¬¬ä¸€ä¸ªå±æ€§ <code>dispatch</code> ï¼Œå½“è¯¥æ¨¡å—æ²¡æœ‰è®¾ç½®å‘½åç©ºé—´æ—¶ï¼Œè°ƒç”¨è¯¥ä¸Šä¸‹æ–‡çš„ <code>dispatch</code> æ–¹æ³•æ—¶ä¼šç›´æ¥è°ƒç”¨ <code>sotre.dispatch</code> ï¼Œå³è°ƒç”¨äº†æ ¹æ¨¡å—çš„ <code>dispatch</code> æ–¹æ³• ; è€Œå­˜åœ¨å‘½åç©ºé—´æ—¶ï¼Œä¼šå…ˆåˆ¤æ–­ç›¸åº”çš„å‘½åç©ºé—´ï¼Œä»¥æ­¤æ¥å†³å®šè°ƒç”¨å“ªä¸ª <code>dispatch</code> æ–¹æ³•</p>
<p><code>if (!options || !options.root)</code> æ˜¯åˆ¤æ–­è°ƒç”¨ <code>dispatch</code> æ–¹æ³•æ—¶æœ‰æ²¡æœ‰ä¼ å…¥ç¬¬ä¸‰ä¸ªå‚æ•° <code>&#123;root: true&#125;</code> ï¼Œè‹¥æœ‰åˆ™è¡¨ç¤ºè°ƒç”¨å…¨å±€æ ¹æ¨¡å—ä¸Šå¯¹åº”çš„çš„ <code>dispatch</code> æ–¹æ³•</p>
<p>é‚£ä¹ˆåŒæ ·çš„ï¼Œ<code>local</code> ä¸­çš„ <code>commit</code> å±æ€§å°±ç±»ä¼¼äº <code>dispatch</code> ï¼Œè¿™é‡Œå°±ä¸å¤šè¯´äº†</p>
<p>ç„¶åæœ€åé€šè¿‡ <code>Object.defineProperties</code> æ–¹æ³•å¯¹ <code>local</code> çš„ <code>getters</code> å±æ€§å’Œ <code>state</code> å±æ€§è®¾ç½®äº†ä¸€å±‚è·å–ä»£ç†ï¼Œç­‰åç»­å¯¹å…¶è®¿é—®æ—¶ï¼Œæ‰ä¼šè¿›è¡Œå¤„ç†ã€‚ä¾‹å¦‚ï¼Œè®¿é—® <code>getters</code> å±æ€§æ—¶ï¼Œå…ˆåˆ¤æ–­æ˜¯å¦å­˜åœ¨å‘½åç©ºé—´ï¼Œè‹¥æ²¡æœ‰ï¼Œåˆ™ç›´æ¥è¿”å› <code>store.getters</code> ; å¦åˆ™çš„è¯ï¼Œæ ¹æ®å‘½åç©ºé—´åˆ›å»ºä¸€ä¸ªæœ¬åœ°çš„ <code>getters</code> ç¼“å­˜ï¼Œæ ¹æ®è¿™ä¸ªç¼“å­˜æ¥è·å–å¯¹åº”çš„ <code>getters</code> ï¼Œæ¥çœ‹ä¸€ä¸‹ä»£ç </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆ›å»ºæœ¬åœ°çš„gettersç¼“å­˜</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">makeLocalGetters</span> (store, namespace) &#123;</span><br><span class="line">  <span class="comment">// è‹¥ç¼“å­˜ä¸­æ²¡æœ‰æŒ‡å®šçš„gettersï¼Œåˆ™åˆ›å»ºä¸€ä¸ªæ–°çš„gettersç¼“å­˜åˆ°__makeLocalGettersCacheä¸­</span></span><br><span class="line">  <span class="keyword">if</span> (!store.<span class="property">_makeLocalGettersCache</span>[namespace]) &#123;</span><br><span class="line">    <span class="keyword">const</span> gettersProxy = &#123;&#125;</span><br><span class="line">    <span class="keyword">const</span> splitPos = namespace.<span class="property">length</span></span><br><span class="line">    <span class="title class_">Object</span>.<span class="title function_">keys</span>(store.<span class="property">getters</span>).<span class="title function_">forEach</span>(<span class="function"><span class="params">type</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// å¦‚æœstore.gettersä¸­æ²¡æœ‰ä¸namespaceåŒ¹é…çš„gettersï¼Œåˆ™ä¸è¿›è¡Œä»»ä½•æ“ä½œ</span></span><br><span class="line">      <span class="keyword">if</span> (type.<span class="title function_">slice</span>(<span class="number">0</span>, splitPos) !== namespace) <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">// è·å–æœ¬åœ°gettersåç§°</span></span><br><span class="line">      <span class="keyword">const</span> localType = type.<span class="title function_">slice</span>(splitPos)</span><br><span class="line"></span><br><span class="line">      <span class="comment">// å¯¹gettersæ·»åŠ ä¸€å±‚ä»£ç†</span></span><br><span class="line">      <span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(gettersProxy, localType, &#123;</span><br><span class="line">        <span class="attr">get</span>: <span class="function">() =&gt;</span> store.<span class="property">getters</span>[type],</span><br><span class="line">        <span class="attr">enumerable</span>: <span class="literal">true</span></span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="comment">// æŠŠä»£ç†è¿‡çš„gettersç¼“å­˜åˆ°æœ¬åœ°</span></span><br><span class="line">    store.<span class="property">_makeLocalGettersCache</span>[namespace] = gettersProxy</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> store.<span class="property">_makeLocalGettersCache</span>[namespace]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å½“å­˜åœ¨å‘½åç©ºé—´æ—¶è®¿é—® <code>local.getters</code> ï¼Œé¦–å…ˆä¼šå» <code>store._makeLocalGettersCache</code> æŸ¥æ‰¾æ˜¯å¦æœ‰å¯¹åº”çš„ <code>getters</code> ç¼“å­˜ï¼Œè‹¥æ²¡æœ‰ï¼Œåˆ™åˆ›å»ºä¸€ä¸ª <code>gettersProxy</code> ï¼Œåœ¨ <code>store.getters</code> ä¸Šæ‰¾åˆ°å¯¹åº”çš„ <code>getters</code> ï¼Œç„¶åç”¨ <code>Object.defineProperty</code> å¯¹ <code>gettersProxy</code> åšä¸€å±‚å¤„ç†ï¼Œå³å½“è®¿é—® <code>local.getters.func</code> æ—¶ï¼Œç›¸å½“äºè®¿é—®äº† <code>store.getters[&#39;first/func&#39;]</code> ï¼Œè¿™æ ·åšä¸€å±‚ç¼“å­˜ï¼Œä¸‹ä¸€æ¬¡è®¿é—®è¯¥ <code>getters</code> æ—¶ï¼Œå°±ä¸ä¼šé‡æ–°éå† <code>store.getters</code> äº† ; è‹¥æœ‰ç¼“å­˜ï¼Œåˆ™ç›´æ¥ä»ç¼“å­˜ä¸­è·å–</p>
<p>ä¸Šä¸‹æ–‡å·²ç»åˆ›å»ºå¥½äº†ï¼Œæ¥ä¸‹æ¥å°±æ˜¯æ³¨å†Œ <code>mutations</code> ã€<code>actions</code> ã€<code>getters</code> äº†</p>
<h5 id="3-2-3-æ³¨å†Œæ¨¡å—çš„-mutation"><a href="#3-2-3-æ³¨å†Œæ¨¡å—çš„-mutation" class="headerlink" title="3.2.3 æ³¨å†Œæ¨¡å—çš„ mutation"></a>3.2.3 æ³¨å†Œæ¨¡å—çš„ mutation</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ³¨å†Œæ¨¡å—çš„æ‰€æœ‰mutations</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="title function_">forEachMutation</span>(<span class="function">(<span class="params">mutation, key</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> namespacedType = namespace + key     <span class="comment">// ä¾‹å¦‚ï¼šfirst/second/mutations1</span></span><br><span class="line">  <span class="title function_">registerMutation</span>(store, namespacedType, mutation, local)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œéå†äº†æ¨¡å—çš„æ‰€æœ‰ <code>mutations</code> æ–¹æ³•ï¼Œé€šè¿‡å‘½åç©ºé—´ + <code>mutations</code> æ–¹æ³•åçš„å½¢å¼ç”Ÿæˆäº† <code>namespacedType</code></p>
<p>ç„¶åè·³åˆ° <code>registerMutations</code> æ–¹æ³•çœ‹çœ‹å…·ä½“æ˜¯å¦‚ä½•æ³¨å†Œçš„</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ³¨å†Œmutationsæ–¹æ³•</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">registerMutation</span> (store, type, handler, local) &#123;</span><br><span class="line">  <span class="keyword">const</span> entry = store.<span class="property">_mutations</span>[type] || (store.<span class="property">_mutations</span>[type] = [])  <span class="comment">// é€šè¿‡store._mutations è®°å½•æ‰€æœ‰æ³¨å†Œçš„mutations</span></span><br><span class="line">  entry.<span class="title function_">push</span>(<span class="keyword">function</span> <span class="title function_">wrappedMutationHandler</span> (payload) &#123;</span><br><span class="line">    handler.<span class="title function_">call</span>(store, local.<span class="property">state</span>, payload)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é¦–å…ˆæ ¹æ®æˆ‘ä»¬ä¼ å…¥çš„ <code>type</code> ä¹Ÿå°±æ˜¯ä¸Šé¢çš„ <code>namespacedType</code> å» <code>store._mutations</code> å¯»æ‰¾æ˜¯å¦æœ‰å…¥å£ <code>entry</code> ï¼Œè‹¥æœ‰åˆ™ç›´æ¥è·å– ; å¦åˆ™å°±åˆ›å»ºä¸€ä¸ªç©ºæ•°ç»„ç”¨äºå­˜å‚¨ <code>mutations</code> æ–¹æ³•</p>
<p>åœ¨è·å–åˆ° <code>entry</code> ä»¥åï¼Œå°†å½“å‰çš„ <code>mutations</code> æ–¹æ³•æ·»åŠ åˆ° <code>entry</code> æœ«å°¾è¿›è¡Œå­˜å‚¨ã€‚å…¶ä¸­ <code>mutations</code> æ¥æ”¶çš„å‚æ•°æœ‰ä¸¤ä¸ªï¼Œå³ ä¸Šä¸‹æ–‡ä¸­çš„ <code>state</code> å’Œ æˆ‘ä»¬ä¼ å…¥çš„å‚æ•° <code>payload</code></p>
<p>ä»è¿™æ®µä»£ç æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œæ•´ä¸ª <code>store</code> å®ä¾‹çš„æ‰€æœ‰ <code>mutations</code> æ–¹æ³•éƒ½æ˜¯å­˜å‚¨åœ¨ <code>store._mutations</code> ä¸­çš„ï¼Œå¹¶ä¸”æ˜¯ä»¥é”®å€¼å¯¹çš„å½¢å¼å­˜æ”¾çš„ï¼Œä¾‹å¦‚ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">store.<span class="property">_mutations</span> = &#123;</span><br><span class="line">  <span class="string">&#x27;mutations1&#x27;</span>: [<span class="keyword">function</span> <span class="title function_">handler</span>(<span class="params"></span>) &#123;...&#125;],</span><br><span class="line">  <span class="string">&#x27;ModuleA/mutations2&#x27;</span>: [<span class="keyword">function</span> <span class="title function_">handler</span>(<span class="params"></span>) &#123;...&#125;, <span class="keyword">function</span> <span class="title function_">handler</span>(<span class="params"></span>) &#123;...&#125;],</span><br><span class="line">  <span class="string">&#x27;ModuleA/ModuleB/mutations2&#x27;</span>: [<span class="keyword">function</span> <span class="title function_">handler</span>(<span class="params"></span>) &#123;...&#125;]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å…¶ä¸­<strong>é”®</strong>æ˜¯ç”±å‘½åç©ºé—´å’Œ <code>mutations</code> æ–¹æ³•åç»„æˆçš„ï¼Œ<strong>å€¼</strong>æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œå­˜æ”¾ç€æ‰€æœ‰è¯¥é”®å¯¹åº”çš„ <code>mutations</code> æ–¹æ³•</p>
<p>ä¸ºä»€ä¹ˆæ˜¯ç”¨æ•°ç»„å­˜æ”¾å‘¢ï¼Ÿå› ä¸ºåœ¨ä¸Šé¢è¯´è¿‡ï¼Œå‡è®¾çˆ¶æ¨¡å—<code>ModuleA</code> é‡Œæœ‰ä¸€ä¸ªå« <code>func</code> çš„ <code>mutations</code> æ–¹æ³•ï¼Œé‚£ä¹ˆå…¶åœ¨ <code>store._mutations</code> ä¸­å°±æ˜¯è¿™ä¸ªæ ·å­çš„</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">store.<span class="property">_mutations</span> = &#123;</span><br><span class="line">  <span class="string">&#x27;ModuleA/func&#x27;</span>: [<span class="keyword">function</span> <span class="title function_">handler</span>(<span class="params"></span>) &#123;...&#125;]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è‹¥å­æ¨¡å—æ²¡æœ‰è®¾ç½®å‘½åç©ºé—´ï¼Œé‚£ä¹ˆä»–æ˜¯ä¼šç»§æ‰¿çˆ¶æ¨¡å—çš„å‘½åç©ºé—´çš„ï¼Œæ­¤æ—¶å­æ¨¡å—é‡Œä¹Ÿæœ‰ä¸€ä¸ªå« <code>func</code> çš„ <code>mutations</code> æ–¹æ³•ï¼Œé‚£ä¹ˆåœ¨è·å– <code>entry</code> æ—¶ï¼Œè·å–åˆ°çš„æ˜¯ <code>store._mutations[&#39;ModuleA/func&#39;]</code> ï¼Œä½†æ­¤æ—¶è¿™ä¸ª <code>entry</code> ä¸­å·²ç»æœ‰ä¸€ä¸ª <code>mutations</code> æ–¹æ³•äº†ï¼Œé‚£ä¹ˆä¸ºäº†ä¿è¯ä¹‹å‰çš„æ–¹æ³•ä¸è¢«æ›¿æ¢ï¼Œå°±é€‰æ‹©æ·»åŠ åˆ°æ•°ç»„çš„æœ«å°¾ï¼Œæ­¤æ—¶åº”è¯¥å°±å¯ä»¥çŒœæµ‹åˆ°äº†ï¼Œåç»­å¦‚æœè°ƒç”¨è¯¥ <code>mutations</code> æ–¹æ³•ï¼Œä¼šå…ˆè·å–åˆ°ç›¸åº”çš„æ•°ç»„ï¼Œç„¶åéå†ä¾æ¬¡æ‰§è¡Œ</p>
<p>å¾—å‡ºä¸ª<strong>ç»“è®º</strong>ï¼š<code>mutations</code> æ–¹æ³•æ˜¯å¯ä»¥é‡åçš„</p>
<h5 id="3-2-4-æ³¨å†Œæ¨¡å—çš„-actions"><a href="#3-2-4-æ³¨å†Œæ¨¡å—çš„-actions" class="headerlink" title="3.2.4 æ³¨å†Œæ¨¡å—çš„ actions"></a>3.2.4 æ³¨å†Œæ¨¡å—çš„ actions</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ³¨å†Œæ¨¡å—çš„æ‰€æœ‰actions</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="title function_">forEachAction</span>(<span class="function">(<span class="params">action, key</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> type = action.<span class="property">root</span> ? key : namespace + key   <span class="comment">// åˆ¤æ–­æ˜¯å¦éœ€è¦åœ¨å‘½åç©ºé—´é‡Œæ³¨å†Œä¸€ä¸ªå…¨å±€çš„action</span></span><br><span class="line">  <span class="keyword">const</span> handler = action.<span class="property">handler</span> || action          <span class="comment">// è·å–actionså¯¹åº”çš„å‡½æ•°</span></span><br><span class="line">  <span class="title function_">registerAction</span>(store, type, handler, local)   </span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>éå†æ¨¡å—çš„æ‰€æœ‰ <code>actions</code> æ–¹æ³•ï¼Œå…¶ä¸­å¯¹äº <code>type</code> å’Œ <code>handler</code> çš„å¤„ç†ä¸»è¦æ˜¯ä¸ºäº†å…¼å®¹ä¸¤ç§å†™æ³•ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç¬¬ä¸€ç§å†™æ³•ï¼š</span></span><br><span class="line"><span class="attr">actions</span>: &#123;</span><br><span class="line">  <span class="title function_">func</span>(<span class="params">context, payload</span>) &#123;</span><br><span class="line">    <span class="comment">// çœç•¥ä¸šåŠ¡ä»£ç ...</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç¬¬äºŒç§å†™æ³•ï¼š</span></span><br><span class="line"><span class="attr">actions</span>: &#123;</span><br><span class="line">  <span class="attr">func</span>: &#123;</span><br><span class="line">    <span class="attr">root</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="title function_">handler</span>(<span class="params">context, payload</span>) &#123;</span><br><span class="line">      <span class="comment">// çœç•¥ä¸šåŠ¡ä»£ç ...</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å½“é‡‡ç”¨ç¬¬äºŒç§å†™æ³•ï¼Œå¹¶ä¸” <code>root = true</code> æ—¶ï¼Œå°±ä¼šå°†è¯¥ <code>actions</code> æ–¹æ³•æ³¨å†Œåˆ°å…¨å±€ä¸Šï¼Œå³å‰é¢ä¸åŠ ä¸Šä»»ä½•çš„å‘½åç©ºé—´å‰ç¼€</p>
<p>å†æ¥çœ‹çœ‹ <code>registerAction</code> æ–¹æ³•é‡Œå…·ä½“å®ç°äº†ä»€ä¹ˆ</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ³¨å†Œactionsæ–¹æ³•ï¼Œæ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼šcontextï¼ˆåŒ…å«äº†ä¸Šä¸‹æ–‡ä¸­çš„dispatchæ–¹æ³•ã€commitæ–¹æ³•ã€gettersæ–¹æ³•ã€stateï¼‰ã€ä¼ å…¥çš„å‚æ•°payload</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">registerAction</span> (store, type, handler, local) &#123;</span><br><span class="line">  <span class="keyword">const</span> entry = store.<span class="property">_actions</span>[type] || (store.<span class="property">_actions</span>[type] = [])   <span class="comment">// é€šè¿‡store._actions è®°å½•æ‰€æœ‰æ³¨å†Œçš„actions</span></span><br><span class="line">  entry.<span class="title function_">push</span>(<span class="keyword">function</span> <span class="title function_">wrappedActionHandler</span> (payload) &#123;</span><br><span class="line">    <span class="keyword">let</span> res = handler.<span class="title function_">call</span>(store, &#123;</span><br><span class="line">      <span class="attr">dispatch</span>: local.<span class="property">dispatch</span>,</span><br><span class="line">      <span class="attr">commit</span>: local.<span class="property">commit</span>,</span><br><span class="line">      <span class="attr">getters</span>: local.<span class="property">getters</span>,</span><br><span class="line">      <span class="attr">state</span>: local.<span class="property">state</span>,</span><br><span class="line">      <span class="attr">rootGetters</span>: store.<span class="property">getters</span>,</span><br><span class="line">      <span class="attr">rootState</span>: store.<span class="property">state</span></span><br><span class="line">    &#125;, payload)</span><br><span class="line">    <span class="comment">// è‹¥è¿”å›å€¼ä¸æ˜¯ä¸€ä¸ªpromiseå¯¹è±¡ï¼Œåˆ™åŒ…è£…ä¸€å±‚promiseï¼Œå¹¶å°†è¿”å›å€¼ä½œä¸ºthençš„å‚æ•°</span></span><br><span class="line">    <span class="keyword">if</span> (!<span class="title function_">isPromise</span>(res)) &#123;</span><br><span class="line">      res = <span class="title class_">Promise</span>.<span class="title function_">resolve</span>(res)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (store.<span class="property">_devtoolHook</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> res.<span class="title function_">catch</span>(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">        store.<span class="property">_devtoolHook</span>.<span class="title function_">emit</span>(<span class="string">&#x27;vuex:error&#x27;</span>, err)</span><br><span class="line">        <span class="keyword">throw</span> err</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> res</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸ <code>mutations</code> ç±»ä¼¼ï¼Œå…ˆä» <code>store._actions</code> è·å–å…¥å£ <code>entry</code> ï¼Œç„¶åå°†å½“å‰çš„ <code>actions</code> è¿›è¡ŒåŒ…è£…å¤„ç†åæ·»åŠ åˆ° <code>entry</code> çš„æœ«å°¾ã€‚ <code>actions</code> æ–¹æ³•æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼Œå³ <code>context</code> å’Œæˆ‘ä»¬ä¼ å…¥çš„å‚æ•° <code>payload</code> ï¼Œå…¶ä¸­ <code>context</code> æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œé‡Œé¢åŒ…å«äº† <code>dispatch</code> ã€<code>commit</code> ã€<code>getters</code> ã€<code>state</code> ã€<code>rootGetters</code> ã€<code>rootState</code> ï¼Œå‰4ä¸ªéƒ½æ˜¯åœ¨å½“å‰æ¨¡å—çš„ä¸Šä¸‹æ–‡ä¸­è°ƒç”¨çš„ï¼Œå2ä¸ªæ˜¯åœ¨å…¨å±€ä¸Šè°ƒç”¨çš„</p>
<p>æœ€åå¯¹äº <code>actions</code> çš„è¿”å›å€¼è¿˜åšäº†ä¸€å±‚å¤„ç†ï¼Œå› ä¸º <code>actions</code> è§„å®šæ˜¯å¤„ç†å¼‚æ­¥ä»»åŠ¡çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬è‚¯å®šå¸Œæœ›å…¶å€¼æ˜¯ä¸€ä¸ª <code>promise</code> å¯¹è±¡ï¼Œè¿™æ ·æ–¹ä¾¿åç»­çš„æ“ä½œã€‚æ‰€ä»¥è¿™é‡Œå¯¹ <code>actions</code> æ–¹æ³•çš„è¿”å›å€¼åšäº†ä¸€ä¸ªåˆ¤æ–­ï¼Œå¦‚æœæœ¬èº«å°±æ˜¯ <code>promise</code> å¯¹è±¡ï¼Œé‚£ä¹ˆå°±ç›´æ¥è¿”å› ï¼›è‹¥ä¸æ˜¯ï¼Œåˆ™åŒ…è£…ä¸€å±‚ <code>promise</code> å¯¹è±¡ï¼Œå¹¶å°†è¿”å›å€¼ <code>res</code> ä½œä¸ºå‚æ•°è¿”å›ç»™ <code>.then</code></p>
<p>åŒæ ·çš„ï¼Œ<code>actions</code> æ–¹æ³•ä¹Ÿæ˜¯å¯ä»¥é‡åçš„</p>
<h5 id="3-2-5-æ³¨å†Œæ¨¡å—çš„-getters"><a href="#3-2-5-æ³¨å†Œæ¨¡å—çš„-getters" class="headerlink" title="3.2.5 æ³¨å†Œæ¨¡å—çš„ getters"></a>3.2.5 æ³¨å†Œæ¨¡å—çš„ getters</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ³¨å†Œæ¨¡å—çš„æ‰€æœ‰getters</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="title function_">forEachGetter</span>(<span class="function">(<span class="params">getter, key</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> namespacedType = namespace + key</span><br><span class="line">  <span class="title function_">registerGetter</span>(store, namespacedType, getter, local)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>ä¸ä¸Šé¢çš„ç±»ä¼¼ï¼Œè¿™é‡Œå°±ä¸å¤šè¯´äº†ï¼Œç›´æ¥è·³åˆ° <code>registerGetters</code> æ–¹æ³•</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ³¨å†Œgetters</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">registerGetter</span> (store, type, rawGetter, local) &#123;</span><br><span class="line">  <span class="keyword">if</span> (store.<span class="property">_wrappedGetters</span>[type]) &#123;   <span class="comment">// è‹¥è®°å½•è¿‡gettersäº†ï¼Œåˆ™ä¸å†é‡å¤è®°å½•</span></span><br><span class="line">    <span class="keyword">if</span> (__DEV__) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">`[vuex] duplicate getter key: <span class="subst">$&#123;type&#125;</span>`</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// åœ¨store._wrappedGettersä¸­è®°å½•getters</span></span><br><span class="line">  store.<span class="property">_wrappedGetters</span>[type] = <span class="keyword">function</span> <span class="title function_">wrappedGetter</span> (store) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">rawGetter</span>(</span><br><span class="line">      local.<span class="property">state</span>, <span class="comment">// local state</span></span><br><span class="line">      local.<span class="property">getters</span>, <span class="comment">// local getters</span></span><br><span class="line">      store.<span class="property">state</span>, <span class="comment">// root state</span></span><br><span class="line">      store.<span class="property">getters</span> <span class="comment">// root getters</span></span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œå‘ç° <code>getters</code> å¹¶ä¸åƒ <code>mutations</code> å’Œ <code>actions</code> ä¸€æ ·å»è·å–ä¸€ä¸ª <code>entry</code> ï¼Œè€Œæ˜¯ç›´æ¥æŸ¥çœ‹ <code>store._wrappedGetters[type]</code> æ˜¯å¦æœ‰å¯¹åº”çš„ <code>getters</code> ï¼Œè‹¥æœ‰ï¼Œåˆ™ä¸å†é‡å¤è®°å½• ; å¦åˆ™å°† <code>getters</code> åŒ…è£…ä¸€ä¸‹å­˜åœ¨ <code>sotre._wrappedGetters</code> ä¸­ï¼Œå…¶ä¸­ç»è¿‡åŒ…è£…åçš„ <code>getters</code> æ¥æ”¶4ä¸ªå‚æ•°ï¼Œå³ <code>state</code> ã€<code>getters</code> ã€<code>rootState</code> ã€<code>rootGetters</code> ï¼Œå‰2ä¸ªåˆ†åˆ«è¡¨ç¤ºå½“å‰ä¸Šä¸‹æ–‡ä¸­çš„ <code>state</code> å’Œ <code>getters</code> ï¼Œå2ä¸ªåˆ†åˆ«è¡¨ç¤ºæ ¹æ¨¡å—çš„ <code>state</code> å’Œ <code>getters</code></p>
<p>æ‰€ä»¥æˆ‘ä»¬åœ¨ä½¿ç”¨ <code>Vuex</code> æ—¶ï¼Œè°ƒç”¨å­æ¨¡å—çš„ <code>getters</code> æ—¶æ˜¯è¿™æ ·çš„ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> store = <span class="title class_">Vuex</span>.<span class="title class_">Store</span>(&#123;</span><br><span class="line">  <span class="attr">state</span>: &#123;</span><br><span class="line">    <span class="attr">a</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="attr">b</span>: <span class="number">2</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">getters</span>: &#123;</span><br><span class="line">    <span class="title function_">addA</span>(<span class="params">state</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> state.<span class="property">a</span> + <span class="number">1</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">modules</span>: &#123;</span><br><span class="line">    <span class="comment">// å­æ¨¡å—A</span></span><br><span class="line">    <span class="title class_">ModuleA</span>: &#123;</span><br><span class="line">      <span class="attr">state</span>: &#123;</span><br><span class="line">        <span class="attr">c</span>: <span class="number">3</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">getters</span>: &#123;</span><br><span class="line">        <span class="title function_">sum</span>(<span class="params">state, getters, rootState, rootGetters</span>) &#123;</span><br><span class="line">          <span class="variable language_">console</span>.<span class="title function_">log</span>(state.<span class="property">c</span>)   <span class="comment">// 3</span></span><br><span class="line">          <span class="variable language_">console</span>.<span class="title function_">log</span>(getters.<span class="property">addC</span>)  <span class="comment">// 4</span></span><br><span class="line">          <span class="variable language_">console</span>.<span class="title function_">log</span>(rootState.<span class="property">b</span>)  <span class="comment">// 2</span></span><br><span class="line">          <span class="variable language_">console</span>.<span class="title function_">log</span>(rootGetters.<span class="property">addA</span>)  <span class="comment">// 2</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="title function_">addC</span>(<span class="params">state</span>) &#123;</span><br><span class="line">          <span class="keyword">return</span> state.<span class="property">c</span> + <span class="number">1</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>æœ€åæˆ‘ä»¬å†æ¬¡å¾—å‡ºä¸€ä¸ªç»“è®ºï¼Œ<code>getters</code> æ˜¯ä¸èƒ½é‡åçš„ï¼Œå¹¶ä¸”å‰ä¸€ä¸ªå‘½åçš„ä¸ä¼šè¢«åä¸€ä¸ªå‘½åçš„æ‰€è¦†ç›–</p>
<h5 id="3-2-6-é€’å½’æ³¨å†Œå­æ¨¡å—"><a href="#3-2-6-é€’å½’æ³¨å†Œå­æ¨¡å—" class="headerlink" title="3.2.6 é€’å½’æ³¨å†Œå­æ¨¡å—"></a>3.2.6 é€’å½’æ³¨å†Œå­æ¨¡å—</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é€’å½’æ³¨å†Œå­æ¨¡å—</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="title function_">forEachChild</span>(<span class="function">(<span class="params">child, key</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="title function_">installModule</span>(store, rootState, path.<span class="title function_">concat</span>(key), child, hot)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>ç„¶åå°±æ˜¯åˆ¤æ–­å½“å‰çš„æ¨¡å—é‡Œæœ‰æ²¡æœ‰åµŒå¥—çš„å­æ¨¡å—äº†ï¼Œæœ‰çš„è¯å°±å°†å­æ¨¡å—çš„åç§°æ·»åŠ åˆ° <code>path</code> æœ«å°¾ï¼Œç„¶åæŠŠç›¸åº”çš„å‚æ•°ä¼ å…¥ <code>installModule</code> æ–¹æ³•ï¼Œé‡æ–°èµ°ä¸€éæœ¬æ–‡ä¸­ <code>3.2</code> é‡Œæ‰€æœ‰çš„æµç¨‹</p>
<h4 id="3-3-æ³¨å†Œ-vm"><a href="#3-3-æ³¨å†Œ-vm" class="headerlink" title="3.3 æ³¨å†Œ vm"></a>3.3 æ³¨å†Œ vm</h4><p>ä¸Šé¢å·²ç»å°†æ¨¡å—çš„æ³¨å†Œå®Œæ¯•äº†ï¼Œçœ‹ä¸€ä¸‹ <code>constructor</code> ä¸­ä¸‹ä¸€è¡Œä»£ç æ˜¯ä»€ä¹ˆï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">resetStoreVM</span>(<span class="variable language_">this</span>, state)</span><br></pre></td></tr></table></figure>

<p>è·³åˆ°ç›¸åº”çš„æ–¹æ³•ä¸­å»çœ‹ä¸€ä¸‹ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆå§‹åŒ–vm</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">resetStoreVM</span> (store, state, hot) &#123;</span><br><span class="line">  <span class="keyword">const</span> oldVm = store.<span class="property">_vm</span></span><br><span class="line"></span><br><span class="line">  store.<span class="property">getters</span> = &#123;&#125;    <span class="comment">// åœ¨å®ä¾‹storeä¸Šè®¾ç½®getterså¯¹è±¡</span></span><br><span class="line">  </span><br><span class="line">  store.<span class="property">_makeLocalGettersCache</span> = <span class="title class_">Object</span>.<span class="title function_">create</span>(<span class="literal">null</span>)  <span class="comment">// æ¸…ç©ºæœ¬åœ°ç¼“å­˜</span></span><br><span class="line">  <span class="keyword">const</span> wrappedGetters = store.<span class="property">_wrappedGetters</span></span><br><span class="line">  <span class="keyword">const</span> computed = &#123;&#125;</span><br><span class="line">  <span class="comment">// éå†gettersï¼Œå°†æ¯ä¸€ä¸ªgetteræ³¨å†Œåˆ°store.gettersï¼Œè®¿é—®å¯¹åº”getteræ—¶ä¼šå»vmä¸Šè®¿é—®å¯¹åº”çš„computed</span></span><br><span class="line">  <span class="title function_">forEachValue</span>(wrappedGetters, <span class="function">(<span class="params">fn, key</span>) =&gt;</span> &#123;</span><br><span class="line">    computed[key] = <span class="title function_">partial</span>(fn, store)</span><br><span class="line">    <span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(store.<span class="property">getters</span>, key, &#123;</span><br><span class="line">      <span class="attr">get</span>: <span class="function">() =&gt;</span> store.<span class="property">_vm</span>[key],</span><br><span class="line">      <span class="attr">enumerable</span>: <span class="literal">true</span> <span class="comment">// for local getters</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> silent = <span class="title class_">Vue</span>.<span class="property">config</span>.<span class="property">silent</span></span><br><span class="line">  <span class="title class_">Vue</span>.<span class="property">config</span>.<span class="property">silent</span> = <span class="literal">true</span></span><br><span class="line">  <span class="comment">// ä½¿ç”¨Vueå®ä¾‹æ¥å­˜å‚¨Vuexçš„stateçŠ¶æ€æ ‘ï¼Œå¹¶åˆ©ç”¨computedå»ç¼“å­˜gettersè¿”å›çš„å€¼</span></span><br><span class="line">  store.<span class="property">_vm</span> = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span><br><span class="line">    <span class="attr">data</span>: &#123;</span><br><span class="line">      <span class="attr">$$state</span>: state</span><br><span class="line">    &#125;,</span><br><span class="line">    computed</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="title class_">Vue</span>.<span class="property">config</span>.<span class="property">silent</span> = silent</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å¯ç”¨ä¸¥æ ¼æ¨¡å¼çš„ç›‘å¬è­¦å‘Š</span></span><br><span class="line">  <span class="keyword">if</span> (store.<span class="property">strict</span>) &#123;</span><br><span class="line">    <span class="title function_">enableStrictMode</span>(store)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// è‹¥å­˜åœ¨æ—§çš„vm, é”€æ¯æ—§çš„vm</span></span><br><span class="line">  <span class="keyword">if</span> (oldVm) &#123;</span><br><span class="line">    <span class="keyword">if</span> (hot) &#123;</span><br><span class="line">      <span class="comment">// è§£é™¤å¯¹æ—§çš„vmå¯¹stateçš„å¼•ç”¨</span></span><br><span class="line">      store.<span class="title function_">_withCommit</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        oldVm.<span class="property">_data</span>.<span class="property">$$state</span> = <span class="literal">null</span></span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title class_">Vue</span>.<span class="title function_">nextTick</span>(<span class="function">() =&gt;</span> oldVm.$destroy())</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªæ–¹æ³•é‡Œä¸»è¦åšçš„å°±æ˜¯ç”Ÿæˆä¸€ä¸ª <code>Vue</code> çš„å®ä¾‹ <code>_vm</code> ï¼Œç„¶åå°† <code>store._makeLocalGettersCache</code> é‡Œçš„ <code>getters</code> ä»¥åŠ <code>store.state</code> äº¤ç»™ä¸€ä¸ª <code>_vm</code> æ‰˜ç®¡ï¼Œå³å°† <code>store.state</code> èµ‹å€¼ç»™ <code>_vm.data.$$state</code> ï¼Œå°† <code>store._makeLocalGettersCache</code> é€šè¿‡è½¬åŒ–åèµ‹å€¼ç»™ <code>_vm.computed</code> ï¼Œè¿™æ ·ä¸€æ¥ï¼Œ<code>state</code> å°±å®ç°äº†å“åº”å¼ï¼Œ<code>getters</code> å®ç°äº†ç±»ä¼¼ <code>computed</code> çš„åŠŸèƒ½</p>
<p>å› ä¸ºç”Ÿæˆäº†æ–°çš„ <code>_vm</code> ï¼Œæ‰€ä»¥æœ€åé€šè¿‡ <code>oldVm.$destory()</code> å°†æ—§çš„ <code>_vm</code> ç»™é”€æ¯æ‰äº†</p>
<p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå…¶å°† <code>sotre.getters</code> çš„æ“ä½œæ”¾åœ¨äº†è¿™ä¸ªæ–¹æ³•é‡Œï¼Œæ˜¯å› ä¸ºæˆ‘ä»¬åç»­è®¿é—®æŸä¸ª <code>getters</code> æ—¶ï¼Œè®¿é—®çš„å…¶å®æ˜¯ <code>_vm.computed</code> ä¸­çš„å†…å®¹ã€‚å› æ­¤ï¼Œé€šè¿‡ <code>Object.defineProperty</code> å¯¹ <code>store.getters</code> è¿›è¡Œäº†å¤„ç†</p>
<h4 id="3-4-è®¿é—®-state-ã€mutations-ã€actions"><a href="#3-4-è®¿é—®-state-ã€mutations-ã€actions" class="headerlink" title="3.4 è®¿é—® state ã€mutations ã€actions"></a>3.4 è®¿é—® state ã€mutations ã€actions</h4><p>åˆ°æ­¤ä¸ºæ­¢ï¼Œå·²ç»å®ç°äº†å¯ä»¥é€šè¿‡ <code>store.getter.æŸä¸ªgetters</code> æ¥ä½¿ç”¨ <code>getters</code> ï¼Œé‚£ä¹ˆå¦‚ä½•è®¿é—® <code>state</code> ã€<code>mutations</code> ã€<code>actions</code> å‘¢ï¼Ÿ</p>
<h5 id="3-4-1-è®¿é—®-state"><a href="#3-4-1-è®¿é—®-state" class="headerlink" title="3.4.1 è®¿é—® state"></a>3.4.1 è®¿é—® state</h5><p>é€šè¿‡æœç´¢ï¼Œåœ¨ <code>Store</code> ç±»ä¸­å®šä¹‰äº†ä¸€ä¸ª <code>get</code> å‡½æ•°ï¼Œç”¨äºå¤„ç† <code>store.state</code> çš„æ“ä½œï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">get state () &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">_vm</span>.<span class="property">_data</span>.<span class="property">$$state</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥å¾ˆæ¸…æ¥šåœ°çœ‹åˆ°ï¼Œå½“æˆ‘ä»¬è®¿é—® <code>store.state</code> æ—¶ï¼Œå°±æ˜¯å»è®¿é—® <code>store._vm.data.$$state</code> ï¼Œä¸åˆšæ‰ä»‹ç» <code>_vm</code> æ—¶è¯´çš„ä¸€æ ·</p>
<h5 id="3-4-2-è®¿é—®-mutations"><a href="#3-4-2-è®¿é—®-mutations" class="headerlink" title="3.4.2 è®¿é—® mutations"></a>3.4.2 è®¿é—® mutations</h5><p>å…¶å® <code>mutations</code> çš„è®¿é—®åœ¨ä¸€å¼€å§‹å°±è§¦åŠåˆ°äº†ï¼Œåªä¸è¿‡å½“æ—¶åªæ˜¯æäº†ä¸€å˜´ï¼Œå› ä¸ºå½“æ—¶ç›´æ¥æ¥çœ‹å¯èƒ½ä¸ä¼šå¤ªæ˜ç™½</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> store = <span class="variable language_">this</span></span><br><span class="line"><span class="keyword">const</span> &#123; dispatch, commit &#125; = <span class="variable language_">this</span></span><br><span class="line"><span class="variable language_">this</span>.<span class="property">dispatch</span> = <span class="keyword">function</span> <span class="title function_">boundDispatch</span> (type, payload) &#123;</span><br><span class="line">  <span class="keyword">return</span> dispatch.<span class="title function_">call</span>(store, type, payload)</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">this</span>.<span class="property">commit</span> = <span class="keyword">function</span> <span class="title function_">boundCommit</span> (type, payload, options) &#123;</span><br><span class="line">  <span class="keyword">return</span> commit.<span class="title function_">call</span>(store, type, payload, options)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨ <code>Store</code> ä¸­ï¼Œå¯¹ <code>store.commit</code> å’Œ <code>store.dispatch</code> æ–¹æ³•åšäº†ä¸€å±‚å¤„ç†ï¼Œå°†è¯¥æ–¹æ³•çš„è°ƒç”¨æŒ‡å‘äº† <code>store</code> ï¼Œå…ˆæ¥çœ‹çœ‹ <code>commit</code> æ–¹æ³•çš„å…·ä½“å®ç°</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">commit (_type, _payload, _options) &#123;</span><br><span class="line">  <span class="comment">// check object-style commit</span></span><br><span class="line">  <span class="keyword">const</span> &#123;</span><br><span class="line">    type,</span><br><span class="line">    payload,</span><br><span class="line">    options</span><br><span class="line">  &#125; = <span class="title function_">unifyObjectStyle</span>(_type, _payload, _options)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> mutation = &#123; type, payload &#125;</span><br><span class="line">  <span class="keyword">const</span> entry = <span class="variable language_">this</span>.<span class="property">_mutations</span>[type]    <span class="comment">// æŸ¥æ‰¾_mutationsä¸Šæ˜¯å¦æœ‰å¯¹åº”çš„æ–¹æ³•</span></span><br><span class="line">  <span class="comment">// æŸ¥æ‰¾ä¸åˆ°åˆ™ä¸æ‰§è¡Œä»»ä½•æ“ä½œ</span></span><br><span class="line">  <span class="keyword">if</span> (!entry) &#123;</span><br><span class="line">    <span class="keyword">if</span> (__DEV__) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">`[vuex] unknown mutation type: <span class="subst">$&#123;type&#125;</span>`</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// è‹¥æœ‰ç›¸åº”çš„æ–¹æ³•ï¼Œåˆ™æ‰§è¡Œ</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="title function_">_withCommit</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    entry.<span class="title function_">forEach</span>(<span class="keyword">function</span> <span class="title function_">commitIterator</span> (handler) &#123;</span><br><span class="line">      <span class="title function_">handler</span>(payload)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">_subscribers</span></span><br><span class="line">    .<span class="title function_">slice</span>() <span class="comment">// shallow copy to prevent iterator invalidation if subscriber synchronously calls unsubscribe</span></span><br><span class="line">    .<span class="title function_">forEach</span>(<span class="function"><span class="params">sub</span> =&gt;</span> <span class="title function_">sub</span>(mutation, <span class="variable language_">this</span>.<span class="property">state</span>))</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (</span><br><span class="line">    __DEV__ &amp;&amp;</span><br><span class="line">    options &amp;&amp; options.<span class="property">silent</span></span><br><span class="line">  ) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">warn</span>(</span><br><span class="line">      <span class="string">`[vuex] mutation type: <span class="subst">$&#123;type&#125;</span>. Silent option has been removed. `</span> +</span><br><span class="line">      <span class="string">&#x27;Use the filter functionality in the vue-devtools&#x27;</span></span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é¦–å…ˆé€šè¿‡ <code>unifyObjectStyle</code> æ–¹æ³•å¯¹ä¼ å…¥çš„å‚æ•°è¿›è¡Œäº†å¤„ç†ï¼Œæ¥çœ‹ä¸€ä¸‹è¿™ä¸ªæ–¹æ³•æ˜¯å¹²ä»€ä¹ˆçš„</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">unifyObjectStyle</span> (type, payload, options) &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="title function_">isObject</span>(type) &amp;&amp; type.<span class="property">type</span>) &#123;</span><br><span class="line">    options = payload</span><br><span class="line">    payload = type</span><br><span class="line">    type = type.<span class="property">type</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (__DEV__) &#123;</span><br><span class="line">    <span class="title function_">assert</span>(<span class="keyword">typeof</span> type === <span class="string">&#x27;string&#x27;</span>, <span class="string">`expects string as the type, but found <span class="subst">$&#123;<span class="keyword">typeof</span> type&#125;</span>.`</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123; type, payload, options &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨è¿‡ <code>Vuex</code> çš„åº”è¯¥éƒ½çŸ¥é“ï¼Œ<code>commit</code> æœ‰ä¸¤ç§æäº¤æ–¹å¼ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç¬¬ä¸€ç§æäº¤æ–¹å¼</span></span><br><span class="line"><span class="variable language_">this</span>.<span class="property">$store</span>.<span class="title function_">commit</span>(<span class="string">&#x27;func&#x27;</span>, <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç¬¬äºŒç§æäº¤æ–¹å¼</span></span><br><span class="line"><span class="variable language_">this</span>.<span class="property">$store</span>.<span class="title function_">commit</span>(&#123;</span><br><span class="line">  <span class="attr">type</span>: <span class="string">&#x27;func&#x27;</span>,</span><br><span class="line">  <span class="attr">num</span>: <span class="number">1</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>å…¶å…ˆå¯¹ç¬¬ä¸€ä¸ªå‚æ•°è¿›è¡Œåˆ¤æ–­æ˜¯å¦ä¸ºå¯¹è±¡ï¼Œæ˜¯çš„è¯å°±å½“ä½œå¯¹è±¡æäº¤é£æ ¼å¤„ç†ï¼Œå¦åˆ™çš„è¯å°±ç›´æ¥è¿”å›</p>
<p>åœ¨å¤„ç†å®Œå‚æ•°ä»¥åï¼Œæ ¹æ® <code>type</code> ä» <code>store._mutations</code> ä¸Šè·å–åˆ° <code>entry</code> ï¼Œå‰é¢åˆ†æè¿‡äº†ï¼Œ<code>mutations</code> æ–¹æ³•æ˜¯ä»¥æ•°ç»„å½¢å¼å­˜å‚¨çš„ï¼Œæ‰€ä»¥å¯èƒ½æœ‰å¤šä¸ªæ–¹æ³•ã€‚ç„¶ååœ¨ <code>_withCommit</code> æ–¹æ³•ä¸­éå† <code>entry</code> ä¾æ¬¡æ‰§è¡Œ <code>mutations</code> æ–¹æ³•ï¼Œè¿™æ˜¯å› ä¸º <code>Vuex</code> è§„å®š <code>state</code> çš„æ”¹å˜éƒ½è¦é€šè¿‡ <code>mutations</code> æ–¹æ³•ï¼Œ<code>store._committing</code> è¿™ä¸ªå±æ€§å°±æ˜¯ç”¨æ¥åˆ¤æ–­å½“å‰æ˜¯å¦å¤„äºè°ƒç”¨ <code>mutations</code> æ–¹æ³•çš„ï¼Œå½“ <code>state</code> å€¼æ”¹å˜æ—¶ï¼Œä¼šå…ˆå»åˆ¤æ–­ <code>store._committing</code> æ˜¯å¦ä¸º <code>true</code> ï¼Œè‹¥ä¸ä¸º <code>true</code> ï¼Œåˆ™è¡¨ç¤º <code>state</code> çš„å€¼æ”¹å˜æ²¡æœ‰ç»è¿‡ <code>mutations</code> æ–¹æ³•ï¼Œäºæ˜¯ä¼šæ‰“å°è­¦å‘Šâš ï¸ ä¿¡æ¯</p>
<p>è€Œ <code>this._subscribers</code> è¿™æ®µä»£ç æˆ‘æš‚æ—¶è¿˜ä¸æ¸…æ¥šæ˜¯å¹²ä»€ä¹ˆçš„ï¼Œé€šè¿‡è¯ä¹‰ï¼Œç›®æµ‹åº”è¯¥æ˜¯ä¸€ä¸ªå­˜æ”¾è®¢é˜…çš„ä¸œè¥¿å§ï¼Œå°±å…ˆæ”¾ç€ä¸ç®¡äº†ï¼Œç­‰åç»­å›æ¥å†çœ‹</p>
<h5 id="3-4-3-è®¿é—®-actions"><a href="#3-4-3-è®¿é—®-actions" class="headerlink" title="3.4.3 è®¿é—® actions"></a>3.4.3 è®¿é—® actions</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">dispatch (_type, _payload) &#123;</span><br><span class="line">  <span class="comment">// check object-style dispatch</span></span><br><span class="line">  <span class="keyword">const</span> &#123;</span><br><span class="line">    type,</span><br><span class="line">    payload</span><br><span class="line">  &#125; = <span class="title function_">unifyObjectStyle</span>(_type, _payload)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> action = &#123; type, payload &#125;</span><br><span class="line">  <span class="keyword">const</span> entry = <span class="variable language_">this</span>.<span class="property">_actions</span>[type]  <span class="comment">// æŸ¥æ‰¾_actionsä¸Šæ˜¯å¦æœ‰å¯¹åº”çš„æ–¹æ³•</span></span><br><span class="line">  <span class="comment">// æŸ¥æ‰¾ä¸åˆ°åˆ™ä¸æ‰§è¡Œä»»ä½•æ“ä½œ</span></span><br><span class="line">  <span class="keyword">if</span> (!entry) &#123;</span><br><span class="line">    <span class="keyword">if</span> (__DEV__) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">`[vuex] unknown action type: <span class="subst">$&#123;type&#125;</span>`</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">_actionSubscribers</span></span><br><span class="line">      .<span class="title function_">slice</span>() <span class="comment">// shallow copy to prevent iterator invalidation if subscriber synchronously calls unsubscribe</span></span><br><span class="line">      .<span class="title function_">filter</span>(<span class="function"><span class="params">sub</span> =&gt;</span> sub.<span class="property">before</span>)</span><br><span class="line">      .<span class="title function_">forEach</span>(<span class="function"><span class="params">sub</span> =&gt;</span> sub.<span class="title function_">before</span>(action, <span class="variable language_">this</span>.<span class="property">state</span>))</span><br><span class="line">  &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">    <span class="keyword">if</span> (__DEV__) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">warn</span>(<span class="string">`[vuex] error in before action subscribers: `</span>)</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">error</span>(e)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> result = entry.<span class="property">length</span> &gt; <span class="number">1</span></span><br><span class="line">  ? <span class="title class_">Promise</span>.<span class="title function_">all</span>(entry.<span class="title function_">map</span>(<span class="function"><span class="params">handler</span> =&gt;</span> <span class="title function_">handler</span>(payload)))</span><br><span class="line">  : entry[<span class="number">0</span>](payload)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    result.<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_actionSubscribers</span></span><br><span class="line">          .<span class="title function_">filter</span>(<span class="function"><span class="params">sub</span> =&gt;</span> sub.<span class="property">after</span>)</span><br><span class="line">          .<span class="title function_">forEach</span>(<span class="function"><span class="params">sub</span> =&gt;</span> sub.<span class="title function_">after</span>(action, <span class="variable language_">this</span>.<span class="property">state</span>))</span><br><span class="line">      &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">        <span class="keyword">if</span> (__DEV__) &#123;</span><br><span class="line">          <span class="variable language_">console</span>.<span class="title function_">warn</span>(<span class="string">`[vuex] error in after action subscribers: `</span>)</span><br><span class="line">          <span class="variable language_">console</span>.<span class="title function_">error</span>(e)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="title function_">resolve</span>(res)</span><br><span class="line">    &#125;, <span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_actionSubscribers</span></span><br><span class="line">          .<span class="title function_">filter</span>(<span class="function"><span class="params">sub</span> =&gt;</span> sub.<span class="property">error</span>)</span><br><span class="line">          .<span class="title function_">forEach</span>(<span class="function"><span class="params">sub</span> =&gt;</span> sub.<span class="title function_">error</span>(action, <span class="variable language_">this</span>.<span class="property">state</span>, error))</span><br><span class="line">      &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">        <span class="keyword">if</span> (__DEV__) &#123;</span><br><span class="line">          <span class="variable language_">console</span>.<span class="title function_">warn</span>(<span class="string">`[vuex] error in error action subscribers: `</span>)</span><br><span class="line">          <span class="variable language_">console</span>.<span class="title function_">error</span>(e)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="title function_">reject</span>(error)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å‰åŠéƒ¨åˆ†ä¸ <code>commit</code> æ–¹æ³•ç±»ä¼¼ï¼Œå°±ä¸å¤šè¯´äº†</p>
<p>ä»£ç ä¸­åˆå‡ºç°äº† <code>this._actionSubscribers</code> ï¼Œä¸ <code>commit</code> ä¸­çš„ä¹Ÿç±»ä¼¼ï¼Œå¯èƒ½è¿™é‡Œæ˜¯å­˜æ”¾ <code>actions</code> çš„è®¢é˜…è€…çš„ä¸œè¥¿ï¼Œæ‰€ä»¥è¿™äº›éƒ½å…ˆä¸çœ‹äº†</p>
<p>å…¶ä¸­å˜é‡ <code>result</code> ï¼Œå…ˆåˆ¤æ–­ <code>entry</code> çš„é•¿åº¦ï¼Œè‹¥å¤§äº1ï¼Œåˆ™è¡¨ç¤ºæœ‰å¤šä¸ªå¼‚æ­¥æ–¹æ³•ï¼Œæ‰€ä»¥ç”¨ <code>Promise.all</code> è¿›è¡ŒåŒ…è£¹ ; å¦åˆ™ç›´æ¥æ‰§è¡Œ <code>entry[0]</code></p>
<p>æœ€ååˆ›å»ºå¹¶è¿”å›äº†ä¸€ä¸ªæ–°çš„ <code>promise</code> ï¼Œå†…éƒ¨åˆ¤æ–­äº† <code>result</code> çš„çŠ¶æ€ï¼ŒæˆåŠŸåˆ™æ‰§è¡Œ <code>resolve</code> ï¼Œå¤±è´¥åˆ™æ‰§è¡Œ <code>reject</code></p>
<p>åˆ°æ­¤ä¸ºæ­¢ï¼Œæˆ‘ä»¬å·²ç»å®ç°äº† <code>store.state</code> ã€<code>store.getters</code> ã€<code>store.commit</code> ã€<code>store.dispatch</code> çš„è°ƒç”¨äº†</p>
<h4 id="3-5-æ’ä»¶çš„è°ƒç”¨"><a href="#3-5-æ’ä»¶çš„è°ƒç”¨" class="headerlink" title="3.5 æ’ä»¶çš„è°ƒç”¨"></a>3.5 æ’ä»¶çš„è°ƒç”¨</h4><p>ç»§ç»­çœ‹ <code>constructor</code> ä¸­çš„ä»£ç ï¼ˆè¿™æ®µä»£ç ä¹Ÿæ˜¯æ•´ä¸ª <code>Store</code> ç±»çš„æ„é€ å‡½æ•°ä¸­æœ€åçš„ä¸€å°æ®µä»£ç äº†ï¼‰</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä¾æ¬¡è°ƒç”¨ä¼ å…¥çš„æ’ä»¶</span></span><br><span class="line">plugins.<span class="title function_">forEach</span>(<span class="function"><span class="params">plugin</span> =&gt;</span> <span class="title function_">plugin</span>(<span class="variable language_">this</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> useDevtools = options.<span class="property">devtools</span> !== <span class="literal">undefined</span> ? options.<span class="property">devtools</span> : <span class="title class_">Vue</span>.<span class="property">config</span>.<span class="property">devtools</span></span><br><span class="line"><span class="comment">// ä½¿ç”¨vueçš„å¼€å‘æ’ä»¶</span></span><br><span class="line"><span class="keyword">if</span> (useDevtools) &#123;</span><br><span class="line">  <span class="title function_">devtoolPlugin</span>(<span class="variable language_">this</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é¦–å…ˆå°±æ˜¯éå†åˆ›å»º <code>Store</code> ç±»æ—¶ä¼ å…¥çš„å‚æ•° <code>Plugins</code> ï¼Œä¾æ¬¡è°ƒç”¨ä¼ å…¥çš„æ’ä»¶å‡½æ•°ï¼ˆå½“ç„¶ä¸€èˆ¬æˆ‘ä»¬éƒ½æ²¡æœ‰ä¼ å…¥ï¼Œæ‰€ä»¥ <code>Plugins</code> é»˜è®¤æ˜¯ç©ºæ•°ç»„ï¼‰</p>
<p>ç„¶åå°±æ˜¯è°ƒç”¨ <code>devtoolPlugin</code> æ–¹æ³•å•¦ï¼Œæ ¹æ®å¯¼å…¥çš„è·¯å¾„æˆ‘ä»¬å»åˆ°ç›¸åº”çš„æ–‡ä»¶</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ–‡ä»¶è·¯å¾„ï¼š./plugins/devtool.js</span></span><br><span class="line"><span class="keyword">const</span> target = <span class="keyword">typeof</span> <span class="variable language_">window</span> !== <span class="string">&#x27;undefined&#x27;</span></span><br><span class="line">  ? <span class="variable language_">window</span></span><br><span class="line">  : <span class="keyword">typeof</span> <span class="variable language_">global</span> !== <span class="string">&#x27;undefined&#x27;</span></span><br><span class="line">    ? <span class="variable language_">global</span></span><br><span class="line">    : &#123;&#125;</span><br><span class="line"><span class="keyword">const</span> devtoolHook = target.<span class="property">__VUE_DEVTOOLS_GLOBAL_HOOK__</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">devtoolPlugin</span> (store) &#123;</span><br><span class="line">  <span class="keyword">if</span> (!devtoolHook) <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">  store.<span class="property">_devtoolHook</span> = devtoolHook</span><br><span class="line"></span><br><span class="line">  devtoolHook.<span class="title function_">emit</span>(<span class="string">&#x27;vuex:init&#x27;</span>, store)</span><br><span class="line"></span><br><span class="line">  devtoolHook.<span class="title function_">on</span>(<span class="string">&#x27;vuex:travel-to-state&#x27;</span>, <span class="function"><span class="params">targetState</span> =&gt;</span> &#123;</span><br><span class="line">    store.<span class="title function_">replaceState</span>(targetState)</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  store.<span class="title function_">subscribe</span>(<span class="function">(<span class="params">mutation, state</span>) =&gt;</span> &#123;</span><br><span class="line">    devtoolHook.<span class="title function_">emit</span>(<span class="string">&#x27;vuex:mutation&#x27;</span>, mutation, state)</span><br><span class="line">  &#125;, &#123; <span class="attr">prepend</span>: <span class="literal">true</span> &#125;)</span><br><span class="line"></span><br><span class="line">  store.<span class="title function_">subscribeAction</span>(<span class="function">(<span class="params">action, state</span>) =&gt;</span> &#123;</span><br><span class="line">    devtoolHook.<span class="title function_">emit</span>(<span class="string">&#x27;vuex:action&#x27;</span>, action, state)</span><br><span class="line">  &#125;, &#123; <span class="attr">prepend</span>: <span class="literal">true</span> &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>çœ‹äº†åŠå¤©ï¼Œæœç´¢äº†åŠå¤©ï¼Œéƒ½æ²¡æœ‰æ‰¾åˆ°å“ªä¸ªæ–‡ä»¶é‡Œæœ‰ <code>__VUE_DEVTOOLS_GLOBAL_HOOK__</code> ï¼Œåº”è¯¥æ˜¯ <code>dev-tools</code> æ’ä»¶é‡Œå®šä¹‰çš„ï¼Œä¸ºäº†ä¿è¯ <code>Vuex</code> çš„æºç é˜…è¯»è¿›åº¦ï¼Œå°±å…ˆèˆå¼ƒé˜…è¯» <code>dev-tools</code> æ’ä»¶çš„å†…å®¹äº†</p>
<h4 id="3-6-å…¶å®ƒæ–¹æ³•"><a href="#3-6-å…¶å®ƒæ–¹æ³•" class="headerlink" title="3.6 å…¶å®ƒæ–¹æ³•"></a>3.6 å…¶å®ƒæ–¹æ³•</h4><p>æ•´ä¸ª <code>Store</code> å®ä¾‹ç”Ÿæˆçš„å…¨è¿‡ç¨‹å·®ä¸å¤šå°±æ˜¯è¿™æ ·äº†ï¼Œå¦å¤–è¿˜ä¼šå‘ç°ï¼Œå…¶å®æœ‰å¾ˆå¤šæ–¹æ³•éƒ½æ²¡æœ‰è¢«ç”¨åˆ°ï¼Œä½†æ˜¯å´è¢«å®šä¹‰å‡ºæ¥äº†ï¼Œè¿™é‡Œå¯ä»¥ç¨å¾®åˆ—ä¸¾å‡ ä¸ªç®€å•åœ°çœ‹ä¸€ä¸‹</p>
<h5 id="3-6-1-æ›´æ–°-state"><a href="#3-6-1-æ›´æ–°-state" class="headerlink" title="3.6.1 æ›´æ–° state"></a>3.6.1 æ›´æ–° state</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åœ¨store._committing = true çš„çŠ¶æ€ä¸‹æ›´æ–°ä¸€ä¸‹state</span></span><br><span class="line">replaceState (state) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="title function_">_withCommit</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">_vm</span>.<span class="property">_data</span>.<span class="property">$$state</span> = state</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸€ç›®äº†ç„¶ï¼Œè¿™æ˜¯æä¾›äº†ä¸€ç§ç›´æ¥ä¿®æ”¹ <code>state</code> çš„æ–¹æ³•ï¼Œå¹¶ä¸”ä¸ä¼šæ‰“å°è­¦å‘Šä¿¡æ¯</p>
<h5 id="3-6-2-æ³¨å†Œã€å¸è½½æ¨¡å—"><a href="#3-6-2-æ³¨å†Œã€å¸è½½æ¨¡å—" class="headerlink" title="3.6.2 æ³¨å†Œã€å¸è½½æ¨¡å—"></a>3.6.2 æ³¨å†Œã€å¸è½½æ¨¡å—</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ³¨å†Œæ¨¡å—</span></span><br><span class="line">registerModule (path, rawModule, options = &#123;&#125;) &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> path === <span class="string">&#x27;string&#x27;</span>) path = [path]</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (__DEV__) &#123;</span><br><span class="line">    <span class="title function_">assert</span>(<span class="title class_">Array</span>.<span class="title function_">isArray</span>(path), <span class="string">`module path must be a string or an Array.`</span>)</span><br><span class="line">    <span class="title function_">assert</span>(path.<span class="property">length</span> &gt; <span class="number">0</span>, <span class="string">&#x27;cannot register the root module by using registerModule.&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">_modules</span>.<span class="title function_">register</span>(path, rawModule)</span><br><span class="line">  <span class="title function_">installModule</span>(<span class="variable language_">this</span>, <span class="variable language_">this</span>.<span class="property">state</span>, path, <span class="variable language_">this</span>.<span class="property">_modules</span>.<span class="title function_">get</span>(path), options.<span class="property">preserveState</span>)</span><br><span class="line">  <span class="comment">// reset store to update getters...</span></span><br><span class="line">  <span class="title function_">resetStoreVM</span>(<span class="variable language_">this</span>, <span class="variable language_">this</span>.<span class="property">state</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¸è½½æ¨¡å—</span></span><br><span class="line">unregisterModule (path) &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> path === <span class="string">&#x27;string&#x27;</span>) path = [path]</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (__DEV__) &#123;</span><br><span class="line">    <span class="title function_">assert</span>(<span class="title class_">Array</span>.<span class="title function_">isArray</span>(path), <span class="string">`module path must be a string or an Array.`</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">_modules</span>.<span class="title function_">unregister</span>(path)</span><br><span class="line">  <span class="variable language_">this</span>.<span class="title function_">_withCommit</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> parentState = <span class="title function_">getNestedState</span>(<span class="variable language_">this</span>.<span class="property">state</span>, path.<span class="title function_">slice</span>(<span class="number">0</span>, -<span class="number">1</span>))</span><br><span class="line">    <span class="title class_">Vue</span>.<span class="title function_">delete</span>(parentState, path[path.<span class="property">length</span> - <span class="number">1</span>])</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="title function_">resetStore</span>(<span class="variable language_">this</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="3-6-3-é‡ç½®-store-å®ä¾‹"><a href="#3-6-3-é‡ç½®-store-å®ä¾‹" class="headerlink" title="3.6.3 é‡ç½® store å®ä¾‹"></a>3.6.3 é‡ç½® store å®ä¾‹</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é‡ç½®storeï¼Œå³æ³¨å†Œæ¨¡å—ã€ç”Ÿæˆvmç­‰æ“ä½œ</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">resetStore</span> (store, hot) &#123;</span><br><span class="line">  store.<span class="property">_actions</span> = <span class="title class_">Object</span>.<span class="title function_">create</span>(<span class="literal">null</span>)</span><br><span class="line">  store.<span class="property">_mutations</span> = <span class="title class_">Object</span>.<span class="title function_">create</span>(<span class="literal">null</span>)</span><br><span class="line">  store.<span class="property">_wrappedGetters</span> = <span class="title class_">Object</span>.<span class="title function_">create</span>(<span class="literal">null</span>)</span><br><span class="line">  store.<span class="property">_modulesNamespaceMap</span> = <span class="title class_">Object</span>.<span class="title function_">create</span>(<span class="literal">null</span>)</span><br><span class="line">  <span class="keyword">const</span> state = store.<span class="property">state</span></span><br><span class="line">  <span class="comment">// init all modules</span></span><br><span class="line">  <span class="title function_">installModule</span>(store, state, [], store.<span class="property">_modules</span>.<span class="property">root</span>, <span class="literal">true</span>)</span><br><span class="line">  <span class="comment">// reset vm</span></span><br><span class="line">  <span class="title function_">resetStoreVM</span>(store, state, hot)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å°†æ‰€æœ‰çš„çŠ¶æ€éƒ½æ¸…ç©ºï¼Œç„¶åé‡æ–°æ‰§è¡Œä¸€è¾¹ <code>installModule</code> å’Œ <code>resetStoreVM</code> ï¼Œè¿™ä¸€èˆ¬åœ¨æ¨¡å—ç»“æ„å˜åŒ–ä»¥åè°ƒç”¨ï¼Œä¾‹å¦‚æŸä¸ªæ¨¡å—è¢«å¸è½½</p>
<h3 id="4-install-æ³¨å†Œ"><a href="#4-install-æ³¨å†Œ" class="headerlink" title="4. install æ³¨å†Œ"></a>4. install æ³¨å†Œ</h3><p><code>Store</code> ç±»çš„æ‰€æœ‰å®ç°éƒ½äº†è§£å®Œäº†ï¼Œå†æ¥çœ‹ä¸€ä¸‹å…¥å£æ–‡ä»¶é‡Œè¿˜æœ‰ä»€ä¹ˆï¼Œçªç„¶å‘ç°å¿˜è®°çœ‹ä¸€ä¸‹éå¸¸é‡è¦çš„ <code>install</code> æ–¹æ³•äº†ï¼Œæ ¹æ® <code>install</code> æ–¹æ³•çš„å¯¼å…¥è·¯å¾„æ‰¾åˆ°ç›¸åº”çš„å‡½æ•°ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æä¾›installæ–¹æ³•</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">install</span> (_Vue) &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="title class_">Vue</span> &amp;&amp; _Vue === <span class="title class_">Vue</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (__DEV__) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">error</span>(</span><br><span class="line">        <span class="string">&#x27;[vuex] already installed. Vue.use(Vuex) should be called only once.&#x27;</span></span><br><span class="line">      )</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title class_">Vue</span> = _Vue</span><br><span class="line">  <span class="title function_">applyMixin</span>(<span class="title class_">Vue</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å½“æˆ‘ä»¬è°ƒç”¨ <code>Vue.use(vuex)</code> æ—¶ï¼Œè°ƒç”¨è¿™ä¸ªæ–¹æ³•ï¼Œå…ˆåˆ¤æ–­ <code>vuex</code> æ˜¯å¦å·²è¢«æ³¨å†Œï¼Œè‹¥å·²è¢«æ³¨å†Œï¼Œåˆ™ä¸æ‰§è¡Œä»»ä½•æ“ä½œ ; è‹¥æ²¡æœ‰è¢«æ³¨å†Œï¼Œåˆ™è°ƒç”¨ <code>applyMixin</code> æ–¹æ³•ï¼Œç°åœ¨ç§»æ­¥åˆ° <code>./mixin.js</code> æ–‡ä»¶ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> (<span class="params">Vue</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> version = <span class="title class_">Number</span>(<span class="title class_">Vue</span>.<span class="property">version</span>.<span class="title function_">split</span>(<span class="string">&#x27;.&#x27;</span>)[<span class="number">0</span>])</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 2.xç‰ˆæœ¬ç›´æ¥é€šè¿‡å…¨å±€æ··å…¥Vue.mixinçš„æ–¹å¼æŒ‚è½½store</span></span><br><span class="line">  <span class="keyword">if</span> (version &gt;= <span class="number">2</span>) &#123;</span><br><span class="line">    <span class="title class_">Vue</span>.<span class="title function_">mixin</span>(&#123; <span class="attr">beforeCreate</span>: vuexInit &#125;)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// å…¼å®¹1.xç‰ˆæœ¬</span></span><br><span class="line">    <span class="keyword">const</span> _init = <span class="title class_">Vue</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">_init</span></span><br><span class="line">    <span class="title class_">Vue</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">_init</span> = <span class="keyword">function</span> (<span class="params">options = &#123;&#125;</span>) &#123;</span><br><span class="line">      options.<span class="property">init</span> = options.<span class="property">init</span></span><br><span class="line">        ? [vuexInit].<span class="title function_">concat</span>(options.<span class="property">init</span>)</span><br><span class="line">        : vuexInit</span><br><span class="line">      _init.<span class="title function_">call</span>(<span class="variable language_">this</span>, options)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å°†vuexæ··å…¥åˆ°$optionsä¸­</span></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">vuexInit</span> () &#123;</span><br><span class="line">    <span class="comment">// è·å–å½“å‰ç»„ä»¶çš„ $options</span></span><br><span class="line">    <span class="keyword">const</span> options = <span class="variable language_">this</span>.<span class="property">$options</span></span><br><span class="line">    <span class="comment">// è‹¥å½“å‰ç»„ä»¶çš„$optionsä¸Šå·²å­˜åœ¨storeï¼Œåˆ™å°†$options.storeèµ‹å€¼ç»™this.$storeï¼ˆä¸€èˆ¬æ˜¯ç”¨äºæ ¹ç»„ä»¶çš„ï¼‰</span></span><br><span class="line">    <span class="keyword">if</span> (options.<span class="property">store</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">$store</span> = <span class="keyword">typeof</span> options.<span class="property">store</span> === <span class="string">&#x27;function&#x27;</span></span><br><span class="line">        ? options.<span class="title function_">store</span>()</span><br><span class="line">        : options.<span class="property">store</span></span><br><span class="line">    &#125; </span><br><span class="line">    <span class="comment">// å½“å‰ç»„ä»¶çš„$optionsä¸Šæ²¡æœ‰storeï¼Œåˆ™è·å–çˆ¶ç»„ä»¶ä¸Šçš„$storeï¼Œå³$options.parent.$storeï¼Œå¹¶å°†å…¶èµ‹å€¼ç»™this.$storeï¼ˆä¸€èˆ¬ç”¨äºå­ç»„ä»¶ï¼‰</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (options.<span class="property">parent</span> &amp;&amp; options.<span class="property">parent</span>.<span class="property">$store</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">$store</span> = options.<span class="property">parent</span>.<span class="property">$store</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>applyMixin</code> æ–¹æ³•å…ˆåˆ¤æ–­äº† <code>Vue</code> çš„ç‰ˆæœ¬å·ï¼Œä¸»è¦åšçš„æ˜¯ä¸€ä¸ªå‘ä¸‹å…¼å®¹ <code>Vue 1.x</code> çš„ç‰ˆæœ¬ï¼Œè¿™é‡Œæˆ‘å¯¹ <code>Vue 1.x</code> çš„ç‰ˆæœ¬ä¸å¤ªç†Ÿæ‚‰ï¼Œæ‰€ä»¥å°±ç›´æ¥çœ‹ <code>Vue 2.x</code> ç‰ˆæœ¬çš„å¤„ç†æ–¹å¼å§</p>
<p>é€šè¿‡ <code>Vue.minxin</code> æ–¹æ³•åšäº†ä¸€ä¸ªå…¨å±€çš„æ··å…¥ï¼Œåœ¨æ¯ä¸ªç»„ä»¶ <code>beforeCreate</code> ç”Ÿå‘½å‘¨æœŸæ—¶ä¼šè°ƒç”¨ <code>vuexInit</code> æ–¹æ³•ï¼Œè¯¥æ–¹æ³•å¤„ç†å¾—éå¸¸å·§å¦™ï¼Œé¦–å…ˆè·å–å½“å‰ç»„ä»¶çš„ <code>$options</code> ï¼Œåˆ¤æ–­å½“å‰ç»„ä»¶çš„ <code>$options</code> ä¸Šæ˜¯å¦æœ‰ <code>sotre</code> ï¼Œè‹¥æœ‰åˆ™å°† <code>store</code> èµ‹å€¼ç»™å½“å‰ç»„ä»¶ï¼Œå³ <code>this.$store</code> ï¼Œè¿™ä¸ªä¸€èˆ¬æ˜¯åˆ¤æ–­æ ¹ç»„ä»¶çš„ï¼Œå› ä¸ºåªæœ‰åœ¨åˆå§‹åŒ– <code>Vue</code> å®ä¾‹çš„æ—¶å€™æˆ‘ä»¬æ‰æ‰‹åŠ¨ä¼ å…¥äº† <code>store</code> ; è‹¥ <code>$options</code> ä¸Šæ²¡æœ‰ <code>store</code> ï¼Œåˆ™ä»£è¡¨å½“å‰ä¸æ˜¯æ ¹ç»„ä»¶ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±å»çˆ¶ç»„ä»¶ä¸Šè·å–ï¼Œå¹¶èµ‹å€¼ç»™å½“å‰ç»„ä»¶ï¼Œå³å½“å‰ç»„ä»¶ä¹Ÿå¯ä»¥é€šè¿‡ <code>this.$store</code> è®¿é—®åˆ° <code>store</code> å®ä¾‹äº†</p>
<p>è¿™é‡Œä¸å¾—ä¸æ„Ÿå¹ï¼Œè¿™ä¸ªå¤„ç†æ–¹å¼å¤ªæ£’äº†ã€‚</p>
<h3 id="5-è¾…åŠ©å‡½æ•°"><a href="#5-è¾…åŠ©å‡½æ•°" class="headerlink" title="5. è¾…åŠ©å‡½æ•°"></a>5. è¾…åŠ©å‡½æ•°</h3><p><code>store</code>å®ä¾‹ç”Ÿæˆå¹¶ä¸”ä¹Ÿ <code>install</code> åˆ° <code>Vue</code> ä¸Šäº†ï¼Œçœ‹ä¸€ä¸‹å…¥å£æ–‡ä»¶ä¸­åªå‰©ä¸‹è¾…åŠ©å‡½æ•°äº†ï¼Œå®ƒä»¬æœ‰ <code>mapState</code> ã€<code>mapGetters</code> ã€<code>mapMutations</code> ã€<code>mapActions</code> ã€<code>createNamespacedHelpers</code> ï¼Œè¿›åˆ°ç›¸åº”çš„æ–‡ä»¶ <code>./helpers.js</code> ä¸­çœ‹ä¸€ä¸‹</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; isObject &#125; <span class="keyword">from</span> <span class="string">&#x27;./util.js&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> mapState = <span class="title function_">normalizeNamespace</span>(<span class="function">(<span class="params">namespace, states</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> res = &#123;&#125;</span><br><span class="line">  <span class="keyword">if</span> (__DEV__ &amp;&amp; !<span class="title function_">isValidMap</span>(states)) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;[vuex] mapState: mapper parameter must be either an Array or an Object&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">normalizeMap</span>(states).<span class="title function_">forEach</span>(<span class="function">(<span class="params">&#123; key, val &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">    res[key] = <span class="keyword">function</span> <span class="title function_">mappedState</span> () &#123;</span><br><span class="line">      <span class="keyword">let</span> state = <span class="variable language_">this</span>.<span class="property">$store</span>.<span class="property">state</span></span><br><span class="line">      <span class="keyword">let</span> getters = <span class="variable language_">this</span>.<span class="property">$store</span>.<span class="property">getters</span></span><br><span class="line">      <span class="keyword">if</span> (namespace) &#123;</span><br><span class="line">        <span class="keyword">const</span> <span class="variable language_">module</span> = <span class="title function_">getModuleByNamespace</span>(<span class="variable language_">this</span>.<span class="property">$store</span>, <span class="string">&#x27;mapState&#x27;</span>, namespace)</span><br><span class="line">        <span class="keyword">if</span> (!<span class="variable language_">module</span>) &#123;</span><br><span class="line">          <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">        state = <span class="variable language_">module</span>.<span class="property">context</span>.<span class="property">state</span></span><br><span class="line">        getters = <span class="variable language_">module</span>.<span class="property">context</span>.<span class="property">getters</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">typeof</span> val === <span class="string">&#x27;function&#x27;</span></span><br><span class="line">        ? val.<span class="title function_">call</span>(<span class="variable language_">this</span>, state, getters)</span><br><span class="line">        : state[val]</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// mark vuex getter for devtools</span></span><br><span class="line">    res[key].<span class="property">vuex</span> = <span class="literal">true</span></span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="keyword">return</span> res</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> mapMutations = <span class="title function_">normalizeNamespace</span>(<span class="function">(<span class="params">namespace, mutations</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> res = &#123;&#125;</span><br><span class="line">  <span class="keyword">if</span> (__DEV__ &amp;&amp; !<span class="title function_">isValidMap</span>(mutations)) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;[vuex] mapMutations: mapper parameter must be either an Array or an Object&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">normalizeMap</span>(mutations).<span class="title function_">forEach</span>(<span class="function">(<span class="params">&#123; key, val &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">    res[key] = <span class="keyword">function</span> <span class="title function_">mappedMutation</span> (...args) &#123;</span><br><span class="line">      <span class="comment">// Get the commit method from store</span></span><br><span class="line">      <span class="keyword">let</span> commit = <span class="variable language_">this</span>.<span class="property">$store</span>.<span class="property">commit</span></span><br><span class="line">      <span class="keyword">if</span> (namespace) &#123;</span><br><span class="line">        <span class="keyword">const</span> <span class="variable language_">module</span> = <span class="title function_">getModuleByNamespace</span>(<span class="variable language_">this</span>.<span class="property">$store</span>, <span class="string">&#x27;mapMutations&#x27;</span>, namespace)</span><br><span class="line">        <span class="keyword">if</span> (!<span class="variable language_">module</span>) &#123;</span><br><span class="line">          <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">        commit = <span class="variable language_">module</span>.<span class="property">context</span>.<span class="property">commit</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">typeof</span> val === <span class="string">&#x27;function&#x27;</span></span><br><span class="line">        ? val.<span class="title function_">apply</span>(<span class="variable language_">this</span>, [commit].<span class="title function_">concat</span>(args))</span><br><span class="line">        : commit.<span class="title function_">apply</span>(<span class="variable language_">this</span>.<span class="property">$store</span>, [val].<span class="title function_">concat</span>(args))</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="keyword">return</span> res</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> mapGetters = <span class="title function_">normalizeNamespace</span>(<span class="function">(<span class="params">namespace, getters</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> res = &#123;&#125;</span><br><span class="line">  <span class="keyword">if</span> (__DEV__ &amp;&amp; !<span class="title function_">isValidMap</span>(getters)) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;[vuex] mapGetters: mapper parameter must be either an Array or an Object&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">normalizeMap</span>(getters).<span class="title function_">forEach</span>(<span class="function">(<span class="params">&#123; key, val &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// The namespace has been mutated by normalizeNamespace</span></span><br><span class="line">    val = namespace + val</span><br><span class="line">    res[key] = <span class="keyword">function</span> <span class="title function_">mappedGetter</span> () &#123;</span><br><span class="line">      <span class="keyword">if</span> (namespace &amp;&amp; !<span class="title function_">getModuleByNamespace</span>(<span class="variable language_">this</span>.<span class="property">$store</span>, <span class="string">&#x27;mapGetters&#x27;</span>, namespace)) &#123;</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (__DEV__ &amp;&amp; !(val <span class="keyword">in</span> <span class="variable language_">this</span>.<span class="property">$store</span>.<span class="property">getters</span>)) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">`[vuex] unknown getter: <span class="subst">$&#123;val&#125;</span>`</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">$store</span>.<span class="property">getters</span>[val]</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// mark vuex getter for devtools</span></span><br><span class="line">    res[key].<span class="property">vuex</span> = <span class="literal">true</span></span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="keyword">return</span> res</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> mapActions = <span class="title function_">normalizeNamespace</span>(<span class="function">(<span class="params">namespace, actions</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> res = &#123;&#125;</span><br><span class="line">  <span class="keyword">if</span> (__DEV__ &amp;&amp; !<span class="title function_">isValidMap</span>(actions)) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;[vuex] mapActions: mapper parameter must be either an Array or an Object&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">normalizeMap</span>(actions).<span class="title function_">forEach</span>(<span class="function">(<span class="params">&#123; key, val &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">    res[key] = <span class="keyword">function</span> <span class="title function_">mappedAction</span> (...args) &#123;</span><br><span class="line">      <span class="comment">// get dispatch function from store</span></span><br><span class="line">      <span class="keyword">let</span> dispatch = <span class="variable language_">this</span>.<span class="property">$store</span>.<span class="property">dispatch</span></span><br><span class="line">      <span class="keyword">if</span> (namespace) &#123;</span><br><span class="line">        <span class="keyword">const</span> <span class="variable language_">module</span> = <span class="title function_">getModuleByNamespace</span>(<span class="variable language_">this</span>.<span class="property">$store</span>, <span class="string">&#x27;mapActions&#x27;</span>, namespace)</span><br><span class="line">        <span class="keyword">if</span> (!<span class="variable language_">module</span>) &#123;</span><br><span class="line">          <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">        dispatch = <span class="variable language_">module</span>.<span class="property">context</span>.<span class="property">dispatch</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">typeof</span> val === <span class="string">&#x27;function&#x27;</span></span><br><span class="line">        ? val.<span class="title function_">apply</span>(<span class="variable language_">this</span>, [dispatch].<span class="title function_">concat</span>(args))</span><br><span class="line">        : dispatch.<span class="title function_">apply</span>(<span class="variable language_">this</span>.<span class="property">$store</span>, [val].<span class="title function_">concat</span>(args))</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="keyword">return</span> res</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Rebinding namespace param for mapXXX function in special scoped, and return them by simple object</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">String</span>&#125; <span class="variable">namespace</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> &#123;<span class="type">Object</span>&#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">createNamespacedHelpers</span> = (<span class="params">namespace</span>) =&gt; (&#123;</span><br><span class="line">  <span class="attr">mapState</span>: mapState.<span class="title function_">bind</span>(<span class="literal">null</span>, namespace),</span><br><span class="line">  <span class="attr">mapGetters</span>: mapGetters.<span class="title function_">bind</span>(<span class="literal">null</span>, namespace),</span><br><span class="line">  <span class="attr">mapMutations</span>: mapMutations.<span class="title function_">bind</span>(<span class="literal">null</span>, namespace),</span><br><span class="line">  <span class="attr">mapActions</span>: mapActions.<span class="title function_">bind</span>(<span class="literal">null</span>, namespace)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">normalizeMap</span> (map) &#123;</span><br><span class="line">  <span class="keyword">if</span> (!<span class="title function_">isValidMap</span>(map)) &#123;</span><br><span class="line">    <span class="keyword">return</span> []</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">Array</span>.<span class="title function_">isArray</span>(map)</span><br><span class="line">    ? map.<span class="title function_">map</span>(<span class="function"><span class="params">key</span> =&gt;</span> (&#123; key, <span class="attr">val</span>: key &#125;))</span><br><span class="line">    : <span class="title class_">Object</span>.<span class="title function_">keys</span>(map).<span class="title function_">map</span>(<span class="function"><span class="params">key</span> =&gt;</span> (&#123; key, <span class="attr">val</span>: map[key] &#125;))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">isValidMap</span> (map) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">Array</span>.<span class="title function_">isArray</span>(map) || <span class="title function_">isObject</span>(map)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">normalizeNamespace</span> (fn) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function">(<span class="params">namespace, map</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> namespace !== <span class="string">&#x27;string&#x27;</span>) &#123;</span><br><span class="line">      map = namespace</span><br><span class="line">      namespace = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    &#125; </span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (namespace.<span class="title function_">charAt</span>(namespace.<span class="property">length</span> - <span class="number">1</span>) !== <span class="string">&#x27;/&#x27;</span>) &#123;</span><br><span class="line">      namespace += <span class="string">&#x27;/&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">fn</span>(namespace, map)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getModuleByNamespace</span> (store, helper, namespace) &#123;</span><br><span class="line">  <span class="keyword">const</span> <span class="variable language_">module</span> = store.<span class="property">_modulesNamespaceMap</span>[namespace]</span><br><span class="line">  <span class="keyword">if</span> (__DEV__ &amp;&amp; !<span class="variable language_">module</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">`[vuex] module namespace not found in <span class="subst">$&#123;helper&#125;</span>(): <span class="subst">$&#123;namespace&#125;</span>`</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="variable language_">module</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ•´ä¸ªæ–‡ä»¶é‡Œä¸œè¥¿éå¸¸å¤šï¼Œä½†æˆ‘ä»¬å¾ˆæ˜ç¡®åœ°çŸ¥é“ï¼Œæˆ‘ä»¬ä¸»è¦çœ‹çš„å°±æ˜¯é‚£å‡ ä¸ªè¾…åŠ©å‡½æ•°ï¼Œè§‚å¯Ÿå‘ç°ï¼Œæ¯ä¸ªè¾…åŠ©å‡½æ•°éƒ½ä¼šå…ˆè°ƒç”¨ <code>normalizeNamespace</code> å‡½æ•°è¿›è¡Œå¤„ç†ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å…ˆçœ‹çœ‹è¿™ä¸ªå‡½æ•°åšäº†ä»€ä¹ˆï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">normalizeNamespace</span> (fn) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function">(<span class="params">namespace, map</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> namespace !== <span class="string">&#x27;string&#x27;</span>) &#123;</span><br><span class="line">      map = namespace</span><br><span class="line">      namespace = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    &#125; </span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (namespace.<span class="title function_">charAt</span>(namespace.<span class="property">length</span> - <span class="number">1</span>) !== <span class="string">&#x27;/&#x27;</span>) &#123;</span><br><span class="line">      namespace += <span class="string">&#x27;/&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">fn</span>(namespace, map)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ ¹æ®å‡½æ•°åçš„å­—é¢æ„æ€çŸ¥é“è¿™åº”è¯¥æ˜¯æ ¹æ®ä¸åŒçš„è°ƒç”¨æ–¹æ³•ï¼Œæ ‡å‡†åŒ–å‘½åç©ºé—´çš„ã€‚</p>
<p>é¦–å…ˆè¿”å›ä¸€ä¸ªå‡½æ•°ï¼Œæ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼Œå³ <code>namespace</code> å’Œ <code>map</code> ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ä»¬è°ƒç”¨è¾…åŠ©å‡½æ•°æ—¶å¯ä»¥ä¼ å…¥çš„ä¸¤ä¸ªå‚æ•° ;</p>
<p>ç„¶ååˆ¤æ–­ <code>namespace</code> æ˜¯å¦ä¸ºå­—ç¬¦ä¸²å½¢å¼ï¼Œè‹¥ä¸æ˜¯å­—ç¬¦ä¸²ï¼Œåˆ™è¡¨ç¤ºæ˜¯æ™®é€šçš„è°ƒç”¨æ–¹å¼ï¼Œä¾‹å¦‚ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">mapMutations</span>([<span class="string">&#x27;first/second/foo&#x27;</span>, <span class="string">&#x27;first/second/bar&#x27;</span>])</span><br><span class="line"></span><br><span class="line"><span class="title function_">mapMutations</span>(&#123;</span><br><span class="line">   <span class="attr">foo</span>: <span class="string">&#x27;first/second/foo&#x27;</span>,</span><br><span class="line">   <span class="attr">bar</span>: <span class="string">&#x27;first/second/bar&#x27;</span>,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>è¿™ç§æƒ…å†µï¼Œå°±ç›´æ¥å°†ç¬¬ä¸€ä¸ªå‚æ•° <code>namespace</code> èµ‹å€¼ç»™æ˜ å°„å˜é‡ <code>map</code> ï¼Œè€Œ <code>namespace</code> è®¾ä¸ºç©º</p>
<p>è‹¥æ˜¯å­—ç¬¦ä¸²çš„è¯ï¼Œåˆ™è¡¨ç¤ºè°ƒç”¨çš„æ˜¯å¸¦å‘½åç©ºé—´çš„ç»‘å®šå‡½æ•°çš„ï¼Œä¾‹å¦‚ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">mapState</span>(<span class="string">&#x27;first/second&#x27;</span>, [<span class="string">&#x27;foo&#x27;</span>, <span class="string">&#x27;bar&#x27;</span>])</span><br><span class="line"></span><br><span class="line"><span class="title function_">mapState</span>(<span class="string">&#x27;first/second&#x27;</span>, &#123;</span><br><span class="line">  <span class="attr">foo</span>: <span class="string">&#x27;foo&#x27;</span>,</span><br><span class="line">  <span class="attr">bar</span>: <span class="string">&#x27;bar&#x27;</span>,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>å¤„ç†å¥½è¿™ä¸¤ç§ä¸åŒçš„è°ƒç”¨æ–¹å¼ä»¥åï¼Œè°ƒç”¨ä¸€ä¸‹ <code>fn</code> ï¼Œå¹¶å°† <code>namespace</code> å’Œ <code>map</code> ä½œä¸ºå‚æ•°</p>
<p>é‚£ä¹ˆå°±å…ˆä» <code>mapState</code> å¼€å§‹çœ‹å§</p>
<h4 id="5-1-mapState"><a href="#5-1-mapState" class="headerlink" title="5.1 mapState"></a>5.1 mapState</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"> mapState = <span class="title function_">normalizeNamespace</span>(<span class="function">(<span class="params">namespace, states</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> res = &#123;&#125;</span><br><span class="line">  <span class="keyword">if</span> (__DEV__ &amp;&amp; !<span class="title function_">isValidMap</span>(states)) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;[vuex] mapState: mapper parameter must be either an Array or an Object&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">normalizeMap</span>(states).<span class="title function_">forEach</span>(<span class="function">(<span class="params">&#123; key, val &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">    res[key] = <span class="keyword">function</span> <span class="title function_">mappedState</span> () &#123;</span><br><span class="line">      <span class="keyword">let</span> state = <span class="variable language_">this</span>.<span class="property">$store</span>.<span class="property">state</span></span><br><span class="line">      <span class="keyword">let</span> getters = <span class="variable language_">this</span>.<span class="property">$store</span>.<span class="property">getters</span></span><br><span class="line">      <span class="keyword">if</span> (namespace) &#123;</span><br><span class="line">        <span class="keyword">const</span> <span class="variable language_">module</span> = <span class="title function_">getModuleByNamespace</span>(<span class="variable language_">this</span>.<span class="property">$store</span>, <span class="string">&#x27;mapState&#x27;</span>, namespace)</span><br><span class="line">        <span class="keyword">if</span> (!<span class="variable language_">module</span>) &#123;</span><br><span class="line">          <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">        state = <span class="variable language_">module</span>.<span class="property">context</span>.<span class="property">state</span></span><br><span class="line">        getters = <span class="variable language_">module</span>.<span class="property">context</span>.<span class="property">getters</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">typeof</span> val === <span class="string">&#x27;function&#x27;</span></span><br><span class="line">        ? val.<span class="title function_">call</span>(<span class="variable language_">this</span>, state, getters)</span><br><span class="line">        : state[val]</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// mark vuex getter for devtools</span></span><br><span class="line">    res[key].<span class="property">vuex</span> = <span class="literal">true</span></span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="keyword">return</span> res</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œçš„ <code>namespace</code> æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œ<code>states</code> æ˜¯æˆ‘ä»¬åˆšæ‰å¤„ç†å¥½çš„æ˜ å°„å˜é‡ <code>map</code></p>
<p>é¦–å…ˆåˆ›å»ºä¸€ä¸ªç©ºå¯¹è±¡ <code>res</code> ï¼Œè¿™æ˜¯æˆ‘ä»¬æœ€åå¤„ç†å¥½è¦è¿”å›çš„å˜é‡ ;</p>
<p>ç„¶åé€šè¿‡ <code>isValidMap</code> æ–¹æ³•åˆ¤æ–­ <code>map</code> æ˜¯å¦ç¬¦åˆè¦æ±‚ï¼Œå³æ˜¯å¦æ˜¯æ•°ç»„æˆ–å¯¹è±¡ ;</p>
<p>å†ç„¶åè°ƒç”¨äº† <code>normalizeMap</code> æ–¹æ³•å¤„ç†äº†å˜é‡ <code>states</code> ï¼Œä»å­—é¢æ„ä¹‰ä¸Šæ¥çœ‹ï¼Œè¿™æ˜¯ç”¨æ¥æ ‡å‡†åŒ–è¯¥å˜é‡çš„ï¼Œå› ä¸ºæ¯•ç«Ÿæœ‰å¯èƒ½æ˜¯æ•°ç»„åˆæœ‰å¯èƒ½æ˜¯å¯¹è±¡å˜›ï¼Œæ‰€ä»¥è¦ç»Ÿä¸€ä¸€ä¸‹ã€‚æ¥çœ‹ä¸€ä¸‹ <code>normalizeMap</code> æ–¹æ³•çš„å®ç°ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">normalizeMap</span> (map) &#123;</span><br><span class="line">  <span class="keyword">if</span> (!<span class="title function_">isValidMap</span>(map)) &#123;</span><br><span class="line">    <span class="keyword">return</span> []</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">Array</span>.<span class="title function_">isArray</span>(map)</span><br><span class="line">    ? map.<span class="title function_">map</span>(<span class="function"><span class="params">key</span> =&gt;</span> (&#123; key, <span class="attr">val</span>: key &#125;))</span><br><span class="line">    : <span class="title class_">Object</span>.<span class="title function_">keys</span>(map).<span class="title function_">map</span>(<span class="function"><span class="params">key</span> =&gt;</span> (&#123; key, <span class="attr">val</span>: map[key] &#125;))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é¦–å…ˆä»ç„¶è¦å…ˆåˆ¤æ–­ <code>map</code> æ˜¯å¦åˆæ³•ï¼Œè‹¥ä¸åˆæ³•ï¼Œåˆ™è¿”å›ç©ºæ•°ç»„ï¼Œé¿å…åç»­çš„ä»£ç æŠ¥é”™ ;</p>
<p>ç„¶ååˆ¤æ–­ <code>map</code> æ˜¯å¦ä¸ºæ•°ç»„ï¼Œè‹¥æ˜¯æ•°ç»„ï¼Œåˆ™éå† <code>map</code> è¿›è¡Œå¤„ç†ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">å°† [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>] å˜æˆ [&#123;<span class="attr">key</span>: <span class="number">1</span>, <span class="attr">val</span>: <span class="number">1</span>&#125;, &#123;<span class="attr">key</span>: <span class="number">2</span>, <span class="attr">val</span>: <span class="number">2</span>&#125;, &#123;<span class="attr">key</span>: <span class="number">3</span>, <span class="attr">val</span>: <span class="number">3</span>&#125;]</span><br></pre></td></tr></table></figure>

<p>è‹¥ <code>map</code> ä¸æ˜¯æ•°ç»„ï¼Œåˆ™ä¸€å®šä¸ºå¯¹è±¡ï¼Œé‚£ä¹ˆåŒæ ·ä¹Ÿè¦æŠŠå…¶å¤„ç†æˆè·Ÿä¸Šé¢ä¸€æ ·çš„æ ¼å¼ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">å°† &#123;<span class="attr">a</span>: <span class="number">1</span>, <span class="attr">b</span>: <span class="number">2</span>, <span class="attr">c</span>: <span class="number">3</span>&#125; å˜æˆ [&#123;<span class="attr">key</span>: a, <span class="attr">val</span>: <span class="number">1</span>&#125;, &#123;<span class="attr">key</span>: b, <span class="attr">val</span>: <span class="number">2</span>&#125;, &#123;<span class="attr">key</span>: c, <span class="attr">val</span>: <span class="number">3</span>&#125;]</span><br></pre></td></tr></table></figure>

<p>å¤„ç†å¥½äº†ä»¥åå°±ç›´æ¥è¿”å›ï¼Œåœ¨å¾—åˆ°æ ‡å‡†åŒ–ä»¥åçš„ <code>map</code> åè¦å¯¹å…¶è¿›è¡Œ <code>forEach</code> éå†ï¼Œå°†éå†åˆ°çš„æ¯ä¸€ä¸ªå¯¹è±¡ç»è¿‡å¤„ç†åå­˜æ”¾åœ¨ <code>res</code> ä¸­ï¼Œå³ <code>res[key] = function mappedState() &#123;...&#125;</code> ï¼Œæ¥çœ‹ä¸€ä¸‹è¿™ä¸ª <code>mappedState</code> é‡Œåšäº†ä»€ä¹ˆå¤„ç†</p>
<p>é¦–å…ˆè·å–ä¸€ä¸‹æ ¹æ¨¡å—ä¸Šçš„ <code>state</code> å’Œ <code>getters</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è·å–æ ¹æ¨¡å—çš„ state ã€getters</span></span><br><span class="line"><span class="keyword">let</span> state = <span class="variable language_">this</span>.<span class="property">$store</span>.<span class="property">state</span></span><br><span class="line"><span class="keyword">let</span> getters = <span class="variable language_">this</span>.<span class="property">$store</span>.<span class="property">getters</span></span><br></pre></td></tr></table></figure>

<p>ç„¶ååˆ¤æ–­æ˜¯å¦å­˜åœ¨å‘½åç©ºé—´ï¼Œå³ <code>namespace</code> æ˜¯å¦ä¸ºç©ºï¼Œè‹¥ä¸ºç©ºï¼Œåˆ™ä¸åšä»»ä½•å¤„ç† ; å¦åˆ™è°ƒç”¨ <code>getModuleByNamespace</code> æ–¹æ³•è·å–åˆ° <code>namespace</code> å¯¹åº”çš„æ¨¡å— <code>module</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">getModuleByNamespace</span> (store, helper, namespace) &#123;</span><br><span class="line">  <span class="keyword">const</span> <span class="variable language_">module</span> = store.<span class="property">_modulesNamespaceMap</span>[namespace]</span><br><span class="line">  <span class="keyword">if</span> (__DEV__ &amp;&amp; !<span class="variable language_">module</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">`[vuex] module namespace not found in <span class="subst">$&#123;helper&#125;</span>(): <span class="subst">$&#123;namespace&#125;</span>`</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="variable language_">module</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ° <code>store._modulesNamespaceMap</code> ç»ˆäºæ´¾ä¸Šäº†ç”¨åœºï¼Œåœ¨ç”Ÿæˆ <code>Store</code> å®ä¾‹æ³¨å†Œæ‰€æœ‰æ¨¡å—çš„æ—¶å€™ï¼Œå°†å¸¦æœ‰å‘½åç©ºé—´çš„æ¨¡å—éƒ½å­˜å‚¨åœ¨äº†è¯¥å˜é‡ä¸Šï¼ŒåŸæ¥æ˜¯åœ¨è¿™é‡Œç”¨ä¸Šäº†</p>
<p>ç„¶åå°†åˆšæ‰å£°æ˜çš„å˜é‡ <code>state</code> å’Œ <code>getters</code> æ›¿æ¢æˆ <code>module</code> å¯¹åº”ä¸Šä¸‹æ–‡ä¸­çš„ <code>state</code> å’Œ <code>getters</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (namespace) &#123;</span><br><span class="line">  <span class="comment">// è·å–å‘½åç©ºé—´namespaceå¯¹åº”çš„æ¨¡å—</span></span><br><span class="line">  <span class="keyword">const</span> <span class="variable language_">module</span> = <span class="title function_">getModuleByNamespace</span>(<span class="variable language_">this</span>.<span class="property">$store</span>, <span class="string">&#x27;mapState&#x27;</span>, namespace)</span><br><span class="line">  <span class="keyword">if</span> (!<span class="variable language_">module</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// å°† state ã€getters å˜æˆè¯¥æ¨¡å—ä¸Šä¸‹æ–‡ä¸­çš„ state ã€getters</span></span><br><span class="line">  state = <span class="variable language_">module</span>.<span class="property">context</span>.<span class="property">state</span></span><br><span class="line">  getters = <span class="variable language_">module</span>.<span class="property">context</span>.<span class="property">getters</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ª <code>context</code> ä¹Ÿæ˜¯éå¸¸çš„å·§å¦™ï¼Œåœ¨æ³¨å†Œæ¨¡å—çš„æ—¶å€™ï¼Œè·å–åˆ°è¯¥æ¨¡å—çš„ä¸Šä¸‹æ–‡çš„åŒæ—¶ï¼Œè¿˜å°†å…¶å­˜å‚¨äº†ä¸€ä¸‹ï¼Œå³ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> local = <span class="variable language_">module</span>.<span class="property">context</span> = <span class="title function_">makeLocalContext</span>(store, namespace, path)</span><br></pre></td></tr></table></figure>

<p>ä¹‹å‰çœ‹åˆ°çš„æ—¶å€™ä¸çŸ¥é“æœ‰å•¥ç”¨ï¼Œä½†åœ¨è¿™é‡Œçœ‹åˆ°åï¼Œè§‰å¾—çœŸçš„éå¸¸å¾—èµ ğŸ‘</p>
<p>ç¡®å®šå¥½äº† <code>state</code> å’Œ <code>getters</code> çš„å€¼ï¼Œæœ€åå°±å¯ä»¥è¿”å›å€¼äº†</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> <span class="keyword">typeof</span> val === <span class="string">&#x27;function&#x27;</span></span><br><span class="line">  ? val.<span class="title function_">call</span>(<span class="variable language_">this</span>, state, getters)</span><br><span class="line">  : state[val]</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œè¿˜åšäº†ä¸€å±‚å¤„ç†æ˜¯å› ä¸ºè¦å¤„ç†ä¸¤ç§ä¸åŒçš„æ–¹å¼ï¼Œä¾‹å¦‚ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">mapState</span>(&#123;</span><br><span class="line">  <span class="attr">foo</span>: <span class="function"><span class="params">state</span> =&gt;</span> state.<span class="property">foo</span>,</span><br><span class="line">  <span class="attr">bar</span>: <span class="string">&#x27;bar&#x27;</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™é‡Œæˆ‘åˆå‘ç°äº†ä¸€ä¸ªå®˜æ–¹æ–‡æ¡£é‡Œæ²¡æœ‰æåŠçš„ï¼Œå°±æ˜¯ä»¥å‡½æ•°å½¢å¼è¿”å›çš„æ—¶å€™ï¼Œè¿˜èƒ½æ¥æ”¶ç¬¬äºŒä¸ªå‚æ•° <code>getters</code> ï¼Œå³ï¼š<code>foo: (state, getters) =&gt; state.foo + getters.bar</code></p>
<h4 id="5-2-mapMutations"><a href="#5-2-mapMutations" class="headerlink" title="5.2 mapMutations"></a>5.2 mapMutations</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> mapMutations = <span class="title function_">normalizeNamespace</span>(<span class="function">(<span class="params">namespace, mutations</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> res = &#123;&#125;</span><br><span class="line">  <span class="keyword">if</span> (__DEV__ &amp;&amp; !<span class="title function_">isValidMap</span>(mutations)) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;[vuex] mapMutations: mapper parameter must be either an Array or an Object&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">normalizeMap</span>(mutations).<span class="title function_">forEach</span>(<span class="function">(<span class="params">&#123; key, val &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">    res[key] = <span class="keyword">function</span> <span class="title function_">mappedMutation</span> (...args) &#123;</span><br><span class="line">      <span class="comment">// Get the commit method from store</span></span><br><span class="line">      <span class="keyword">let</span> commit = <span class="variable language_">this</span>.<span class="property">$store</span>.<span class="property">commit</span></span><br><span class="line">      <span class="keyword">if</span> (namespace) &#123;</span><br><span class="line">        <span class="keyword">const</span> <span class="variable language_">module</span> = <span class="title function_">getModuleByNamespace</span>(<span class="variable language_">this</span>.<span class="property">$store</span>, <span class="string">&#x27;mapMutations&#x27;</span>, namespace)</span><br><span class="line">        <span class="keyword">if</span> (!<span class="variable language_">module</span>) &#123;</span><br><span class="line">          <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">        commit = <span class="variable language_">module</span>.<span class="property">context</span>.<span class="property">commit</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">typeof</span> val === <span class="string">&#x27;function&#x27;</span></span><br><span class="line">        ? val.<span class="title function_">apply</span>(<span class="variable language_">this</span>, [commit].<span class="title function_">concat</span>(args))</span><br><span class="line">        : commit.<span class="title function_">apply</span>(<span class="variable language_">this</span>.<span class="property">$store</span>, [val].<span class="title function_">concat</span>(args))</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="keyword">return</span> res</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p><code>mapMutations</code> ä¸ <code>mapState</code> çš„å®ç°å¤§ä½“ç›¸ä¼¼ï¼Œä¸»è¦çš„ä¸åŒå°±åœ¨ä¸‹é¢è¿™æ®µä»£ç ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> <span class="keyword">typeof</span> val === <span class="string">&#x27;function&#x27;</span></span><br><span class="line">  ? val.<span class="title function_">apply</span>(<span class="variable language_">this</span>, [commit].<span class="title function_">concat</span>(args))</span><br><span class="line">  : commit.<span class="title function_">apply</span>(<span class="variable language_">this</span>.<span class="property">$store</span>, [val].<span class="title function_">concat</span>(args))</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œä¹Ÿæ˜¯åƒ <code>mapState</code> ä¸€æ ·å¤„ç†äº†å‡½æ•°çš„è°ƒç”¨ç±»å‹å’Œæ™®é€šçš„è°ƒç”¨ç±»å‹ï¼Œä¾‹å¦‚ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">mapMutations</span>(&#123;</span><br><span class="line">  <span class="attr">foo</span>: <span class="function">(<span class="params">commit, num</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">commit</span>(<span class="string">&#x27;foo&#x27;</span>, num)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">bar</span>: <span class="string">&#x27;bar&#x27;</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>å½“æ˜¯å‡½æ•°çš„è°ƒç”¨ç±»å‹æ—¶ï¼Œåˆ™å°† <code>commit</code> ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°ï¼Œå¹¶æŠŠé¢å¤–çš„å‚æ•°ä¸€å¹¶ä¼ å…¥ï¼Œæ‰€ä»¥æ‰æœ‰çš„ <code>val.apply(this, [commit].concat(args))</code> è¿™æ®µä»£ç  ;</p>
<p>å½“æ˜¯æ™®é€šçš„è°ƒç”¨ç±»å‹æ—¶ï¼Œåˆ™ç›´æ¥æ‰§è¡Œ <code>commit</code> ï¼Œå…¶ä¸­ <code>val</code> å¯¹åº”çš„å°±æ˜¯è¯¥å‘½åç©ºé—´ä¸‹éœ€è¦è°ƒç”¨çš„ <code>mutations</code> æ–¹æ³•åï¼Œç„¶åå†æ¥æ”¶é¢å¤–çš„å‚æ•°ï¼Œå³ <code>commit.apply(this.$store, [val].concat(args))</code></p>
<h4 id="5-3-mapGetters"><a href="#5-3-mapGetters" class="headerlink" title="5.3 mapGetters"></a>5.3 mapGetters</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> mapGetters = <span class="title function_">normalizeNamespace</span>(<span class="function">(<span class="params">namespace, getters</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> res = &#123;&#125;</span><br><span class="line">  <span class="keyword">if</span> (__DEV__ &amp;&amp; !<span class="title function_">isValidMap</span>(getters)) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;[vuex] mapGetters: mapper parameter must be either an Array or an Object&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">normalizeMap</span>(getters).<span class="title function_">forEach</span>(<span class="function">(<span class="params">&#123; key, val &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// The namespace has been mutated by normalizeNamespace</span></span><br><span class="line">    val = namespace + val</span><br><span class="line">    res[key] = <span class="keyword">function</span> <span class="title function_">mappedGetter</span> () &#123;</span><br><span class="line">      <span class="keyword">if</span> (namespace &amp;&amp; !<span class="title function_">getModuleByNamespace</span>(<span class="variable language_">this</span>.<span class="property">$store</span>, <span class="string">&#x27;mapGetters&#x27;</span>, namespace)) &#123;</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (__DEV__ &amp;&amp; !(val <span class="keyword">in</span> <span class="variable language_">this</span>.<span class="property">$store</span>.<span class="property">getters</span>)) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">`[vuex] unknown getter: <span class="subst">$&#123;val&#125;</span>`</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">$store</span>.<span class="property">getters</span>[val]</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// mark vuex getter for devtools</span></span><br><span class="line">    res[key].<span class="property">vuex</span> = <span class="literal">true</span></span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="keyword">return</span> res</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªä¹Ÿæ²¡ä»€ä¹ˆå¥½è¯´çš„äº†ï¼Œæ‹¿åˆ°å‘½åç©ºé—´ <code>namespace</code> ï¼Œç›´æ¥æ‹¼æ¥ä¸Š <code>val</code> é€šè¿‡ <code>this.$store.getters[val]</code> è¿›è¡Œè®¿é—®ã€‚ç®€å•ä¸¾ä¸ªä¾‹å­ï¼š</p>
<p>ç¬¬ä¸€ç§æƒ…å†µ</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç¬¬ä¸€ç§</span></span><br><span class="line"><span class="title function_">mapGetters</span>([<span class="string">&#x27;first/foo&#x27;</span>])</span><br></pre></td></tr></table></figure>

<p>è¿™ç§æƒ…å†µä¸‹ <code>namespace</code> è¢«å¤„ç†æˆäº†ç©ºå­—ç¬¦ä¸²ï¼Œ<code>map</code> è¢«å¤„ç†æˆäº† <code>[&#39;first/foo&#39;]</code> ï¼Œéå† <code>map</code> ï¼Œæ­¤æ—¶ <code>val = &#39;first/foo&#39;</code> ï¼Œé‚£ä¹ˆ <code>val = namespace + val</code> å¤„ç†å <code>val</code> ä»ç„¶ç­‰äº <code>first/foo</code> ï¼Œæ‰€ä»¥æœ€åå°±ç›¸å½“äºè°ƒç”¨ <code>this.$store.getters[&#39;first/foo&#39;]</code></p>
<p>å†æ¥çœ‹ç¬¬äºŒç§æƒ…å†µ</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç¬¬äºŒç§</span></span><br><span class="line"><span class="title function_">mapGetters</span>(<span class="string">&#x27;first&#x27;</span>, [<span class="string">&#x27;foo&#x27;</span>])</span><br></pre></td></tr></table></figure>

<p>è¿™ç§æƒ…å†µä¸‹ <code>namespace</code> è¢«å¤„ç†æˆäº† <code>first/</code>ï¼Œ<code>map</code> è¢«å¤„ç†æˆäº† <code>[&#39;foo&#39;]</code> ï¼Œéå† <code>map</code> ï¼Œæ­¤æ—¶ <code>val = &#39;foo&#39;</code> ï¼Œé‚£ä¹ˆ <code>val = namespace + val</code> å¤„ç†å <code>val</code> å°±ç­‰äº <code>first/foo</code> ï¼Œæ‰€ä»¥æœ€åä»ç„¶æ˜¯ç›¸å½“äºè°ƒç”¨ <code>this.$store.getters[&#39;first/foo&#39;]</code></p>
<h4 id="5-4-mapActions"><a href="#5-4-mapActions" class="headerlink" title="5.4 mapActions"></a>5.4 mapActions</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> mapActions = <span class="title function_">normalizeNamespace</span>(<span class="function">(<span class="params">namespace, actions</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> res = &#123;&#125;</span><br><span class="line">  <span class="keyword">if</span> (__DEV__ &amp;&amp; !<span class="title function_">isValidMap</span>(actions)) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;[vuex] mapActions: mapper parameter must be either an Array or an Object&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">normalizeMap</span>(actions).<span class="title function_">forEach</span>(<span class="function">(<span class="params">&#123; key, val &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">    res[key] = <span class="keyword">function</span> <span class="title function_">mappedAction</span> (...args) &#123;</span><br><span class="line">      <span class="comment">// get dispatch function from store</span></span><br><span class="line">      <span class="keyword">let</span> dispatch = <span class="variable language_">this</span>.<span class="property">$store</span>.<span class="property">dispatch</span></span><br><span class="line">      <span class="keyword">if</span> (namespace) &#123;</span><br><span class="line">        <span class="keyword">const</span> <span class="variable language_">module</span> = <span class="title function_">getModuleByNamespace</span>(<span class="variable language_">this</span>.<span class="property">$store</span>, <span class="string">&#x27;mapActions&#x27;</span>, namespace)</span><br><span class="line">        <span class="keyword">if</span> (!<span class="variable language_">module</span>) &#123;</span><br><span class="line">          <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">        dispatch = <span class="variable language_">module</span>.<span class="property">context</span>.<span class="property">dispatch</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">typeof</span> val === <span class="string">&#x27;function&#x27;</span></span><br><span class="line">        ? val.<span class="title function_">apply</span>(<span class="variable language_">this</span>, [dispatch].<span class="title function_">concat</span>(args))</span><br><span class="line">        : dispatch.<span class="title function_">apply</span>(<span class="variable language_">this</span>.<span class="property">$store</span>, [val].<span class="title function_">concat</span>(args))</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="keyword">return</span> res</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>ç®€å•çœ‹äº†ä¸€ä¸‹ï¼Œå¤„ç†æµç¨‹è·Ÿ <code>mapMutations</code> å‡ ä¹ä¸€æ¨¡ä¸€æ ·ï¼Œå°±ä¸å¤šè¯´äº†</p>
<h4 id="5-5-createNamespacedHelpers"><a href="#5-5-createNamespacedHelpers" class="headerlink" title="5.5 createNamespacedHelpers"></a>5.5 createNamespacedHelpers</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">createNamespacedHelpers</span> = (<span class="params">namespace</span>) =&gt; (&#123;</span><br><span class="line">  <span class="attr">mapState</span>: mapState.<span class="title function_">bind</span>(<span class="literal">null</span>, namespace),</span><br><span class="line">  <span class="attr">mapGetters</span>: mapGetters.<span class="title function_">bind</span>(<span class="literal">null</span>, namespace),</span><br><span class="line">  <span class="attr">mapMutations</span>: mapMutations.<span class="title function_">bind</span>(<span class="literal">null</span>, namespace),</span><br><span class="line">  <span class="attr">mapActions</span>: mapActions.<span class="title function_">bind</span>(<span class="literal">null</span>, namespace)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>è¯¥æ–¹æ³•æ˜¯æ ¹æ®ä¼ å…¥çš„å‘½åç©ºé—´ <code>namespace</code> åˆ›å»ºä¸€ç»„è¾…åŠ©å‡½æ•°ã€‚å·§å¦™ä¹‹å¤„å°±æ˜¯å…ˆé€šè¿‡ <code>bind</code> å‡½æ•°æŠŠç¬¬ä¸€ä¸ªå‚æ•°å…ˆä¼ å…¥</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createNamespacedHelpers &#125; <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> &#123; mapState, mapActions &#125; = <span class="title function_">createNamespacedHelpers</span>(<span class="string">&#x27;first/second&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">computed</span>: &#123;</span><br><span class="line">    ...<span class="title function_">mapState</span>(&#123;</span><br><span class="line">      <span class="attr">a</span>: <span class="string">&#x27;a&#x27;</span>,  <span class="comment">// ç›¸å½“äº first/second/a</span></span><br><span class="line">      <span class="attr">b</span>: <span class="string">&#x27;b&#x27;</span>,  <span class="comment">// ç›¸å½“äº first/second/b</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">methods</span>: &#123;</span><br><span class="line">    ...<span class="title function_">mapActions</span>([</span><br><span class="line">      <span class="string">&#x27;foo&#x27;</span>,      <span class="comment">// ç›¸å½“äº first/second/foo</span></span><br><span class="line">      <span class="string">&#x27;bar&#x27;</span>,      <span class="comment">// ç›¸å½“äº first/second/bar</span></span><br><span class="line">    ])</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="ğŸ’¡-å¿ƒå¾—ä½“ä¼š"><a href="#ğŸ’¡-å¿ƒå¾—ä½“ä¼š" class="headerlink" title="ğŸ’¡ å¿ƒå¾—ä½“ä¼š"></a>ğŸ’¡ å¿ƒå¾—ä½“ä¼š</h2><ol>
<li>å¯¹äºè¿™ä¸ªåº“çš„ä½¿ç”¨ä¸€å®šè¦ååˆ†ç†Ÿç»ƒï¼Œå³æ˜ç™½å„ç§æ–¹æ³•çš„ä½¿ç”¨ï¼Œå¼ºçƒˆå»ºè®®æŠŠå®˜æ–¹æ–‡æ¡£åƒé€ï¼ˆ<strong>é‡ç‚¹</strong>ï¼‰</li>
<li>æ‰¾åˆ°æ ¸å¿ƒä»£ç çš„ä½ç½®ï¼Œä»å…¥å£æ–‡ä»¶å¼€å§‹ï¼Œä¸€æ­¥æ­¥çœ‹</li>
<li>å¤šçœ‹æºç ä¸­çš„è‹±æ–‡æ³¨é‡Šï¼Œçœ‹ä¸æ‡‚çš„å¯ä»¥ç”¨ç¿»è¯‘ï¼Œè¿™äº›æ³¨é‡ŠåŸºæœ¬ä¸Šèƒ½å¸®ä½ ç†è§£è¿™æ®µä»£ç çš„ä½œç”¨</li>
<li>é‡åˆ°çœ‹ä¸æ‡‚çš„åœ°æ–¹å¯ä»¥å…ˆæ‰“ä¸ªå¤‡æ³¨ï¼Œå› ä¸ºå®ƒå¯èƒ½ä¸åé¢çš„æŸäº›ä»£ç æœ‰æ‰€è”ç³»ï¼Œç­‰ä¹‹åå›å¤´æ¥çœ‹ä¹‹å‰çœ‹ä¸æ‡‚çš„ä»£ç æ—¶ï¼Œå°±ä¼šæ˜ç™½äº†</li>
<li>é˜…è¯»æºç çš„è¿‡ç¨‹ä¸­ï¼Œçœ‹åˆ°æŸäº›å˜é‡æˆ–å‡½æ•°æ—¶ï¼Œå…ˆçœ‹å‘½åï¼Œå› ä¸ºè¿™äº›å‘½åçš„å­—é¢æ„æ€åŸºæœ¬ä¸Šå°±ä»£è¡¨äº†å®ƒçš„ä½œç”¨ï¼Œç„¶åè¦å­¦ä¼šè”æƒ³åˆ°è¿™ä¸ªæ­£å¸¸çš„è°ƒç”¨æ˜¯ä»€ä¹ˆæ ·çš„ï¼Œè¿™æ ·æ›´ä¾¿äºç†è§£</li>
<li>å¤šå¤šåˆ©ç”¨ç¼–è¾‘å™¨çš„æœç´¢åŠŸèƒ½ã€‚å› ä¸ºæœ‰æ—¶ä½ çœ‹åˆ°çš„å‡½æ•°æˆ–å˜é‡å¯èƒ½åœ¨åˆ«çš„åœ°æ–¹ä¹Ÿæœ‰ç”¨åˆ°ï¼Œä¸ºäº†æ–¹ä¾¿å¯»æ‰¾ï¼Œå¯ä»¥åˆ©ç”¨å¥½ç¼–è¾‘å™¨çš„æœç´¢åŠŸèƒ½ï¼ˆåŒ…æ‹¬å½“å‰<strong>æœ¬åœ°æœç´¢</strong>å’Œ<strong>å…¨å±€æœç´¢</strong>ï¼‰</li>
</ol>

  </div>
</article>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
        
          <li><a href="/">é¦–é¡µ</a></li>
        
          <li><a href="/about/">å…³äº</a></li>
        
          <li><a href="/archives/">å½’æ¡£</a></li>
        
          <li><a target="_blank" rel="noopener" href="http://github.com/dxiaog">é¡¹ç›®</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E6%BA%90%E7%A0%81%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84%E5%88%86%E6%9E%90"><span class="toc-number">1.</span> <span class="toc-text">1. æºç ç›®å½•ç»“æ„åˆ†æ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB"><span class="toc-number">2.</span> <span class="toc-text">2. æºç é˜…è¯»</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E6%9F%A5%E7%9C%8B%E5%B7%A5%E5%85%B7%E5%87%BD%E6%95%B0"><span class="toc-number">2.1.</span> <span class="toc-text">1. æŸ¥çœ‹å·¥å…·å‡½æ•°</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%85%A5%E5%8F%A3%E6%96%87%E4%BB%B6"><span class="toc-number">2.2.</span> <span class="toc-text">2. å…¥å£æ–‡ä»¶</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-Store-%E7%B1%BB%E7%9A%84%E5%AE%9E%E7%8E%B0"><span class="toc-number">2.3.</span> <span class="toc-text">3. Store ç±»çš„å®ç°</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-%E5%AD%98%E6%94%BE%E7%B1%BB%E7%9A%84%E7%8A%B6%E6%80%81"><span class="toc-number">2.3.1.</span> <span class="toc-text">3.1 å­˜æ”¾ç±»çš„çŠ¶æ€</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#3-1-1-%E9%80%92%E5%BD%92%E6%94%B6%E9%9B%86%E6%A8%A1%E5%9D%97"><span class="toc-number">2.3.1.1.</span> <span class="toc-text">3.1.1 é€’å½’æ”¶é›†æ¨¡å—</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-%E6%B3%A8%E5%86%8C%E6%A8%A1%E5%9D%97"><span class="toc-number">2.3.2.</span> <span class="toc-text">3.2 æ³¨å†Œæ¨¡å—</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#3-2-1-%E6%B3%A8%E5%86%8C%E6%A8%A1%E5%9D%97%E7%9A%84-state"><span class="toc-number">2.3.2.1.</span> <span class="toc-text">3.2.1 æ³¨å†Œæ¨¡å—çš„ state</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-2-2-%E7%94%9F%E6%88%90%E6%A8%A1%E5%9D%97%E8%B0%83%E7%94%A8%E4%B8%8A%E4%B8%8B%E6%96%87"><span class="toc-number">2.3.2.2.</span> <span class="toc-text">3.2.2 ç”Ÿæˆæ¨¡å—è°ƒç”¨ä¸Šä¸‹æ–‡</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-2-3-%E6%B3%A8%E5%86%8C%E6%A8%A1%E5%9D%97%E7%9A%84-mutation"><span class="toc-number">2.3.2.3.</span> <span class="toc-text">3.2.3 æ³¨å†Œæ¨¡å—çš„ mutation</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-2-4-%E6%B3%A8%E5%86%8C%E6%A8%A1%E5%9D%97%E7%9A%84-actions"><span class="toc-number">2.3.2.4.</span> <span class="toc-text">3.2.4 æ³¨å†Œæ¨¡å—çš„ actions</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-2-5-%E6%B3%A8%E5%86%8C%E6%A8%A1%E5%9D%97%E7%9A%84-getters"><span class="toc-number">2.3.2.5.</span> <span class="toc-text">3.2.5 æ³¨å†Œæ¨¡å—çš„ getters</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-2-6-%E9%80%92%E5%BD%92%E6%B3%A8%E5%86%8C%E5%AD%90%E6%A8%A1%E5%9D%97"><span class="toc-number">2.3.2.6.</span> <span class="toc-text">3.2.6 é€’å½’æ³¨å†Œå­æ¨¡å—</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-%E6%B3%A8%E5%86%8C-vm"><span class="toc-number">2.3.3.</span> <span class="toc-text">3.3 æ³¨å†Œ vm</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-4-%E8%AE%BF%E9%97%AE-state-%E3%80%81mutations-%E3%80%81actions"><span class="toc-number">2.3.4.</span> <span class="toc-text">3.4 è®¿é—® state ã€mutations ã€actions</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#3-4-1-%E8%AE%BF%E9%97%AE-state"><span class="toc-number">2.3.4.1.</span> <span class="toc-text">3.4.1 è®¿é—® state</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-4-2-%E8%AE%BF%E9%97%AE-mutations"><span class="toc-number">2.3.4.2.</span> <span class="toc-text">3.4.2 è®¿é—® mutations</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-4-3-%E8%AE%BF%E9%97%AE-actions"><span class="toc-number">2.3.4.3.</span> <span class="toc-text">3.4.3 è®¿é—® actions</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-5-%E6%8F%92%E4%BB%B6%E7%9A%84%E8%B0%83%E7%94%A8"><span class="toc-number">2.3.5.</span> <span class="toc-text">3.5 æ’ä»¶çš„è°ƒç”¨</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-6-%E5%85%B6%E5%AE%83%E6%96%B9%E6%B3%95"><span class="toc-number">2.3.6.</span> <span class="toc-text">3.6 å…¶å®ƒæ–¹æ³•</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#3-6-1-%E6%9B%B4%E6%96%B0-state"><span class="toc-number">2.3.6.1.</span> <span class="toc-text">3.6.1 æ›´æ–° state</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-6-2-%E6%B3%A8%E5%86%8C%E3%80%81%E5%8D%B8%E8%BD%BD%E6%A8%A1%E5%9D%97"><span class="toc-number">2.3.6.2.</span> <span class="toc-text">3.6.2 æ³¨å†Œã€å¸è½½æ¨¡å—</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-6-3-%E9%87%8D%E7%BD%AE-store-%E5%AE%9E%E4%BE%8B"><span class="toc-number">2.3.6.3.</span> <span class="toc-text">3.6.3 é‡ç½® store å®ä¾‹</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-install-%E6%B3%A8%E5%86%8C"><span class="toc-number">2.4.</span> <span class="toc-text">4. install æ³¨å†Œ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E8%BE%85%E5%8A%A9%E5%87%BD%E6%95%B0"><span class="toc-number">2.5.</span> <span class="toc-text">5. è¾…åŠ©å‡½æ•°</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#5-1-mapState"><span class="toc-number">2.5.1.</span> <span class="toc-text">5.1 mapState</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-2-mapMutations"><span class="toc-number">2.5.2.</span> <span class="toc-text">5.2 mapMutations</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-3-mapGetters"><span class="toc-number">2.5.3.</span> <span class="toc-text">5.3 mapGetters</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-4-mapActions"><span class="toc-number">2.5.4.</span> <span class="toc-text">5.4 mapActions</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-5-createNamespacedHelpers"><span class="toc-number">2.5.5.</span> <span class="toc-text">5.5 createNamespacedHelpers</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%92%A1-%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A"><span class="toc-number">3.</span> <span class="toc-text">ğŸ’¡ å¿ƒå¾—ä½“ä¼š</span></a></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://dxiaog.github.io/2021/01/15/Vuex%20%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://dxiaog.github.io/2021/01/15/Vuex%20%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB/&text=Vuex æºç é˜…è¯»"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://dxiaog.github.io/2021/01/15/Vuex%20%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB/&title=Vuex æºç é˜…è¯»"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://dxiaog.github.io/2021/01/15/Vuex%20%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB/&is_video=false&description=Vuex æºç é˜…è¯»"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Vuex æºç é˜…è¯»&body=Check out this article: https://dxiaog.github.io/2021/01/15/Vuex%20%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB/"><i class="fa-solid fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://dxiaog.github.io/2021/01/15/Vuex%20%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB/&title=Vuex æºç é˜…è¯»"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://dxiaog.github.io/2021/01/15/Vuex%20%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB/&title=Vuex æºç é˜…è¯»"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://dxiaog.github.io/2021/01/15/Vuex%20%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB/&title=Vuex æºç é˜…è¯»"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://dxiaog.github.io/2021/01/15/Vuex%20%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB/&title=Vuex æºç é˜…è¯»"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://dxiaog.github.io/2021/01/15/Vuex%20%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB/&name=Vuex æºç é˜…è¯»&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://dxiaog.github.io/2021/01/15/Vuex%20%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB/&t=Vuex æºç é˜…è¯»"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fa-solid fa-bars fa-lg" aria-hidden="true"></i> èœå•</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fa-solid fa-list fa-lg" aria-hidden="true"></i> ç›®å½•</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fa-solid fa-share-alt fa-lg" aria-hidden="true"></i> åˆ†äº«</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up fa-lg" aria-hidden="true"></i> è¿”å›é¡¶éƒ¨</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2019-2023
    æ®µæ™“åˆš
  </div>
  <div class="footer-right">
    <nav>
      <ul>
        <!--
       --><li><a href="/">é¦–é¡µ</a></li><!--
     --><!--
       --><li><a href="/about/">å…³äº</a></li><!--
     --><!--
       --><li><a href="/archives/">å½’æ¡£</a></li><!--
     --><!--
       --><li><a target="_blank" rel="noopener" href="http://github.com/dxiaog">é¡¹ç›®</a></li><!--
     -->
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script>




<!-- clipboard -->

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script>
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"å¤åˆ¶åˆ°ç²˜è´´æ¿ï¼\">";
    btn += '<i class="fa-regular fa-clone"></i>';
    btn += '</span>';
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "å¤åˆ¶æˆåŠŸï¼");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Disqus Comments -->

<!-- utterances Comments -->

</body>
</html>
